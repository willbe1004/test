<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ÌïúÍµ≠ÏàòÏïà AI ÏûÖÏ∞∞Í¥ÄÎ¶¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ‚úÖ Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --bg-main: #050b16;
            --bg-card: #0e1b2a;
            --bg-card-soft: #122538;
            --accent: #ffb83f;
            --accent-soft: rgba(255, 184, 63, 0.15);
            --accent-strong: #ff9f1c;
            --primary: #00c896;
            --primary-soft: rgba(0, 200, 150, 0.15);
            --danger: #ff5c7a;
            --text-main: #f4f7fb;
            --text-soft: #9faec6;
            --border-subtle: #1e3146;
            --shadow-soft: 0 18px 40px rgba(6, 17, 36, 0.85);
            --radius-lg: 18px;
            --radius-xl: 22px;
            --transition-fast: 0.18s ease-out;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
            background: radial-gradient(circle at top, #10213a 0, #050b16 40%, #02030a 70%);
            color: var(--text-main);
            min-height: 100vh;
        }

        .page-shell {
            max-width: 1320px;
            margin: 0 auto;
            padding: 20px 18px 32px;
        }

        /* Ìó§Îçî ------------------------------------------------------- */

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        .app-title-block {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 220px;
        }

        .app-title-main {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

            .app-title-main h1 {
                margin: 0;
                font-size: 22px;
                letter-spacing: 0.04em;
                font-weight: 700;
                color: #f8fbff;
            }

        .badge-version {
            font-size: 11px;
            padding: 4px 9px;
            border-radius: 999px;
            border: 1px solid rgba(0, 200, 150, 0.6);
            color: var(--primary);
            background: radial-gradient(circle at top left, #123d3a, #050b16);
        }

        .app-subtitle {
            font-size: 11px;
            color: var(--text-soft);
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

            .app-subtitle span.dot {
                width: 4px;
                height: 4px;
                border-radius: 50%;
                background: var(--accent);
                box-shadow: 0 0 12px rgba(255, 184, 63, 0.8);
            }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
            flex: 1;
        }

        .btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 7px 14px;
            border-radius: 999px;
            border: 1px solid transparent;
            font-size: 12px;
            color: var(--text-main);
            background: rgba(10, 23, 40, 0.9);
            cursor: pointer;
            transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast);
            white-space: nowrap;
        }

            .btn span.icon {
                font-size: 14px;
            }

        .btn-primary {
            background: linear-gradient(135deg, #00c896, #00e0b0);
            border-color: rgba(0, 0, 0, 0.15);
            color: #061118;
            font-weight: 600;
            box-shadow: 0 10px 24px rgba(0, 200, 150, 0.3);
        }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 14px 32px rgba(0, 200, 150, 0.4);
            }

        .btn-ghost {
            border-color: rgba(255, 255, 255, 0.12);
            background: rgba(7, 16, 28, 0.9);
        }

            .btn-ghost:hover {
                background: rgba(18, 35, 58, 0.9);
                transform: translateY(-1px);
                box-shadow: 0 10px 28px rgba(0, 0, 0, 0.6);
            }

        .btn-danger {
            background: rgba(255, 92, 122, 0.1);
            border-color: rgba(255, 92, 122, 0.5);
            color: #ffbac9;
        }

            .btn-danger:hover {
                background: rgba(255, 92, 122, 0.2);
            }

        .btn-small {
            padding: 5px 10px;
            font-size: 11px;
        }

        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

            .btn.loading::after {
                content: "";
                position: absolute;
                right: 9px;
                width: 14px;
                height: 14px;
                border-radius: 50%;
                border: 2px solid rgba(255, 255, 255, 0.6);
                border-top-color: transparent;
                animation: spin 0.8s linear infinite;
            }

        .login-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(255, 92, 122, 0.7);
            background: var(--danger);
        }

            .login-status-dot.connected {
                background: var(--primary);
                box-shadow: 0 0 14px rgba(0, 200, 150, 0.9);
            }

        .login-status-text {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* ÏÉÅÎã® Ï†ïÎ≥¥ Ïπ¥Îìú ----------------------------------------------------- */

        .summary-row {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin-bottom: 16px;
        }

        .summary-card {
            flex: 1 1 140px;
            min-width: 130px;
            padding: 14px 14px 12px;
            border-radius: var(--radius-lg);
            background: radial-gradient(circle at top left, #152840, #07111f);
            border: 1px solid rgba(255, 255, 255, 0.04);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2px;
        }

        .summary-label {
            font-size: 11px;
            color: var(--text-soft);
        }

        .summary-icon {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: rgba(7, 234, 182, 0.06);
            color: var(--primary);
        }

        .summary-value {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 0.03em;
        }

        .summary-sub {
            font-size: 11px;
            color: var(--text-soft);
        }

        .summary-card.accent {
            background: radial-gradient(circle at top, #3f2a00, #10141f);
            border-color: rgba(255, 184, 63, 0.6);
        }

            .summary-card.accent .summary-icon {
                background: rgba(255, 184, 63, 0.12);
                color: var(--accent-strong);
            }

        .period-label {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* ÎèÑÎÑõ Í∑∏ÎûòÌîÑ -------------------------------------------------------- */

        .donut-card {
            flex: 0 0 210px;
            max-width: 240px;
            padding: 16px 10px 10px;
            border-radius: var(--radius-xl);
            background: radial-gradient(circle at top, #1d2f46, #050b16);
            border: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
        }

        .donut-label {
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 8px;
        }

        .donut-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .donut-ring {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 12px solid rgba(255, 255, 255, 0.06);
            border-top-color: var(--accent);
            border-right-color: var(--accent);
            box-shadow: 0 0 40px rgba(255, 184, 63, 0.45);
            animation: donut-spin 10s linear infinite;
            animation-play-state: paused;
        }

        .donut-center {
            position: absolute;
            inset: 50%;
            width: 72px;
            height: 72px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: radial-gradient(circle at top, #162237, #050b16);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }

        .donut-main {
            font-size: 24px;
            font-weight: 700;
        }

        .donut-sub {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* Í≤ÄÏÉâ/ÌïÑÌÑ∞ ----------------------------------------------------------- */

        .controls-bar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .search-input-wrap {
            flex: 1 1 220px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 8px 34px 8px 32px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(7, 16, 29, 0.96);
            color: var(--text-main);
            font-size: 13px;
            outline: none;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
        }

            .search-input::placeholder {
                color: rgba(159, 174, 198, 0.6);
            }

        .search-icon-left,
        .search-icon-right {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 15px;
            color: var(--text-soft);
            pointer-events: none;
        }

        .search-icon-left {
            left: 10px;
        }

        .search-icon-right {
            right: 10px;
        }

        .search-input:focus {
            border-color: rgba(0, 200, 150, 0.85);
            box-shadow: 0 0 0 1px rgba(0, 200, 150, 0.32);
            background: rgba(11, 23, 40, 0.98);
        }

        .select {
            min-width: 120px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(12, 23, 39, 0.96);
            color: var(--text-main);
            padding: 7px 26px 7px 10px;
            font-size: 12px;
            outline: none;
            position: relative;
            appearance: none;
            background-image: linear-gradient(45deg, transparent 50%, #7e90aa 50%), linear-gradient(135deg, #7e90aa 50%, transparent 50%);
            background-position: calc(100% - 13px) 10px, calc(100% - 8px) 10px;
            background-size: 5px 5px, 5px 5px;
            background-repeat: no-repeat;
        }

        .chip-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .chip {
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            font-size: 11px;
            color: var(--text-soft);
            cursor: pointer;
            background: rgba(7, 16, 28, 0.8);
            transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
        }

            .chip:hover {
                transform: translateY(-1px);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .chip.active {
                background: var(--primary-soft);
                border-color: rgba(0, 200, 150, 0.9);
                color: #bff8ea;
            }

        /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ ------------------------------------------------------- */

        .main-layout {
            display: grid;
            grid-template-columns: minmax(0, 2.4fr) minmax(320px, 1.3fr);
            gap: 18px;
            align-items: flex-start;
            margin-top: 12px;
        }

        .bid-list-panel {
            background: rgba(7, 15, 28, 0.9);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: var(--shadow-soft);
            padding: 14px 14px 10px;
            max-height: calc(100vh - 260px);
            overflow-y: auto;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 12px;
            color: var(--text-soft);
            gap: 6px;
            flex-wrap: wrap;
        }

        .panel-header-left {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .pill-count {
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(9, 31, 55, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.06);
            font-size: 11px;
        }

        .panel-header-right {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .mini-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--primary);
            box-shadow: 0 0 10px rgba(0, 200, 150, 0.8);
        }

        /* ÏûÖÏ∞∞ Ïπ¥Îìú ----------------------------------------------------------- */

        .bid-card {
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: linear-gradient(135deg, rgba(13, 28, 51, 0.98), rgba(7, 15, 29, 0.98));
            padding: 12px 12px 10px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

            .bid-card::before {
                content: "";
                position: absolute;
                inset: -30%;
                background: radial-gradient(circle at 10% -10%, rgba(0, 200, 150, 0.12), transparent 50%), radial-gradient(circle at 100% 120%, rgba(255, 184, 63, 0.08), transparent 55%);
                opacity: 0.7;
                pointer-events: none;
            }

        .bid-card-inner {
            position: relative;
            z-index: 1;
        }

        .bid-top-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 2px;
            flex-wrap: wrap;
        }

        .badge-region {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(3, 15, 33, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.09);
            color: var(--text-soft);
        }

        .bid-no {
            font-size: 11px;
            color: var(--text-soft);
        }

        .badge-status {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(2, 36, 25, 0.9);
            color: #b5ffe5;
            border: 1px solid rgba(0, 200, 150, 0.7);
            white-space: nowrap;
        }

            .badge-status.open {
                background: rgba(2, 36, 25, 0.9);
                color: #b5ffe5;
                border: 1px solid rgba(0, 200, 150, 0.7);
            }

            .badge-status.closed {
                background: rgba(44, 14, 20, 0.9);
                color: #ffd0da;
                border: 1px solid rgba(255, 92, 122, 0.7);
            }

        .badge-source {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(3, 18, 35, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.16);
            color: var(--text-soft);
            white-space: nowrap;
        }

        .badge-status.manual {
            background: rgba(44, 26, 0, 0.9);
            border-color: rgba(255, 184, 63, 0.7);
            color: #ffe7b4;
        }

        .bid-title {
            margin: 0 0 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .bid-subline {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 4px;
        }

            .bid-subline span {
                white-space: nowrap;
            }

        .meta-label {
            font-size: 10px;
            color: #7f92b2;
            text-transform: uppercase;
            letter-spacing: 0.07em;
        }

        .meta-value {
            font-size: 11px;
            color: #d5e1ff;
        }

        .bid-meta-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 6px 12px;
            margin: 4px 0 5px;
        }

        .bid-meta-item {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .ai-result-box {
            margin-top: 4px;
            padding: 7px 9px 7px;
            border-radius: 12px;
            background: rgba(3, 18, 35, 0.92);
            border: 1px solid rgba(0, 200, 150, 0.15);
            font-size: 11px;
            color: var(--text-soft);
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .ai-result-icon {
            font-size: 14px;
            color: var(--primary);
            margin-top: 1px;
        }

        .ai-result-text strong {
            color: #f9fbff;
        }

        .bid-footer-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            margin-top: 4px;
            font-size: 10px;
            color: var(--text-soft);
        }

        .bid-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .btn-link {
            text-decoration: none;
            color: inherit;
        }

            .btn-link:hover {
                text-decoration: underline;
            }

        /* Ï∫òÎ¶∞Îçî Ïπ¥Îìú -------------------------------------------------------- */

        .calendar-panel {
            background: rgba(7, 15, 28, 0.96);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: var(--shadow-soft);
            padding: 12px 12px 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-soft);
            margin-bottom: 2px;
            gap: 6px;
            flex-wrap: wrap;
        }

        .calendar-header-left {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .calendar-tag {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(3, 18, 35, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .calendar-frame {
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 14px 38px rgba(0, 0, 0, 0.9);
            position: relative;
        }

            .calendar-frame iframe {
                width: 100%;
                height: 420px;
                border: none;
                display: block;
                filter: saturate(1.15) contrast(1.02);
            }

        /* send feedback Î≤ÑÌäº Í∞ÄÎ¶¨Í∏∞Ïö© ÎßàÏä§ÌÅ¨ */
        .calendar-mask {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 140px;
            height: 40px;
            background: linear-gradient( 90deg, transparent, rgba(7, 15, 28, 0.96) );
            pointer-events: auto; /* Ï∫òÎ¶∞Îçî ÌîºÎìúÎ∞± Î≤ÑÌäº ÌÅ¥Î¶≠ Î∞©ÏßÄ */
        }

        /* Í≥µÏö© Î™®Îã¨ Î∞±ÎìúÎ°≠ --------------------------------------------------- */

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(3px);
        }

            .modal-backdrop.active {
                display: flex;
            }

        /* Ïä§ÎßàÌä∏ Îì±Î°ù Î™®Îã¨ --------------------------------------------------- */

        .modal {
            width: min(680px, 92vw);
            max-height: 80vh;
            overflow: hidden;
            border-radius: 18px;
            background: radial-gradient(circle at top, #13233b, #050b16);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 12px 16px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 14px;
            font-weight: 600;
        }

        .modal-body {
            padding: 12px 16px 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 10px 16px 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            font-size: 11px;
            color: var(--text-soft);
        }

        .field-label {
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 4px;
        }

        .textarea {
            width: 100%;
            min-height: 120px;
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            background: rgba(6, 14, 26, 0.96);
            color: var(--text-main);
            font-size: 12px;
            padding: 8px 10px;
            outline: none;
            resize: vertical;
        }

        .input {
            width: 100%;
            border-radius: 10px;
            border: 1px solid var(--border-subtle);
            background: rgba(6, 14, 26, 0.96);
            color: var(--text-main);
            font-size: 12px;
            padding: 7px 9px;
            outline: none;
        }

            .textarea:focus,
            .input:focus {
                border-color: rgba(0, 200, 150, 0.85);
                box-shadow: 0 0 0 1px rgba(0, 200, 150, 0.32);
            }

        /* 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ ------------------------------------------------- */

        .deep-modal {
            width: min(880px, 96vw);
            max-height: 84vh;
            border-radius: 22px;
            background: radial-gradient(circle at top, #131b2b, #050811);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 24px 68px rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            color: var(--text-main);
        }

        .deep-modal-header {
            padding: 18px 22px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .deep-modal-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            flex-wrap: wrap;
        }

        .deep-modal-title {
            font-size: 16px;
            font-weight: 600;
        }

        .deep-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .deep-badge {
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(8, 23, 42, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.12);
            color: var(--text-soft);
        }

            .deep-badge.primary {
                border-color: rgba(0, 200, 150, 0.7);
                color: #bff8ea;
                background: rgba(0, 200, 150, 0.1);
            }

            .deep-badge.warn {
                border-color: rgba(255, 184, 0.7);
                color: #ffe7b4;
                background: rgba(255, 184, 63, 0.1);
            }

            .deep-badge.danger {
                border-color: rgba(255, 92, 122, 0.7);
                color: #ffd0da;
                background: rgba(255, 92, 122, 0.12);
            }

        .deep-modal-close-btn {
            border-radius: 999px;
            padding: 6px 13px;
            font-size: 12px;
        }

        .deep-modal-body {
            padding: 12px 22px 18px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .deep-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #b8c5e4;
            margin-bottom: 4px;
        }

        .deep-summary-text {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-main);
        }

        .deep-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px 18px;
            font-size: 12px;
        }

        .deep-grid-item-label {
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 2px;
        }

        .deep-grid-item-value {
            font-size: 13px;
            color: #f4f7ff;
        }

        .deep-checkpoints {
            font-size: 12px;
            padding-left: 18px;
            margin: 4px 0 0;
        }

            .deep-checkpoints li {
                margin-bottom: 2px;
            }

        .deep-attachments-box {
            font-size: 12px;
            border-radius: 12px;
            padding: 9px 10px 8px;
            background: rgba(4, 15, 30, 0.96);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .deep-attachments-list {
            margin: 4px 0 0;
            padding-left: 18px;
        }

            .deep-attachments-list li {
                margin-bottom: 3px;
            }

            .deep-attachments-list a {
                color: #c6e4ff;
                text-decoration: none;
            }

                .deep-attachments-list a:hover {
                    text-decoration: underline;
                }

        .deep-footer {
            padding: 10px 22px 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            font-size: 11px;
            color: var(--text-soft);
            flex-wrap: wrap;
        }

        /* Ï†ÑÏó≠ Î°úÎî© --------------------------------------------------------- */


        /* Î™©Î°ù ÏòÅÏó≠ Ïù∏ÎùºÏù∏ Î°úÎî© ÌëúÏãú */
        .loading-inline {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 18px 12px;
            font-size: 12px;
            color: #b2bec3;
        }

        .spinner-inline {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid rgba(0, 200, 150, 0.25);
            border-top-color: #00e0b0;
            border-right-color: #ffb83f;
            animation: spin 0.9s linear infinite;
        }


        .loading-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(0, 0, 0, 0.82), rgba(0, 0, 0, 0.95));
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(3px);
        }

            .loading-overlay.active {
                display: flex;
            }

        .loading-box {
            padding: 18px 22px 14px;
            border-radius: 18px;
            background: radial-gradient(circle at top, #172134, #050812);
            border: 1px solid rgba(0, 200, 150, 0.4);
            color: var(--text-main);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            gap: 14px;
            min-width: 220px;
        }

        .spinner-lg {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 3px solid rgba(0, 200, 150, 0.25);
            border-top-color: #00e0b0;
            border-right-color: #ffb83f;
            animation: spin 0.8s linear infinite;
        }

        .loading-text-main {
            font-size: 13px;
            font-weight: 500;
        }

        .loading-text-sub {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* Î∞òÏùëÌòï ------------------------------------------------------------- */

        @media (max-width: 1020px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .calendar-panel {
                order: -1;
            }

            .bid-list-panel {
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                align-items: stretch;
            }

            .header-actions {
                justify-content: flex-start;
            }

            .summary-row {
                flex-direction: column;
            }

            .donut-card {
                max-width: none;
                order: -1;
            }

            .controls-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .calendar-frame iframe {
                height: 360px;
            }

            .deep-grid-3 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .app-title-main h1 {
                font-size: 18px;
            }

            .deep-modal-header,
            .deep-modal-body,
            .deep-footer {
                padding-left: 16px;
                padding-right: 16px;
            }
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò --------------------------------------------------------- */

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes donut-spin {
            0% {
                transform: rotate(0deg);
            }

            40% {
                transform: rotate(320deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ====== Ïª§Ïä§ÌÖÄ Ïä§ÌÅ¨Î°§Î∞î (Í≤ÄÏÉâÍ≤∞Í≥º Ìå®ÎÑêÏö©) ====== */

        .bid-list-panel {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 200, 150, 0.6) rgba(6, 14, 26, 0.9);
        }

            .bid-list-panel::-webkit-scrollbar {
                width: 8px;
            }

            .bid-list-panel::-webkit-scrollbar-track {
                background: rgba(4, 10, 20, 0.9);
                border-radius: 999px;
            }

            .bid-list-panel::-webkit-scrollbar-thumb {
                background: linear-gradient(180deg, #00c896, #00e0b0);
                border-radius: 999px;
                box-shadow: 0 0 14px rgba(0, 200, 150, 0.7);
            }

                .bid-list-panel::-webkit-scrollbar-thumb:hover {
                    background: linear-gradient(180deg, #00e0b0, #ffb83f);
                }
    </style>
</head>
<body>
    <div class="page-shell">
        <!-- Ìó§Îçî -->
        <header class="app-header">
            <div class="app-title-block">
                <div class="app-title-main">
                    <h1>ÌïúÍµ≠ÏàòÏïà AI ÏûÖÏ∞∞Í¥ÄÎ¶¨</h1>
                    <span class="badge-version">AI Î∂ÑÏÑù ÌïÑÌÑ∞ v2</span>
                </div>
                <div class="app-subtitle">
                    <span class="dot"></span>
                    <span>ÎÇòÎùºÏû•ÌÑ∞¬∑Ïô∏Î∂ÄÍ≥µÍ≥†ÏóêÏÑú Ï†ÄÎ•òÏ°∞/Ïö∞Ïàò¬∑Ïπ®ÏàòÎ∞©ÏßÄ Í¥ÄÎ†® ÏûÖÏ∞∞ ÏûêÎèô ÏÑ†Î≥Ñ</span>
                </div>
            </div>

            <div class="header-actions">
                <button id="btnExternal" class="btn btn-ghost btn-small">
                    <span class="icon">üåê</span> Ïô∏Î∂ÄÏõπ ÏàòÏßë
                </button>
                <button id="btnSmartAddOpen" class="btn btn-ghost btn-small">
                    <span class="icon">‚ûï</span> Í≥µÍ≥† Ïä§ÎßàÌä∏ Îì±Î°ù
                </button>
                <button id="btnRefresh" class="btn btn-primary btn-small">
                    <span class="icon">‚ö°</span> ÏÉàÎ°úÍ≥†Ïπ®
                </button>
                <div style="display:flex;align-items:center;gap:8px;">
                    <button id="btnLogin" class="btn btn-ghost btn-small">
                        <span class="icon">üîë</span>
                        <span id="btnLoginLabel">Î°úÍ∑∏Ïù∏</span>
                    </button>
                    <div>
                        <div id="loginStatusDot" class="login-status-dot"></div>
                        <div id="loginStatusText" class="login-status-text">Ï∫òÎ¶∞Îçî ÎØ∏Ïó∞Îèô</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ÏÉÅÎã® ÏöîÏïΩ/ÎèÑÎÑõ -->
        <section class="summary-row">
            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">Í≤ÄÏÉâ Ï†ÑÏ≤¥ Í≥µÍ≥† Ïàò</span>
                    <div class="summary-icon">üìÑ</div>
                </div>
                <div id="statTotalRaw" class="summary-value">0</div>
                <div class="summary-sub">ÎÇòÎùºÏû•ÌÑ∞ API Í∏∞Ï§Ä ÏµúÍ∑º 7Ïùº Ìï©Í≥Ñ</div>
            </article>

            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">Ï†ÅÌï©ÏÑ± ÌÜµÍ≥º</span>
                    <div class="summary-icon">üß≤</div>
                </div>
                <div id="statFiltered" class="summary-value">0</div>
                <div class="summary-sub">Ìå®ÌÑ¥ ÌïÑÌÑ∞ ÌõÑ ÎÇ®ÏùÄ Í≥µÍ≥†</div>
            </article>

            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">AI Î∂ÑÏÑù ÏàòÌñâ</span>
                    <div class="summary-icon">ü§ñ</div>
                </div>
                <div id="statAi" class="summary-value">0</div>
                <div class="summary-sub">Gemini 1Ï∞® ÏöîÏïΩ Í±¥Ïàò</div>
            </article>

            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">Í≤ÄÌÜ† ÎåÄÏÉÅ Í≥µÍ≥†</span>
                    <div class="summary-icon">üì°</div>
                </div>
                <div id="statApi" class="summary-value">0</div>
                <div class="summary-sub">
                    <span id="statPeriod" class="period-label">Í∏∞Í∞Ñ: ÏµúÍ∑º 7 Ïùº</span>
                </div>
            </article>

            <article class="donut-card">
                <div class="donut-label">Í¥ÄÎ†®ÏÑ± Î∂ÑÌè¨ (ÏÉÅ + Ï§ë)</div>
                <div class="donut-wrapper">
                    <div class="donut-ring" id="donutRing"></div>
                    <div class="donut-center">
                        <div id="donutMain" class="donut-main">0</div>
                        <div class="donut-sub">ÌòÑÏû¨ Ï°∞Ìöå Í±¥Ïàò</div>
                    </div>
                </div>
            </article>
        </section>

        <!-- Í≤ÄÏÉâ/ÌïÑÌÑ∞ -->
        <section class="controls-bar">
            <div class="search-input-wrap">
                <input id="searchInput"
                       class="search-input"
                       type="text"
                       placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• (ÌïôÍµê, Í∞úÏ∂ï, Í∞ïÎèôÍµ¨, ÏÑ§Í≥Ñ Îì±)" />
                <span class="search-icon-left">üîç</span>
                <span class="search-icon-right">‚å®Ô∏è</span>
            </div>

            <select id="filterRegion" class="select">
                <option value="">Ï†ÑÏ≤¥ ÏßÄÏó≠</option>
                <option value="ÏÑúÏö∏">ÏÑúÏö∏</option>
                <option value="Í≤ΩÍ∏∞">Í≤ΩÍ∏∞</option>
                <option value="Ïù∏Ï≤ú">Ïù∏Ï≤ú</option>
                <option value="Î∂ÄÏÇ∞">Î∂ÄÏÇ∞</option>
                <option value="ÎåÄÍµ¨">ÎåÄÍµ¨</option>
                <option value="Í¥ëÏ£º">Í¥ëÏ£º</option>
                <option value="ÎåÄÏ†Ñ">ÎåÄÏ†Ñ</option>
                <option value="Ïö∏ÏÇ∞">Ïö∏ÏÇ∞</option>
                <option value="Í∞ïÏõê">Í∞ïÏõê</option>
                <option value="Ï∂©Ï≤≠">Ï∂©Ï≤≠</option>
                <option value="Í≤ΩÏÉÅ">Í≤ΩÏÉÅ</option>
                <option value="Ï†ÑÎùº">Ï†ÑÎùº</option>
                <option value="Ï†úÏ£º">Ï†úÏ£º</option>
            </select>

            <div class="chip-group">
                <div class="chip active" data-rel="all">Ï†ÑÏ≤¥</div>
                <div class="chip" data-rel="high">Í¥ÄÎ†®ÏÑ± ÏÉÅ</div>
                <div class="chip" data-rel="mid">Í¥ÄÎ†®ÏÑ± Ï§ë Ïù¥ÏÉÅ</div>
            </div>
        </section>

        <!-- Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ (ÏûÖÏ∞∞ Î¶¨Ïä§Ìä∏ + Ï∫òÎ¶∞Îçî) -->
        <section class="main-layout">
            <section class="bid-list-panel">
                <header class="panel-header">
                    <div class="panel-header-left">
                        <span>Í≤ÄÏÉâ Í≤∞Í≥º</span>
                        <span class="pill-count"><span id="resultCount">0</span>Í±¥</span>
                        <span id="resultBreakdown" style="font-size:11px;color:var(--text-soft);">
                            API 0 / Ïô∏Î∂Ä 0
                        </span>
                    </div>
                    <div class="panel-header-right">
                        <span class="mini-dot"></span>
                        <span id="statLastUpdate">Last Update: -</span>
                    </div>
                </header>

                <div id="bidList"></div>
            </section>

            <aside class="calendar-panel">
                <header class="calendar-header">
                    <div class="calendar-header-left">
                        <span>ÏûÖÏ∞∞ ÎßàÍ∞ê Ï∫òÎ¶∞Îçî</span>
                        <span class="calendar-tag">Google Calendar</span>
                    </div>
                    <span style="font-size:11px;color:var(--text-soft);">
                        ÏùºÏ†ï Îì±Î°ù Ïãú ÏûêÎèôÏúºÎ°ú ÎèôÍ∏∞Ìôî Îê©ÎãàÎã§.
                    </span>
                </header>

                <div class="calendar-frame">
                    <!-- showTabs / showNav ÌôúÏÑ±Ìôî -->
                    <iframe id="calendarIframe"
                            src="https://calendar.google.com/calendar/embed?src=d51a10e0014dcbd83e98d0da91cda4f52f629c19652c15fc693ee4529bbbab04%40group.calendar.google.com&ctz=Asia%2FSeoul&bgcolor=%23050915&mode=MONTH&showTitle=0&showPrint=0&showTabs=1&showCalendars=0&showTz=0&showNav=1&showDate=1"></iframe>
                    <!-- Feedback Î≤ÑÌäº Í∞ÄÎ¶¨Í∏∞ -->
                    <div class="calendar-mask"></div>
                </div>
            </aside>
        </section>
    </div>

    <!-- Ïä§ÎßàÌä∏ Îì±Î°ù Î™®Îã¨ -->
    <div id="smartModalBackdrop" class="modal-backdrop">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Ïô∏Î∂Ä Í≥µÍ≥† Ïä§ÎßàÌä∏ Îì±Î°ù</div>
                <button id="btnSmartClose" class="btn btn-ghost btn-small">
                    Îã´Í∏∞
                </button>
            </div>
            <form id="smartForm">
                <div class="modal-body">
                    <div>
                        <div class="field-label">‚ë† Í≥µÍ≥† Î≥∏Î¨∏ ÌÖçÏä§Ìä∏ (ÏÑ†ÌÉù)</div>
                        <textarea id="smartText"
                                  class="textarea"
                                  placeholder="ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Î≥µÏÇ¨Ìïú Î≥∏Î¨∏ ÌÖçÏä§Ìä∏Î•º Î∂ôÏó¨ ÎÑ£ÏúºÏÑ∏Ïöî."></textarea>
                    </div>
                    <div>
                        <div class="field-label">
                            ‚ë° Ï≤®Î∂ÄÌååÏùº / Îã§Ïö¥Î°úÎìú Ï£ºÏÜå(URL) (Ï§ÑÎ∞îÍøà ÎòêÎäî ÏâºÌëúÎ°ú Ïó¨Îü¨ Í∞ú ÏûÖÎ†• Í∞ÄÎä•)
                        </div>
                        <input id="smartUrl"
                               class="input"
                               type="text"
                               placeholder="https://...hwp, https://...pdf Îì±" />
                    </div>
                </div>
                <div class="modal-footer">
                    <span>AIÍ∞Ä Í≥µÍ≥†Î≤àÌò∏¬∑Í∏àÏï°¬∑Í∏∞Í∞Ñ¬∑Îã¥ÎãπÏûê Îì±ÏùÑ Ï∂îÏ∂úÌï¥ Ìïú ÌñâÏúºÎ°ú Îì±Î°ùÌï©ÎãàÎã§.</span>
                    <div style="display:flex;gap:8px;">
                        <button type="button" id="btnSmartCancel" class="btn btn-ghost btn-small">
                            Ï∑®ÏÜå
                        </button>
                        <button type="submit" class="btn btn-primary btn-small">
                            <span class="icon">ü§ñ</span> AI Î∂ÑÏÑù¬∑Îì±Î°ù
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ -->
    <div id="deepModalBackdrop" class="modal-backdrop">
        <div class="deep-modal">
            <div class="deep-modal-header">
                <div class="deep-modal-title-row">
                    <div>
                        <div id="deepTitle" class="deep-modal-title">Í≥µÍ≥†Î™Ö</div>
                        <div id="deepBadges" class="deep-badges"></div>
                    </div>
                    <button id="deepCloseBtn" class="btn btn-ghost deep-modal-close-btn">Îã´Í∏∞</button>
                </div>
                <div id="deepMetaLine" style="font-size:11px;color:var(--text-soft);margin-top:4px;"></div>
            </div>

            <div class="deep-modal-body">
                <section>
                    <div class="deep-section-title">ÏöîÏïΩ</div>
                    <div id="deepSummary" class="deep-summary-text"></div>
                </section>

                <section>
                    <div class="deep-section-title">Í∏àÏï°/Í∏∞Í∞Ñ (AI Ï∂îÏ†ï Ìè¨Ìï®)</div>
                    <div class="deep-grid-3">
                        <div>
                            <div class="deep-grid-item-label">Ïö©Ïó≠Í∏∞Í∞Ñ / Í≥µÏÇ¨Í∏∞Í∞Ñ</div>
                            <div id="deepPeriod" class="deep-grid-item-value">-</div>
                        </div>
                        <div>
                            <div class="deep-grid-item-label">Ïö©Ïó≠(Í≥ÑÏïΩ) Í∏àÏï°</div>
                            <div id="deepAmount" class="deep-grid-item-value">-</div>
                        </div>
                        <div>
                            <div class="deep-grid-item-label">Ï¥ù ÏÇ¨ÏóÖÎπÑ</div>
                            <div id="deepBudget" class="deep-grid-item-value">-</div>
                        </div>
                    </div>
                </section>

                <section>
                    <div class="deep-section-title">Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏</div>
                    <ul id="deepCheckpoints" class="deep-checkpoints"></ul>
                </section>

                <section>
                    <div class="deep-section-title">Ï≤®Î∂ÄÌååÏùº</div>
                    <div class="deep-attachments-box">
                        <div id="deepAttachmentsEmpty">Ï≤®Î∂ÄÌååÏùº Ï†ïÎ≥¥Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.</div>
                        <ul id="deepAttachmentsList" class="deep-attachments-list"></ul>
                        <div id="deepAttachmentsNote" style="margin-top:4px;font-size:11px;color:var(--text-soft);display:none;">
                            ‚Äª ÎÇòÎùºÏû•ÌÑ∞ ÏõêÎ¨∏ ÌéòÏù¥ÏßÄÏóêÏÑú ÎèôÏùº ÌååÏùºÎ™ÖÏùÑ Ï∞æÏïÑ Îã§Ïö¥Î°úÎìúÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.
                        </div>
                    </div>
                </section>

                <section>
                    <div class="deep-section-title">ÌïúÍµ≠ÏàòÏïà ÎåÄÏùë Ï†úÏïà</div>
                    <div id="deepSuggestion" class="deep-summary-text"></div>
                </section>

                <section>
                    <div class="deep-section-title">Í≥µÍ≥†Î≤àÌò∏ / ÏõêÎ¨∏ ÎßÅÌÅ¨</div>
                    <div id="deepFooterInfo" style="font-size:11px;color:var(--text-soft);"></div>
                </section>
            </div>

            <div class="deep-footer">
                <div id="deepRisk" style="font-weight:500;"></div>
                <button id="deepOkBtn" class="btn btn-primary btn-small">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!-- Ï†ÑÏó≠ Î°úÎî© -->
    <div id="globalLoading" class="loading-overlay">
        <div class="loading-box">
            <div class="spinner-lg"></div>
            <div>
                <div id="globalLoadingText" class="loading-text-main">Î∂ÑÏÑù Ï§ë...</div>
                <div class="loading-text-sub">Ïû†ÏãúÎßå Í∏∞Îã§Î¶¨ÏãúÎ©¥ Í≤∞Í≥ºÍ∞Ä Ï†ïÎ¶¨Îê©ÎãàÎã§.</div>
            </div>
        </div>
    </div>

    <script>
        // ‚òÖ‚òÖ‚òÖ Apps Script WebApp URL ‚òÖ‚òÖ‚òÖ
        const API_BASE =
            'https://script.google.com/macros/s/AKfycbxi0Bfdty9LuMJyxCGTqTkyJQJrevz3AqRunbhNmePCh68tta-Fu8w1Lw4E_DROWB99zw/exec';

        // ‚òÖ‚òÖ‚òÖ Google Client ID ‚òÖ‚òÖ‚òÖ
        const CLIENT_ID =
            '1049915608396-i3jn8jrm24bc9mkagdtokk3rfa3li513.apps.googleusercontent.com';

        // ‚òÖ‚òÖ‚òÖ Target Calendar ID ‚òÖ‚òÖ‚òÖ
        const TARGET_CALENDAR_ID =
            'd51a10e0014dcbd83e98d0da91cda4f52f629c19652c15fc693ee4529bbbab04@group.calendar.google.com';

        // ÌÜ†ÌÅ∞ localStorage ÌÇ§
        const STORAGE_KEY_TOKEN = 'koreasuan_calendar_token';
        const STORAGE_KEY_EXP = 'koreasuan_calendar_token_exp';

        let allData = [];
        let filterMode = 'all';

        let tokenClient = null;
        let accessToken = null;

        window.addEventListener('load', () => {
            bindUI();
            loadData();
            initGoogle();
        });

        // ---------------- Í≥µÌÜµ Helper ----------------

        // ÎßÅÌÅ¨ Ï†ïÍ∑úÌôî: ÏõêÎ¨∏ URL(originUrl)ÏùÑ ÏµúÏö∞ÏÑ† ÏÇ¨Ïö©
        function normalizeLink(item) {
            const cand =
                (item.originUrl ||
                    item.link ||
                    item.srcUrl ||
                    item.detailUrl ||
                    item.url ||
                    '').toString().trim();
            if (!cand) return '';
            if (!/^https?:\/\//i.test(cand)) return '';
            return cand;
        }

        // Ï†úÎ™© Ï†ïÍ∑úÌôî: ÏõêÎ¨∏ Ï†úÎ™©(rawTitle) Ïö∞ÏÑ† (AIÍ∞Ä Î∞îÍæº Ï†úÎ™©ÏùÄ ÏÇ¨Ïö© X)
        function normalizeTitle(item) {
            return (
                item.rawTitle ||      // Ïô∏Î∂ÄÏÇ¨Ïù¥Ìä∏ ÏõêÎ¨∏ Ï†úÎ™©
                item.title ||         // Í∏∞Î≥∏ Ï†úÎ™©
                item.subject ||       // Í∏∞ÌÉÄ ÌïÑÎìú
                ''
            );
        }

        // ---------------- Google Î°úÍ∑∏Ïù∏/Î°úÍ∑∏ÏïÑÏõÉ & UI ----------------

        function updateLoginUI(connected) {
            const btn = document.getElementById('btnLogin');
            const lbl = document.getElementById('btnLoginLabel');
            const dot = document.getElementById('loginStatusDot');
            const text = document.getElementById('loginStatusText');
            if (!btn || !lbl || !dot || !text) return;

            if (connected) {
                lbl.textContent = 'Î°úÍ∑∏ÏïÑÏõÉ';
                btn.disabled = false;
                dot.classList.add('connected');
                text.textContent = 'Ï∫òÎ¶∞Îçî Ïó∞ÎèôÎê®';
            } else {
                lbl.textContent = 'Î°úÍ∑∏Ïù∏';
                btn.disabled = false;
                dot.classList.remove('connected');
                text.textContent = 'Ï∫òÎ¶∞Îçî ÎØ∏Ïó∞Îèô';
            }
        }

        function saveToken(token, expiresInSec) {
            if (!token) {
                localStorage.removeItem(STORAGE_KEY_TOKEN);
                localStorage.removeItem(STORAGE_KEY_EXP);
                return;
            }
            const exp = Date.now() + (expiresInSec || 3600) * 1000;
            localStorage.setItem(STORAGE_KEY_TOKEN, token);
            localStorage.setItem(STORAGE_KEY_EXP, String(exp));
        }

        function loadSavedTokenIfValid() {
            const t = localStorage.getItem(STORAGE_KEY_TOKEN);
            const exp = parseInt(localStorage.getItem(STORAGE_KEY_EXP) || '0', 10);
            if (t && exp && exp > Date.now()) {
                accessToken = t;
                updateLoginUI(true);
            } else {
                accessToken = null;
                saveToken(null);
                updateLoginUI(false);
            }
        }

        function initGoogle() {
            if (!window.google || !google.accounts || !google.accounts.oauth2) {
                return;
            }

            // Í∏∞Ï°¥ ÌÜ†ÌÅ∞ Î≥µÍµ¨
            loadSavedTokenIfValid();

            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/calendar.events',
                callback: (resp) => {
                    if (resp.error) {
                        alert('Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + resp.error);
                        return;
                    }
                    if (resp.access_token) {
                        accessToken = resp.access_token;
                        saveToken(resp.access_token, resp.expires_in);
                        updateLoginUI(true);
                    }
                }
            });

            const btnLogin = document.getElementById('btnLogin');
            btnLogin.onclick = () => {
                // Ïù¥ÎØ∏ Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÎ©¥ ‚Üí Î°úÍ∑∏ÏïÑÏõÉ
                if (accessToken) {
                    const tokenToRevoke = accessToken;
                    accessToken = null;
                    saveToken(null);
                    updateLoginUI(false);
                    if (google.accounts.oauth2.revoke) {
                        google.accounts.oauth2.revoke(tokenToRevoke, () => { });
                    }
                    return;
                }
                // Î°úÍ∑∏Ïù∏ ÏãúÎèÑ
                tokenClient.requestAccessToken({ prompt: '' });
            };
        }

        // ---------------- Í≥µÌÜµ UI & Îç∞Ïù¥ÌÑ∞ Î°úÎìú ----------------

        function bindUI() {
            document.getElementById('btnRefresh').addEventListener('click', refreshAll);
            document.getElementById('btnExternal').addEventListener('click', externalUpdate);
            document.getElementById('searchInput').addEventListener('input', applyFilter);
            document.getElementById('filterRegion').addEventListener('change', applyFilter);

            // chip ÌÅ¥Î¶≠
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    filterMode = chip.dataset.rel || 'all';
                    applyFilter();
                });
            });

            // Î™®Îã¨ Í¥ÄÎ†®
            document.getElementById('btnSmartAddOpen').addEventListener('click', openSmartModal);
            document.getElementById('btnSmartClose').addEventListener('click', closeSmartModal);
            document.getElementById('btnSmartCancel').addEventListener('click', closeSmartModal);
            document.getElementById('smartModalBackdrop').addEventListener('click', e => {
                if (e.target.id === 'smartModalBackdrop') closeSmartModal();
            });
            document.getElementById('smartForm').addEventListener('submit', handleSmartSubmit);

            // Deep modal
            document.getElementById('deepModalBackdrop').addEventListener('click', e => {
                if (e.target.id === 'deepModalBackdrop') closeDeepModal();
            });
            document.getElementById('deepCloseBtn').addEventListener('click', closeDeepModal);
            document.getElementById('deepOkBtn').addEventListener('click', closeDeepModal);
        }

        function setGlobalLoading(on, msg) {
            const ol = document.getElementById('globalLoading');
            const txt = document.getElementById('globalLoadingText');
            const ring = document.getElementById('donutRing');
            if (!ol) return;
            ol.classList.toggle('active', !!on);
            if (msg) txt.textContent = msg;
            if (ring) ring.style.animationPlayState = on ? 'running' : 'paused';
        }

        async function loadData() {
            const list = document.getElementById('bidList');

            // üî∏ Î°úÎî© Ï§ë ÏïàÎÇ¥ + Ïä§ÌîºÎÑà
            list.innerHTML =
                '<div class="loading-inline">' +
                '<div class="spinner-inline"></div>' +
                '<div>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>' +
                '</div>';

            try {
                const res = await fetch(API_BASE);
                const json = await res.json();
                allData = json.items || [];
                updateStatsUI(json.stats || {}, allData);
                applyFilter();
            } catch (e) {
                list.innerHTML =
                    '<div style="font-size:12px; color:#e17055; padding:20px;">Î°úÎìú Ïã§Ìå®: ' +
                    e.message +
                    '</div>';
            }
        }

        async function refreshAll() {
            const btn = document.getElementById('btnRefresh');
            btn.classList.add('loading');
            try {
                setGlobalLoading(true, 'ÎÇòÎùºÏû•ÌÑ∞ API Ïû¨Ï°∞Ìöå Î∞è AI ÌïÑÌÑ∞ÎßÅ Ï§ë...');
                await fetch(API_BASE + '?action=updateAll');
                await loadData();
            } catch (e) {
                alert('Ïò§Î•ò: ' + e.message);
            } finally {
                btn.classList.remove('loading');
                setGlobalLoading(false);
            }
        }

        // Ïô∏Î∂ÄÏõ® ÏàòÏßë Î≤ÑÌäº Ìò∏Ï∂ú Ìï®Ïàò
        async function externalUpdate() {
            const btn = document.getElementById('btnExternal');
            btn.classList.add('loading');
            try {
                setGlobalLoading(true, 'Ïô∏Î∂Ä ÏÜåÏä§ ÏàòÏßë Ï§ë...');
                const res = await fetch(API_BASE + '?action=external_update');
                const json = await res.json();
                alert(`Ïã†Í∑ú ${json.added}Í±¥ ÏàòÏßë ÏôÑÎ£å`);
                await loadData();
            } catch (e) {
                alert('Ïò§Î•ò: ' + e.message);
            } finally {
                btn.classList.remove('loading');
                setGlobalLoading(false);
            }
        }

        // ---------------- ÏÉÅÌÉú/Ï∂úÏ≤ò ÌåêÎ≥Ñ ----------------

        // ÎßàÍ∞êÏùº ÏßÄÎÇú Ïó¨Î∂Ä (ÎÇ†Ïßú+ÏãúÍ∞Ñ Í∏∞Ï§Ä, ÏßÄÎÇòÍ∏∞ Ï†ÑÍπåÏßÄÎäî Ïú†ÏßÄ)
        function isDeadlinePast(deadlineStr) {
            if (!deadlineStr) return false;

            const s = String(deadlineStr).trim();
            const dateMatch = s.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
            if (!dateMatch) return false; // ÌååÏã± Ïïà ÎêòÎ©¥ Ïà®Í∏∞ÏßÄ ÏïäÏùå

            const y = parseInt(dateMatch[1], 10);
            const mo = parseInt(dateMatch[2], 10) - 1;
            const d = parseInt(dateMatch[3], 10);

            // ÏãúÍ∞Ñ Ï†ïÎ≥¥ (HH:mm) ÏûàÏúºÎ©¥ Í∞ôÏù¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∑∏ÎÇ† 23:59:59ÍπåÏßÄ ÌëúÏãú
            const timeMatch = s.match(/(\d{1,2}):(\d{2})/);
            let hh = 23, mm = 59;
            if (timeMatch) {
                hh = parseInt(timeMatch[1], 10);
                mm = parseInt(timeMatch[2], 10);
            }

            const deadline = new Date(y, mo, d, hh, mm, 59);
            const now = new Date();

            return now.getTime() > deadline.getTime();
        }

        // Ï∂úÏ≤ò ÌåêÎ≥Ñ: ÎÇòÎùºÏû•ÌÑ∞(API) vs Ïô∏Î∂Ä
        function detectSource(item) {
            const no = String(item.no || '');
            const link = normalizeLink(item);
            if (/^R\d/i.test(no)) return 'API';
            if (link.includes('g2b.go.kr')) return 'API';
            return 'EXTERNAL';
        }

        function updateStatsUI(stats, items) {
            const totalRaw = stats.totalCountRaw || stats.totalItemsFromApi || 0;
            const elTotal = document.getElementById('statTotalRaw');
            const elFiltered = document.getElementById('statFiltered');
            const elAi = document.getElementById('statAi');

            if (elTotal) elTotal.textContent = totalRaw.toLocaleString();
            if (elFiltered)
                elFiltered.textContent =
                    (stats.totalKept || items.length || 0).toLocaleString();
            if (elAi) elAi.textContent = (stats.totalAiCalls || 0).toLocaleString();

            if (document.getElementById('statPeriod')) {
                document.getElementById('statPeriod').textContent =
                    `Í∏∞Í∞Ñ: ÏµúÍ∑º ${stats.daysBack || 7}Ïùº`;
            }
            if (document.getElementById('statLastUpdate')) {
                document.getElementById('statLastUpdate').textContent =
                    `Last: ${stats.finishedAtText || '-'}`;
            }

            // Donut ÌöåÏ†Ñ ÏÜçÎèÑ
            let highOrMid = 0;
            items.forEach(it => {
                if (/\[(ÏÉÅ|Ï§ë)\]/.test(it.aiResult || '')) highOrMid++;
            });
            const ratio = items.length ? highOrMid / items.length : 0;
            const ring = document.getElementById('donutRing');
            if (ring) {
                ring.style.animationDuration = Math.max(4, 10 - ratio * 6) + 's';
            }

            // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Î°úÍ∑∏
            let apiCount = 0, externalCount = 0;
            items.forEach(it => {
                if (detectSource(it) === 'API') apiCount++;
                else externalCount++;
            });
            console.log(
                `[Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ] ÏõêÎ≥∏:${totalRaw} / ÏãúÌä∏:${items.length} (API:${apiCount}, Ïô∏Î∂Ä:${externalCount}) ` +
                `/ ÌïÑÌÑ∞ÌÜµÍ≥º:${stats.totalKept || items.length} / AIÏöîÏïΩ:${stats.totalAiCalls || 0}`
            );
        }

        // ÌòÑÏû¨ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî Í±¥Ïàò Î∞òÏòÅ
        function updateVisibleCount(visibleItems) {
            const n = visibleItems.length || 0;
            const statApiEl = document.getElementById('statApi');
            const donutMainEl = document.getElementById('donutMain');
            if (statApiEl) statApiEl.textContent = n.toLocaleString();
            if (donutMainEl) donutMainEl.textContent = n.toLocaleString();

            const resultBreakdownEl = document.getElementById('resultBreakdown');
            if (resultBreakdownEl) {
                let apiCount = 0, externalCount = 0;
                visibleItems.forEach(it => {
                    if (detectSource(it) === 'API') apiCount++;
                    else externalCount++;
                });
                resultBreakdownEl.textContent = `API ${apiCount} / Ïô∏Î∂Ä ${externalCount}`;
            }
        }

        // ---------------- ÌïÑÌÑ∞ Ï†ÅÏö© ----------------

        function applyFilter() {
            const kw = document.getElementById('searchInput')
                .value.trim()
                .toLowerCase();
            const region = document.getElementById('filterRegion').value.trim();

            const filtered = allData.filter(item => {
                const title = normalizeTitle(item);
                const link = normalizeLink(item);
                const aiText = item.aiResult || '';

                // ‚ë† ÎßàÍ∞êÏùº ÏßÄÎÇú Í≥µÍ≥†Îäî Ïà®ÍπÄ (ÏÇ≠Ï†úX)
                //if (isDeadlinePast(item.deadline)) return false;
                // Ï£ºÏÑù Ï≤òÎ¶¨Î°ú ÎßàÍ∞ê Ïó¨Î∂ÄÏôÄ ÏÉÅÍ¥Ä ÏóÜÏù¥ ÏùºÎã® Î¶¨Ïä§Ìä∏Ïóê Î≥¥Ïù¥Í≤å Îë†(ÎßàÍ∞ê Î±ÉÏßÄ Ï∂îÍ∞Ä).

                // ‚ë° ÏßÄÏó≠ ÌïÑÌÑ∞
                if (region && (!item.region || item.region.indexOf(region) === -1))
                    return false;

                // ‚ë¢ Í¥ÄÎ†®ÏÑ± ÌïÑÌÑ∞
                let relFlag = 'low';
                if (/\[.*ÏÉÅ.*\]/.test(aiText) || /Í¥ÄÎ†®ÏÑ± ÏÉÅ/.test(aiText)) relFlag = 'high';
                else if (/\[.*Ï§ë.*\]/.test(aiText) || /Í¥ÄÎ†®ÏÑ± Ï§ë/.test(aiText)) relFlag = 'mid';

                if (filterMode === 'high' && relFlag !== 'high') return false;
                if (filterMode === 'mid' && relFlag === 'low') return false;

                // ‚ë£ ÌÇ§ÏõåÎìú Í≤ÄÏÉâ
                if (kw) {
                    const blob = (
                        title +
                        ' ' + (item.client || '') +
                        ' ' + (item.agency || '') +
                        ' ' + aiText +
                        ' ' + link
                    ).toLowerCase();
                    if (blob.indexOf(kw) === -1) return false;
                }

                return true;
            });

            console.log(
                `[ÌïÑÌÑ∞] Ï†ÑÏ≤¥ ${allData.length}Í±¥ ‚Üí Î≥¥Ïù¥Îäî ${filtered.length}Í±¥` +
                ` (Í≤ÄÏÉâ="${kw}", ÏßÄÏó≠="${region || 'Ï†ÑÏ≤¥'}", Î™®Îìú="${filterMode}")`
            );

            updateVisibleCount(filtered);
            renderList(filtered);
        }

        // ---------------- Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ ----------------

        function renderList(data) {
            const list = document.getElementById('bidList');
            list.innerHTML = '';
            document.getElementById('resultCount').textContent = data.length;

            if (!data.length) {
                list.innerHTML =
                    '<div style="padding:20px;color:#b2bec3;font-size:12px;">Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÎäî Í≥µÍ≥†Í∞Ä ÏóÜÏäµÎãàÎã§. ÌïÑÌÑ∞Î•º Ï°∞Ï†ïÌï¥ Î≥¥ÏÑ∏Ïöî.</div>';
                return;
            }

            data.forEach((item, index) => {
                const source = detectSource(item); // 'API' or 'EXTERNAL'
                const title = normalizeTitle(item) || '(Ï†úÎ™© ÏóÜÏùå)';
                const link = normalizeLink(item);

                const region = item.region || item.area || '';
                const no = item.no || item.bidNo || '';
                const client = item.client || item.agency || '';
                const regDate = item.regDate || item.noticeDate || '';
                const deadline = item.deadline || item.closeDate || '';
                const openDate = item.openDate || item.openingDate || '';
                const amount = item.amount || item.budget || '';
                const bizType = item.bizType || item.field || item.jobType || '';
                const manualTag = item.manualTag || '';

                // AI ÌïÑÎìúÎäî "Í¥ÄÎ†®ÏÑ±¬∑ÏöîÏïΩ"Îßå, ÏõêÎ≥∏ ÌïÑÎìú(Ï†úÎ™©/URL Îì±)Îäî ÏÜêÎåÄÏßÄ ÏïäÏùå
                const aiText = item.aiResult || '';
                const aiSummary = item.aiSummary || '';
                const relMatchHigh = /\[.*ÏÉÅ.*\]/.test(aiText) || /Í¥ÄÎ†®ÏÑ± ÏÉÅ/.test(aiText);
                const relMatchMid = /\[.*Ï§ë.*\]/.test(aiText) || /Í¥ÄÎ†®ÏÑ± Ï§ë/.test(aiText);
                let relLabel = 'Í¥ÄÎ†®ÏÑ± Ìïò';
                if (relMatchHigh) relLabel = 'Í¥ÄÎ†®ÏÑ± ÏÉÅ';
                else if (relMatchMid) relLabel = 'Í¥ÄÎ†®ÏÑ± Ï§ë';

                const card = document.createElement('article');
                card.className = 'bid-card';

                const inner = document.createElement('div');
                inner.className = 'bid-card-inner';

                // ÏÉÅÎã® Ìñâ
                const topRow = document.createElement('div');
                topRow.className = 'bid-top-row';

                const leftTop = document.createElement('div');
                leftTop.style.display = 'flex';
                leftTop.style.alignItems = 'center';
                leftTop.style.gap = '6px';
                if (region) {
                    const badgeRegion = document.createElement('span');
                    badgeRegion.className = 'badge-region';
                    badgeRegion.textContent = region;
                    leftTop.appendChild(badgeRegion);
                }
                if (no) {
                    const bidNoSpan = document.createElement('span');
                    bidNoSpan.className = 'bid-no';
                    bidNoSpan.textContent = '#' + no;
                    leftTop.appendChild(bidNoSpan);
                }
                topRow.appendChild(leftTop);

                const rightTop = document.createElement('div');
                rightTop.style.display = 'flex';
                rightTop.style.alignItems = 'center';
                rightTop.style.gap = '6px';

                // ÏÉÅÌÉú Î±ÉÏßÄ: ÎßàÍ∞ê/Í≥µÍ≥†Ï§ë
                const statusBadge = document.createElement('span');
                statusBadge.className = 'badge-status';
                const past = isDeadlinePast(deadline);
                if (past) {
                    statusBadge.classList.add('closed');
                    statusBadge.textContent = 'ÎßàÍ∞ê';
                } else {
                    statusBadge.classList.add('open');
                    statusBadge.textContent = 'Í≥µÍ≥†Ï§ë';
                }
                rightTop.appendChild(statusBadge);

                // Ï∂úÏ≤ò Î±ÉÏßÄ
                const sourceBadge = document.createElement('span');
                sourceBadge.className = 'badge-source';
                sourceBadge.textContent = source === 'API' ? 'ÎÇòÎùºÏû•ÌÑ∞ API' : 'Ïô∏Î∂ÄÏàòÏßë';
                rightTop.appendChild(sourceBadge);

                // ÏàòÎèô ÌÉúÍ∑∏ ÏûàÏúºÎ©¥ ÌëúÏãú
                if (manualTag) {
                    const manualBadge = document.createElement('span');
                    manualBadge.className = 'badge-status manual';
                    manualBadge.textContent = manualTag;
                    rightTop.appendChild(manualBadge);
                }

                topRow.appendChild(rightTop);
                inner.appendChild(topRow);

                // Ï†úÎ™©
                const h3 = document.createElement('h3');
                h3.className = 'bid-title';
                h3.textContent = title;
                inner.appendChild(h3);

                // ÏÑúÎ∏åÎùºÏù∏
                const subLine = document.createElement('div');
                subLine.className = 'bid-subline';

                if (client) {
                    const spanClient = document.createElement('span');
                    spanClient.textContent = client;
                    subLine.appendChild(spanClient);
                }
                if (bizType) {
                    const spanType = document.createElement('span');
                    spanType.textContent = bizType;
                    subLine.appendChild(spanType);
                }
                if (relLabel) {
                    const spanRel = document.createElement('span');
                    spanRel.textContent = relLabel;
                    subLine.appendChild(spanRel);
                }
                inner.appendChild(subLine);

                // Î©îÌÉÄ Í∑∏Î¶¨Îìú
                const metaGrid = document.createElement('div');
                metaGrid.className = 'bid-meta-grid';

                const metaItems = [
                    { label: 'Í≥µÍ≥†Ïùº', value: regDate },
                    { label: 'ÏûÖÏ∞∞ ÎßàÍ∞ê', value: deadline },
                    { label: 'Í∞úÏ∞∞ ÏòàÏ†ï', value: openDate },
                    { label: 'Ï∂îÏ†ï(Í≥ÑÏïΩ) Í∏àÏï°', value: amount },
                    { label: 'Ï∂úÏ≤ò', value: source === 'API' ? 'ÎÇòÎùºÏû•ÌÑ∞' : 'Ïô∏Î∂ÄÏÇ¨Ïù¥Ìä∏' },
                    { label: 'ÏàúÎ≤à', value: (index + 1).toString() }
                ];

                metaItems.forEach(m => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'bid-meta-item';
                    const lab = document.createElement('div');
                    lab.className = 'meta-label';
                    lab.textContent = m.label;
                    const val = document.createElement('div');
                    val.className = 'meta-value';
                    val.textContent = m.value || '-';
                    itemDiv.appendChild(lab);
                    itemDiv.appendChild(val);
                    metaGrid.appendChild(itemDiv);
                });

                inner.appendChild(metaGrid);

                // AI ÏöîÏïΩ Î∞ïÏä§: AIÎäî "ÎÇ¥Ïö© ÏöîÏïΩ"Í≥º "Í¥ÄÎ†®ÏÑ± ÏÑ§Î™Ö"Îßå ÌëúÏãú
                if (aiText || aiSummary) {
                    const aiBox = document.createElement('div');
                    aiBox.className = 'ai-result-box';

                    const icon = document.createElement('div');
                    icon.className = 'ai-result-icon';
                    icon.textContent = 'ü§ñ';
                    aiBox.appendChild(icon);

                    const textWrap = document.createElement('div');
                    textWrap.className = 'ai-result-text';

                    if (aiSummary) {
                        const strong = document.createElement('strong');
                        strong.textContent = aiSummary;
                        textWrap.appendChild(strong);
                    }
                    if (aiText) {
                        if (aiSummary) textWrap.appendChild(document.createElement('br'));
                        const span = document.createElement('span');
                        span.textContent = aiText;
                        textWrap.appendChild(span);
                    }

                    aiBox.appendChild(textWrap);
                    inner.appendChild(aiBox);
                }

                // footer Î≤ÑÌäºÎì§
                const footer = document.createElement('div');
                footer.className = 'bid-footer-row';

                const leftFoot = document.createElement('div');
                leftFoot.textContent = link
                    ? 'ÏõêÎ¨∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏó¨ ÏÑ∏Î∂ÄÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.'
                    : 'ÏõêÎ¨∏ URL Ï†ïÎ≥¥ ÏóÜÏùå';

                const btnBox = document.createElement('div');
                btnBox.className = 'bid-buttons';

                // 2Ï∞® ÏÉÅÏÑ∏Î∂ÑÏÑù Î≤ÑÌäº
                const btnDeep = document.createElement('button');
                btnDeep.type = 'button';
                btnDeep.className = 'btn btn-ghost btn-small';
                btnDeep.textContent = '2Ï∞® ÏÉÅÏÑ∏Î∂ÑÏÑù';
                btnDeep.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openDeepModal(item);
                });
                btnBox.appendChild(btnDeep);

                // ÏùºÏ†ï Îì±Î°ù Î≤ÑÌäº (Ï∫òÎ¶∞Îçî Ïó∞Îèô ÏÇ¨Ïö©)
                const btnCalendar = document.createElement('button');
                btnCalendar.type = 'button';
                btnCalendar.className = 'btn btn-ghost btn-small';
                btnCalendar.textContent = 'ÏùºÏ†ï Îì±Î°ù';
                btnCalendar.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    await createCalendarEventForBid(item);
                });
                btnBox.appendChild(btnCalendar);

                // ÏõêÎ¨∏ Î≥¥Í∏∞ Î≤ÑÌäº
                if (link) {
                    const btnView = document.createElement('a');
                    btnView.href = link;
                    btnView.target = '_blank';
                    btnView.rel = 'noreferrer noopener';
                    btnView.className = 'btn btn-ghost btn-small btn-link';
                    btnView.textContent = 'ÏõêÎ¨∏ Ïó¥Í∏∞';
                    btnBox.appendChild(btnView);
                }

                footer.appendChild(leftFoot);
                footer.appendChild(btnBox);

                inner.appendChild(footer);

                card.appendChild(inner);
                list.appendChild(card);
            });
        }

        // ---------------- Ïä§ÎßàÌä∏ Îì±Î°ù Î™®Îã¨ ----------------

        function openSmartModal() {
            document.getElementById('smartModalBackdrop').classList.add('active');
        }

        function closeSmartModal() {
            document.getElementById('smartModalBackdrop').classList.remove('active');
        }

        async function handleSmartSubmit(e) {
            e.preventDefault();
            const text = document.getElementById('smartText').value.trim();
            const urlRaw = document.getElementById('smartUrl').value.trim();

            if (!text && !urlRaw) {
                alert('Î≥∏Î¨∏ ÌÖçÏä§Ìä∏ ÎòêÎäî URL Ï§ë ÌïòÎÇòÎäî ÏûÖÎ†•Ìï¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }

            // ÏÑúÎ≤ÑÎäî fileUrl ÌïòÎÇòÏùò Î¨∏ÏûêÏó¥ÏùÑ Î∞õÏïÑÏÑú ÎÇ¥Î∂ÄÏóêÏÑú Ï§ÑÎ∞îÍøà/ÏâºÌëúÎ°ú Îã§Ïãú ÎÇòÎàïÎãàÎã§.
            const payload = {
                action: 'smart_add',
                text: text,
                fileUrl: urlRaw
            };

            const submitBtn = e.target.querySelector('button[type="submit"]');
            if (submitBtn) submitBtn.classList.add('loading');

            try {
                setGlobalLoading(true, 'AIÍ∞Ä ÌÖçÏä§Ìä∏Î•º Î∂ÑÏÑùÌïòÏó¨ Ìïú ÌñâÏúºÎ°ú Ï†ïÎ¶¨ Ï§ëÏûÖÎãàÎã§...');
                const res = await fetch(API_BASE + '?action=smart_add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const json = await res.json();

                if (json && json.result === 'success') {
                    alert('Ïä§ÎßàÌä∏ Îì±Î°ùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
                    closeSmartModal();
                    document.getElementById('smartForm').reset();
                    await loadData();
                } else {
                    console.error('smart_add ÏùëÎãµ:', json);
                    alert('Îì±Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. (ÏÉÅÏÑ∏Îäî ÏΩòÏÜî Ï∞∏Ï°∞)');
                }
            } catch (err) {
                console.error(err);
                alert('ÌÜµÏã† Ïò§Î•ò: ' + err.message);
            } finally {
                if (submitBtn) submitBtn.classList.remove('loading');
                setGlobalLoading(false);
            }
        }

        // ---------------- 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ ----------------

        function openDeepModal(item) {
            const backdrop = document.getElementById('deepModalBackdrop');
            if (!backdrop) return;

            const title = normalizeTitle(item) || '(Ï†úÎ™© ÏóÜÏùå)';
            const source = detectSource(item);
            const link = normalizeLink(item);

            const aiSummary = item.aiSummary || '';
            const region = item.region || '';
            const client = item.client || item.agency || '';
            const deadline = item.deadline || '';
            const amount = item.amount || item.budget || '';
            const period = item.period || '';
            const budget = item.totalBudget || '';

            // ÏÉÅÎã®
            document.getElementById('deepTitle').textContent = title;

            const badgesBox = document.getElementById('deepBadges');
            badgesBox.innerHTML = '';
            if (region) {
                const b = document.createElement('span');
                b.className = 'deep-badge';
                b.textContent = region;
                badgesBox.appendChild(b);
            }
            const bSource = document.createElement('span');
            bSource.className = 'deep-badge';
            bSource.textContent = source === 'API' ? 'ÎÇòÎùºÏû•ÌÑ∞' : 'Ïô∏Î∂ÄÏàòÏßë';
            badgesBox.appendChild(bSource);

            const aiText = item.aiResult || '';
            const relMatchHigh = /\[.*ÏÉÅ.*\]/.test(aiText) || /Í¥ÄÎ†®ÏÑ± ÏÉÅ/.test(aiText);
            const relMatchMid = /\[.*Ï§ë.*\]/.test(aiText) || /Í¥ÄÎ†®ÏÑ± Ï§ë/.test(aiText);
            if (relMatchHigh) {
                const b = document.createElement('span');
                b.className = 'deep-badge primary';
                b.textContent = 'Í¥ÄÎ†®ÏÑ± ÏÉÅ';
                badgesBox.appendChild(b);
            } else if (relMatchMid) {
                const b = document.createElement('span');
                b.className = 'deep-badge warn';
                b.textContent = 'Í¥ÄÎ†®ÏÑ± Ï§ë';
                badgesBox.appendChild(b);
            } else {
                const b = document.createElement('span');
                b.className = 'deep-badge';
                b.textContent = 'Í¥ÄÎ†®ÏÑ± Ìïò';
                badgesBox.appendChild(b);
            }

            document.getElementById('deepMetaLine').textContent =
                [client, deadline].filter(Boolean).join(' ¬∑ ');

            // ÏöîÏïΩ/Ï†úÏïà ÌÖçÏä§Ìä∏
            document.getElementById('deepSummary').textContent =
                aiSummary || 'ÏöîÏïΩ Ï†ïÎ≥¥Í∞Ä ÏïÑÏßÅ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';

            document.getElementById('deepSuggestion').textContent =
                item.aiSuggestion || 'ÌïúÍµ≠ÏàòÏïà ÎåÄÏùë Ï†úÏïàÏù¥ ÏïÑÏßÅ Îì±Î°ùÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';

            // Í∏àÏï°/Í∏∞Í∞Ñ
            document.getElementById('deepPeriod').textContent = period || deadline || '-';
            document.getElementById('deepAmount').textContent = amount || '-';
            document.getElementById('deepBudget').textContent = budget || '-';

            // Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏
            const checkpoints = document.getElementById('deepCheckpoints');
            checkpoints.innerHTML = '';
            const checklist =
                item.aiCheckpoints ||
                item.checkpoints ||
                [];
            if (Array.isArray(checklist) && checklist.length) {
                checklist.forEach(c => {
                    const li = document.createElement('li');
                    li.textContent = c;
                    checkpoints.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'ÏïÑÏßÅ Î≥ÑÎèÑÏùò Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏Í∞Ä Ï†ïÎ¶¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                checkpoints.appendChild(li);
            }

            // Ï≤®Î∂ÄÌååÏùº
            const attachEmpty = document.getElementById('deepAttachmentsEmpty');
            const attachList = document.getElementById('deepAttachmentsList');
            const attachNote = document.getElementById('deepAttachmentsNote');
            attachList.innerHTML = '';

            const attachments = item.attachments || item.files || [];
            if (Array.isArray(attachments) && attachments.length) {
                attachEmpty.style.display = 'none';
                attachNote.style.display = 'block';
                attachments.forEach(a => {
                    const li = document.createElement('li');
                    const aLink = document.createElement('a');
                    aLink.href = a.url || a.link || link || '#';
                    aLink.target = '_blank';
                    aLink.rel = 'noreferrer noopener';
                    aLink.textContent = a.name || a.fileName || a.url || 'Ï≤®Î∂ÄÌååÏùº';
                    li.appendChild(aLink);
                    attachList.appendChild(li);
                });
            } else {
                attachEmpty.style.display = 'block';
                attachNote.style.display = 'none';
            }

            // ÌïòÎã® Ï†ïÎ≥¥
            const deepFooterInfo = document.getElementById('deepFooterInfo');
            const bidNo = item.no || item.bidNo || '';
            const parts = [];
            if (bidNo) parts.push(`Í≥µÍ≥†Î≤àÌò∏: ${bidNo}`);
            if (link) {
                const span = document.createElement('span');
                span.innerHTML =
                    `ÏõêÎ¨∏: <a href="${link}" target="_blank" rel="noreferrer noopener">ÌéòÏù¥ÏßÄ Ïó¥Í∏∞</a>`;
                deepFooterInfo.innerHTML = parts.join(' ¬∑ ') +
                    (parts.length ? ' ¬∑ ' : '') +
                    span.outerHTML;
            } else {
                deepFooterInfo.textContent =
                    parts.join(' ¬∑ ') || 'Í≥µÍ≥†Î≤àÌò∏/ÏõêÎ¨∏ ÎßÅÌÅ¨ Ï†ïÎ≥¥ ÏóÜÏùå';
            }

            // ÏúÑÌóòÎèÑ / Î¶¨Ïä§ÌÅ¨
            const deepRisk = document.getElementById('deepRisk');
            deepRisk.textContent = item.aiRisk || 'Î¶¨Ïä§ÌÅ¨ Î∂ÑÏÑù Ï†ïÎ≥¥ ÏóÜÏùå';

            backdrop.classList.add('active');
        }

        function closeDeepModal() {
            document.getElementById('deepModalBackdrop').classList.remove('active');
        }

        // ---------------- Google Calendar ÏùºÏ†ï Îì±Î°ù ----------------

        async function createCalendarEventForBid(item) {
            if (!accessToken) {
                alert('Î®ºÏ†Ä ÏÉÅÎã®Ïùò Î°úÍ∑∏Ïù∏ Î≤ÑÌäºÏúºÎ°ú Google Í≥ÑÏ†ï Ïó∞ÎèôÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const title = normalizeTitle(item) || '(Ï†úÎ™© ÏóÜÏùå)';
            const deadlineStr = item.deadline || '';
            if (!deadlineStr) {
                alert('ÎßàÍ∞êÏùº Ï†ïÎ≥¥Í∞Ä ÏóÜÏñ¥ ÏùºÏ†ïÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const s = String(deadlineStr).trim();
            const dateMatch = s.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
            if (!dateMatch) {
                alert('ÎßàÍ∞êÏùº ÌòïÏãùÏùÑ Ìï¥ÏÑùÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§: ' + deadlineStr);
                return;
            }
            const y = parseInt(dateMatch[1], 10);
            const mo = parseInt(dateMatch[2], 10) - 1;
            const d = parseInt(dateMatch[3], 10);

            const timeMatch = s.match(/(\d{1,2}):(\d{2})/);
            let hh = 9, mm = 0; // Í∏∞Î≥∏ 9Ïãú
            if (timeMatch) {
                hh = parseInt(timeMatch[1], 10);
                mm = parseInt(timeMatch[2], 10);
            }

            const start = new Date(y, mo, d, hh, mm);
            const end = new Date(y, mo, d, hh + 1, mm); // 1ÏãúÍ∞ÑÏßúÎ¶¨ Î∏îÎ°ù

            const link = normalizeLink(item);
            const descLines = [];
            descLines.push('ÏûÖÏ∞∞ ÎßàÍ∞ê ÏùºÏ†ïÏûÖÎãàÎã§.');
            if (item.client || item.agency) descLines.push('Î∞úÏ£ºÏ≤ò: ' + (item.client || item.agency));
            if (link) descLines.push('ÏõêÎ¨∏: ' + link);

            const event = {
                summary: '[ÏûÖÏ∞∞ÎßàÍ∞ê] ' + title,
                description: descLines.join('\n'),
                start: {
                    dateTime: start.toISOString(),
                    timeZone: 'Asia/Seoul'
                },
                end: {
                    dateTime: end.toISOString(),
                    timeZone: 'Asia/Seoul'
                }
            };

            try {
                setGlobalLoading(true, 'Google CalendarÏóê ÏùºÏ†ïÏùÑ Îì±Î°ù Ï§ëÏûÖÎãàÎã§...');
                const res = await fetch(
                    `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(
                        TARGET_CALENDAR_ID
                    )}/events`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + accessToken,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(event)
                    }
                );

                if (!res.ok) {
                    const errText = await res.text();
                    console.error('Calendar API error:', errText);
                    alert('ÏùºÏ†ï Îì±Î°ù Ïã§Ìå®: ' + res.status);
                    return;
                }

                const data = await res.json();
                console.log('Calendar event created:', data);
                alert('Google CalendarÏóê ÏùºÏ†ïÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.');
            } catch (err) {
                console.error(err);
                alert('ÏùºÏ†ï Îì±Î°ù Ï§ë Ïò§Î•ò: ' + err.message);
            } finally {
                setGlobalLoading(false);
            }
        }
    </script>
</body>
</html>

