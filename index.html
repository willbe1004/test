<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ÌïúÍµ≠ÏàòÏïà AI ÏûÖÏ∞∞Í¥ÄÎ¶¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ‚úÖ Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --bg-main: #050b16;
            --bg-card: #0e1b2a;
            --bg-card-soft: #122538;
            --accent: #ffb83f;
            --accent-soft: rgba(255, 184, 63, 0.15);
            --accent-strong: #ff9f1c;
            --primary: #00c896;
            --primary-soft: rgba(0, 200, 150, 0.15);
            --danger: #ff5c7a;
            --text-main: #f4f7fb;
            --text-soft: #9faec6;
            --border-subtle: #1e3146;
            --shadow-soft: 0 18px 40px rgba(6, 17, 36, 0.85);
            --radius-lg: 18px;
            --radius-xl: 22px;
            --transition-fast: 0.18s ease-out;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
            background: radial-gradient(circle at top, #10213a 0, #050b16 40%, #02030a 70%);
            color: var(--text-main);
            min-height: 100vh;
        }

        .page-shell {
            max-width: 1320px;
            margin: 0 auto;
            padding: 20px 18px 32px;
        }

        /* Ìó§Îçî ------------------------------------------------------- */

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        .app-title-block {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 220px;
        }

        .app-title-main {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

            .app-title-main h1 {
                margin: 0;
                font-size: 22px;
                letter-spacing: 0.04em;
                font-weight: 700;
                color: #f8fbff;
            }

        .badge-version {
            font-size: 11px;
            padding: 4px 9px;
            border-radius: 999px;
            border: 1px solid rgba(0, 200, 150, 0.6);
            color: var(--primary);
            background: radial-gradient(circle at top left, #123d3a, #050b16);
        }

        .app-subtitle {
            font-size: 11px;
            color: var(--text-soft);
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

            .app-subtitle span.dot {
                width: 4px;
                height: 4px;
                border-radius: 50%;
                background: var(--accent);
                box-shadow: 0 0 12px rgba(255, 184, 63, 0.8);
            }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
            flex: 1;
        }

        .btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 7px 14px;
            border-radius: 999px;
            border: 1px solid transparent;
            font-size: 12px;
            color: var(--text-main);
            background: rgba(10, 23, 40, 0.9);
            cursor: pointer;
            transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast);
            white-space: nowrap;
        }

            .btn span.icon {
                font-size: 14px;
            }

        .btn-primary {
            background: linear-gradient(135deg, #00c896, #00e0b0);
            border-color: rgba(0, 0, 0, 0.15);
            color: #061118;
            font-weight: 600;
            box-shadow: 0 10px 24px rgba(0, 200, 150, 0.3);
        }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 14px 32px rgba(0, 200, 150, 0.4);
            }

        .btn-ghost {
            border-color: rgba(255, 255, 255, 0.12);
            background: rgba(7, 16, 28, 0.9);
        }

            .btn-ghost:hover {
                background: rgba(18, 35, 58, 0.9);
                transform: translateY(-1px);
                box-shadow: 0 10px 28px rgba(0, 0, 0, 0.6);
            }

        .btn-danger {
            background: rgba(255, 92, 122, 0.1);
            border-color: rgba(255, 92, 122, 0.5);
            color: #ffbac9;
        }

            .btn-danger:hover {
                background: rgba(255, 92, 122, 0.2);
            }

        .btn-small {
            padding: 5px 10px;
            font-size: 11px;
        }

        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

            .btn.loading::after {
                content: "";
                position: absolute;
                right: 9px;
                width: 14px;
                height: 14px;
                border-radius: 50%;
                border: 2px solid rgba(255, 255, 255, 0.6);
                border-top-color: transparent;
                animation: spin 0.8s linear infinite;
            }

        .login-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(255, 92, 122, 0.7);
            background: var(--danger);
        }

            .login-status-dot.connected {
                background: var(--primary);
                box-shadow: 0 0 14px rgba(0, 200, 150, 0.9);
            }

        .login-status-text {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* ÏÉÅÎã® Ï†ïÎ≥¥ Ïπ¥Îìú ----------------------------------------------------- */

        .summary-row {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin-bottom: 16px;
        }

        .summary-card {
            flex: 1 1 140px;
            min-width: 130px;
            padding: 14px 14px 12px;
            border-radius: var(--radius-lg);
            background: radial-gradient(circle at top left, #152840, #07111f);
            border: 1px solid rgba(255, 255, 255, 0.04);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2px;
        }

        .summary-label {
            font-size: 11px;
            color: var(--text-soft);
        }

        .summary-icon {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: rgba(7, 234, 182, 0.06);
            color: var(--primary);
        }

        .summary-value {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 0.03em;
        }

        .summary-sub {
            font-size: 11px;
            color: var(--text-soft);
        }

        .summary-card.accent {
            background: radial-gradient(circle at top, #3f2a00, #10141f);
            border-color: rgba(255, 184, 63, 0.6);
        }

            .summary-card.accent .summary-icon {
                background: rgba(255, 184, 63, 0.12);
                color: var(--accent-strong);
            }

        .period-label {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* ÎèÑÎÑõ Í∑∏ÎûòÌîÑ -------------------------------------------------------- */

        .donut-card {
            flex: 0 0 210px;
            max-width: 240px;
            padding: 16px 10px 10px;
            border-radius: var(--radius-xl);
            background: radial-gradient(circle at top, #1d2f46, #050b16);
            border: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
        }

        .donut-label {
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 8px;
        }

        .donut-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .donut-ring {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 12px solid rgba(255, 255, 255, 0.06);
            border-top-color: var(--accent);
            border-right-color: var(--accent);
            box-shadow: 0 0 40px rgba(255, 184, 63, 0.45);
            animation: donut-spin 10s linear infinite;
            animation-play-state: paused;
        }

        .donut-center {
            position: absolute;
            inset: 50%;
            width: 72px;
            height: 72px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: radial-gradient(circle at top, #162237, #050b16);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }

        .donut-main {
            font-size: 24px;
            font-weight: 700;
        }

        .donut-sub {
            font-size: 11px;
            color: var(--text-soft);
        }


        /* ÏóÖÎ¨¥ ÌÉ≠ ----------------------------------------------------------- */

        .view-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 4px 0 10px;
        }

        .view-tab {
            flex: 1 1 0;
            min-width: 180px;
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: radial-gradient(circle at top left, #101a2a, #050b16);
            color: var(--text-soft);
            font-size: 11px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 3px;
            transition: background var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), color var(--transition-fast);
        }

        .view-tab-label {
            font-size: 12px;
            font-weight: 600;
            color: #e5efff;
        }

        .view-tab-sub {
            font-size: 10px;
            opacity: 0.8;
        }

        .view-tab.active {
            background: linear-gradient( 135deg, rgba(0, 200, 150, 0.18), rgba(255, 184, 63, 0.22) );
            border-color: rgba(0, 200, 150, 0.9);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            color: #ffffff;
            transform: translateY(-1px);
        }

            .view-tab.active .view-tab-sub {
                opacity: 1;
            }


        /* Í≤ÄÏÉâ/ÌïÑÌÑ∞ ----------------------------------------------------------- */

        .controls-bar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .search-input-wrap {
            flex: 1 1 220px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 8px 34px 8px 32px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(7, 16, 29, 0.96);
            color: var(--text-main);
            font-size: 13px;
            outline: none;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
        }

            .search-input::placeholder {
                color: rgba(159, 174, 198, 0.6);
            }

        .search-icon-left,
        .search-icon-right {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 15px;
            color: var(--text-soft);
            pointer-events: none;
        }

        .search-icon-left {
            left: 10px;
        }

        .search-icon-right {
            right: 10px;
        }

        .search-input:focus {
            border-color: rgba(0, 200, 150, 0.85);
            box-shadow: 0 0 0 1px rgba(0, 200, 150, 0.32);
            background: rgba(11, 23, 40, 0.98);
        }

        .select {
            min-width: 120px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(12, 23, 39, 0.96);
            color: var(--text-main);
            padding: 7px 26px 7px 10px;
            font-size: 12px;
            outline: none;
            position: relative;
            appearance: none;
            background-image: linear-gradient(45deg, transparent 50%, #7e90aa 50%), linear-gradient(135deg, #7e90aa 50%, transparent 50%);
            background-position: calc(100% - 13px) 10px, calc(100% - 8px) 10px;
            background-size: 5px 5px, 5px 5px;
            background-repeat: no-repeat;
        }

        .chip-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .chip {
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            font-size: 11px;
            color: var(--text-soft);
            cursor: pointer;
            background: rgba(7, 16, 28, 0.8);
            transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
        }

            .chip:hover {
                transform: translateY(-1px);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .chip.active {
                background: var(--primary-soft);
                border-color: rgba(0, 200, 150, 0.9);
                color: #bff8ea;
            }

        /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ ------------------------------------------------------- */

        .main-layout {
            display: grid;
            grid-template-columns: minmax(0, 2.4fr) minmax(320px, 1.3fr);
            gap: 18px;
            align-items: flex-start;
            margin-top: 12px;
        }

        .bid-list-panel {
            background: rgba(7, 15, 28, 0.9);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: var(--shadow-soft);
            padding: 14px 14px 10px;
            max-height: calc(100vh - 260px);
            overflow-y: auto;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 12px;
            color: var(--text-soft);
            gap: 6px;
            flex-wrap: wrap;
        }

        .panel-header-left {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .pill-count {
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(9, 31, 55, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.06);
            font-size: 11px;
        }

        .panel-header-right {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .mini-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--primary);
            box-shadow: 0 0 10px rgba(0, 200, 150, 0.8);
        }

        /* ÏûÖÏ∞∞ Ïπ¥Îìú ----------------------------------------------------------- */

        .bid-card {
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: linear-gradient(135deg, rgba(13, 28, 51, 0.98), rgba(7, 15, 29, 0.98));
            padding: 12px 12px 10px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

            .bid-card::before {
                content: "";
                position: absolute;
                inset: -30%;
                background: radial-gradient(circle at 10% -10%, rgba(0, 200, 150, 0.12), transparent 50%), radial-gradient(circle at 100% 120%, rgba(255, 184, 63, 0.08), transparent 55%);
                opacity: 0.7;
                pointer-events: none;
            }

        .bid-card-inner {
            position: relative;
            z-index: 1;
        }

        .bid-top-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 2px;
            flex-wrap: wrap;
        }

        .badge-region {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(3, 15, 33, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.09);
            color: var(--text-soft);
        }

        .bid-no {
            font-size: 11px;
            color: var(--text-soft);
        }

        .badge-status {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(2, 36, 25, 0.9);
            color: #b5ffe5;
            border: 1px solid rgba(0, 200, 150, 0.7);
            white-space: nowrap;
        }

            .badge-status.open {
                background: rgba(2, 36, 25, 0.9);
                color: #b5ffe5;
                border: 1px solid rgba(0, 200, 150, 0.7);
            }

            .badge-status.closed {
                background: rgba(44, 14, 20, 0.9);
                color: #ffd0da;
                border: 1px solid rgba(255, 92, 122, 0.7);
            }

        .badge-source {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(3, 18, 35, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.16);
            color: var(--text-soft);
            white-space: nowrap;
        }

        .badge-status.manual {
            background: rgba(44, 26, 0, 0.9);
            border-color: rgba(255, 184, 63, 0.7);
            color: #ffe7b4;
        }

        .bid-title {
            margin: 0 0 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .bid-subline {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 4px;
        }

            .bid-subline span {
                white-space: nowrap;
            }

        /* AI ÏÉÅÌÉú / ÏóëÏÖÄ ÌëúÏ§Ä ÎùºÏù∏ ------------------------------------------- */

        .badge-ai {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            border: 1px solid rgba(255, 255, 255, 0.14);
            background: rgba(3, 18, 35, 0.9);
            color: var(--text-soft);
            white-space: nowrap;
        }

            .badge-ai.done {
                border-color: rgba(0, 200, 150, 0.7);
                color: #b5ffe5;
                background: rgba(2, 36, 25, 0.9);
            }

            .badge-ai.pending {
                border-color: rgba(255, 184, 63, 0.7);
                color: #ffe7b4;
                background: rgba(44, 26, 0, 0.9);
            }

            .badge-ai.error {
                border-color: rgba(255, 92, 122, 0.7);
                color: #ffd0da;
                background: rgba(44, 14, 20, 0.9);
            }

        .bid-excel-line {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 11px;
            color: var(--text-soft);
            margin: 2px 0 4px;
        }

        .kv-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 8px;
            border-radius: 999px;
            background: rgba(18, 35, 58, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text-soft);
        }

            .kv-pill strong {
                color: #f9fbff;
                font-weight: 600;
            }

        .deep-grid-4 {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 10px 18px;
            font-size: 12px;
        }


        .meta-label {
            font-size: 10px;
            color: #7f92b2;
            text-transform: uppercase;
            letter-spacing: 0.07em;
        }

        .meta-value {
            font-size: 11px;
            color: #d5e1ff;
        }

        .bid-meta-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 6px 12px;
            margin: 4px 0 5px;
        }

        .bid-meta-item {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .ai-result-box {
            margin-top: 4px;
            padding: 7px 9px 7px;
            border-radius: 12px;
            background: rgba(3, 18, 35, 0.92);
            border: 1px solid rgba(0, 200, 150, 0.15);
            font-size: 11px;
            color: var(--text-soft);
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .ai-result-icon {
            font-size: 14px;
            color: var(--primary);
            margin-top: 1px;
        }

        .ai-result-text strong {
            color: #f9fbff;
        }

        .bid-footer-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            margin-top: 4px;
            font-size: 10px;
            color: var(--text-soft);
        }

        .bid-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .btn-link {
            text-decoration: none;
            color: inherit;
        }

            .btn-link:hover {
                text-decoration: underline;
            }

        /* Ï∫òÎ¶∞Îçî Ïπ¥Îìú -------------------------------------------------------- */

        .calendar-panel {
            background: rgba(7, 15, 28, 0.96);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: var(--shadow-soft);
            padding: 12px 12px 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-soft);
            margin-bottom: 2px;
            gap: 6px;
            flex-wrap: wrap;
        }

        .calendar-header-left {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .calendar-tag {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 10px;
            background: rgba(3, 18, 35, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .calendar-frame {
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 14px 38px rgba(0, 0, 0, 0.9);
            position: relative;
        }

            .calendar-frame iframe {
                width: 100%;
                height: 420px;
                border: none;
                display: block;
                filter: saturate(1.15) contrast(1.02);
            }

        /* send feedback Î≤ÑÌäº Í∞ÄÎ¶¨Í∏∞Ïö© ÎßàÏä§ÌÅ¨ */
        .calendar-mask {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 140px;
            height: 40px;
            background: linear-gradient( 90deg, transparent, rgba(7, 15, 28, 0.96) );
            pointer-events: auto; /* Ï∫òÎ¶∞Îçî ÌîºÎìúÎ∞± Î≤ÑÌäº ÌÅ¥Î¶≠ Î∞©ÏßÄ */
        }

        /* Í≥µÏö© Î™®Îã¨ Î∞±ÎìúÎ°≠ --------------------------------------------------- */

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(3px);
        }

            .modal-backdrop.active {
                display: flex;
            }

        /* Ïä§ÎßàÌä∏ Îì±Î°ù Î™®Îã¨ --------------------------------------------------- */

        .modal {
            width: min(680px, 92vw);
            max-height: 80vh;
            overflow: hidden;
            border-radius: 18px;
            background: radial-gradient(circle at top, #13233b, #050b16);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 12px 16px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 14px;
            font-weight: 600;
        }

        .modal-body {
            padding: 12px 16px 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 10px 16px 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            font-size: 11px;
            color: var(--text-soft);
        }

        .field-label {
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 4px;
        }

        .textarea {
            width: 100%;
            min-height: 120px;
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            background: rgba(6, 14, 26, 0.96);
            color: var(--text-main);
            font-size: 12px;
            padding: 8px 10px;
            outline: none;
            resize: vertical;
        }

        .input {
            width: 100%;
            border-radius: 10px;
            border: 1px solid var(--border-subtle);
            background: rgba(6, 14, 26, 0.96);
            color: var(--text-main);
            font-size: 12px;
            padding: 7px 9px;
            outline: none;
        }

            .textarea:focus,
            .input:focus {
                border-color: rgba(0, 200, 150, 0.85);
                box-shadow: 0 0 0 1px rgba(0, 200, 150, 0.32);
            }

        /* 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ ------------------------------------------------- */

        .deep-modal {
            width: min(880px, 96vw);
            max-height: 84vh;
            border-radius: 22px;
            background: radial-gradient(circle at top, #131b2b, #050811);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 24px 68px rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            color: var(--text-main);
        }

        .deep-modal-header {
            padding: 18px 22px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .deep-modal-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            flex-wrap: wrap;
        }

        .deep-modal-title {
            font-size: 16px;
            font-weight: 600;
        }

        .deep-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .deep-badge {
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(8, 23, 42, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.12);
            color: var(--text-soft);
        }

            .deep-badge.primary {
                border-color: rgba(0, 200, 150, 0.7);
                color: #bff8ea;
                background: rgba(0, 200, 150, 0.1);
            }

            .deep-badge.warn {
                border-color: rgba(255, 184, 0.7);
                color: #ffe7b4;
                background: rgba(255, 184, 63, 0.1);
            }

            .deep-badge.danger {
                border-color: rgba(255, 92, 122, 0.7);
                color: #ffd0da;
                background: rgba(255, 92, 122, 0.12);
            }

        .deep-modal-close-btn {
            border-radius: 999px;
            padding: 6px 13px;
            font-size: 12px;
        }

        .deep-modal-body {
            padding: 12px 22px 18px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .deep-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #b8c5e4;
            margin-bottom: 4px;
        }

        .deep-summary-text {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-main);
        }

        .deep-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px 18px;
            font-size: 12px;
        }

        .deep-grid-item-label {
            font-size: 11px;
            color: var(--text-soft);
            margin-bottom: 2px;
        }

        .deep-grid-item-value {
            font-size: 13px;
            color: #f4f7ff;
        }


        .deep-section-title-row{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
        }
        .deep-section-actions{
            display:flex;
            gap:8px;
            flex-wrap:wrap;
        }
        .btn-small{ padding:7px 10px; font-size:12px; border-radius:10px; }
        .deep-section-hint{ font-size:11px; color:var(--text-soft); margin-top:6px; }

        .deep-input{
            width:100%;
            padding:10px 12px;
            border-radius:12px;
            border:1px solid rgba(255,255,255,.10);
            background:rgba(255,255,255,.04);
            color:var(--text);
            outline:none;
        }
        .deep-input:focus{ border-color: rgba(255,184,63,.55); box-shadow: 0 0 0 3px rgba(255,184,63,.15); }
        .deep-textarea{
            width:100%;
            min-height:84px;
            resize:vertical;
            padding:10px 12px;
            border-radius:12px;
            border:1px solid rgba(255,255,255,.10);
            background:rgba(255,255,255,.04);
            color:var(--text);
            outline:none;
        }


        .deep-checkpoints {
            font-size: 12px;
            padding-left: 18px;
            margin: 4px 0 0;
        }

            .deep-checkpoints li {
                margin-bottom: 2px;
            }

        .deep-attachments-box {
            font-size: 12px;
            border-radius: 12px;
            padding: 9px 10px 8px;
            background: rgba(4, 15, 30, 0.96);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .deep-attachments-list {
            margin: 4px 0 0;
            padding-left: 18px;
        }

            .deep-attachments-list li {
                margin-bottom: 3px;
            }

            .deep-attachments-list a {
                color: #c6e4ff;
                text-decoration: none;
            }

                .deep-attachments-list a:hover {
                    text-decoration: underline;
                }


        /* --- 3/3 ÌôïÏû•: Ï°∞Î°Ä/Ïö©Îüâ/ÎåÄÏ±ÖÎ¨∏ÏÑú --- */
        .deep-kv-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 8px;
        }

        @media (max-width: 720px) {
            .deep-kv-grid {
                grid-template-columns: 1fr;
            }
        }

        .deep-small-block {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed rgba(255, 255, 255, 0.12);
        }

        .deep-report-row {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .deep-report-left {
            min-width: 0;
        }

        .deep-report-link {
            margin-top: 6px;
            font-size: 12px;
            color: var(--text-soft);
            word-break: break-all;
        }

            .deep-report-link a {
                color: #c6e4ff;
                text-decoration: none;
            }

                .deep-report-link a:hover {
                    text-decoration: underline;
                }

        .deep-footer {
            padding: 10px 22px 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            font-size: 11px;
            color: var(--text-soft);
            flex-wrap: wrap;
        }

        /* Ï†ÑÏó≠ Î°úÎî© --------------------------------------------------------- */


        /* Î™©Î°ù ÏòÅÏó≠ Ïù∏ÎùºÏù∏ Î°úÎî© ÌëúÏãú */
        .loading-inline {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 18px 12px;
            font-size: 12px;
            color: #b2bec3;
        }

        .spinner-inline {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid rgba(0, 200, 150, 0.25);
            border-top-color: #00e0b0;
            border-right-color: #ffb83f;
            animation: spin 0.9s linear infinite;
        }


        .loading-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(0, 0, 0, 0.82), rgba(0, 0, 0, 0.95));
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(3px);
        }

            .loading-overlay.active {
                display: flex;
            }

        .loading-box {
            padding: 18px 22px 14px;
            border-radius: 18px;
            background: radial-gradient(circle at top, #172134, #050812);
            border: 1px solid rgba(0, 200, 150, 0.4);
            color: var(--text-main);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            gap: 14px;
            min-width: 220px;
        }

        .spinner-lg {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 3px solid rgba(0, 200, 150, 0.25);
            border-top-color: #00e0b0;
            border-right-color: #ffb83f;
            animation: spin 0.8s linear infinite;
        }

        .loading-text-main {
            font-size: 13px;
            font-weight: 500;
        }

        .loading-text-sub {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* Î∞òÏùëÌòï ------------------------------------------------------------- */

        @media (max-width: 1020px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .calendar-panel {
                order: -1;
            }

            .bid-list-panel {
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                align-items: stretch;
            }

            .header-actions {
                justify-content: flex-start;
            }

            .summary-row {
                flex-direction: column;
            }

            .donut-card {
                max-width: none;
                order: -1;
            }

            .controls-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .calendar-frame iframe {
                height: 360px;
            }

            .deep-grid-3 {
                grid-template-columns: 1fr;
            }

            .deep-grid-4 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .app-title-main h1 {
                font-size: 18px;
            }

            .deep-modal-header,
            .deep-modal-body,
            .deep-footer {
                padding-left: 16px;
                padding-right: 16px;
            }
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò --------------------------------------------------------- */

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes donut-spin {
            0% {
                transform: rotate(0deg);
            }

            40% {
                transform: rotate(320deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ====== Ïª§Ïä§ÌÖÄ Ïä§ÌÅ¨Î°§Î∞î (Í≤ÄÏÉâÍ≤∞Í≥º Ìå®ÎÑêÏö©) ====== */

        .bid-list-panel {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 200, 150, 0.6) rgba(6, 14, 26, 0.9);
        }

            .bid-list-panel::-webkit-scrollbar {
                width: 8px;
            }

            .bid-list-panel::-webkit-scrollbar-track {
                background: rgba(4, 10, 20, 0.9);
                border-radius: 999px;
            }

            .bid-list-panel::-webkit-scrollbar-thumb {
                background: linear-gradient(180deg, #00c896, #00e0b0);
                border-radius: 999px;
                box-shadow: 0 0 14px rgba(0, 200, 150, 0.7);
            }

                .bid-list-panel::-webkit-scrollbar-thumb:hover {
                    background: linear-gradient(180deg, #00e0b0, #ffb83f);
                }
        /* ÏÇ¨Ïù¥Îìú(ÏÉÅÎã®) ÌïÑÌÑ∞ Ïπ© ÏÑ∏Ìä∏ -------------------------------------- */

        .side-filters {
            margin-bottom: 8px;
            padding: 8px 10px 6px;
            border-radius: 14px;
            background: radial-gradient( circle at top left, rgba(10, 22, 40, 0.9), rgba(3, 9, 20, 0.95) );
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 6px 12px;
            font-size: 11px;
        }

        .side-filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .side-filter-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #7f92b2;
        }

        .side-filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .chip-small {
            padding: 4px 8px;
            font-size: 10px;
        }

        @media (max-width: 768px) {
            .side-filters {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 520px) {
            .side-filters {
                grid-template-columns: 1fr;
            }
        }
        /* D-Day Î±ÉÏßÄ -------------------------------------------------------- */

        .d-day-badge {
            padding: 3px 9px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255, 184, 63, 0.15);
            border: 1px solid rgba(255, 184, 63, 0.8);
            color: #ffdca3;
            white-space: nowrap;
        }

        /* ÌÉúÍ∑∏ Ï§Ñ: [ÏÉÅ-ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ] ÌïôÍµê / ~300ÌÜ§ ÏòàÏÉÅ ---------------------- */

        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 11px;
            color: var(--text-soft);
            margin: 4px 0 4px;
        }

        .tag-pill {
            padding: 3px 8px;
            border-radius: 999px;
            background: rgba(3, 18, 35, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 10px;
        }

            .tag-pill.primary {
                border-color: rgba(0, 200, 150, 0.7);
                color: #bff8ea;
                background: rgba(0, 200, 150, 0.12);
            }

            .tag-pill.warn {
                border-color: rgba(255, 184, 63, 0.7);
                color: #ffe7b4;
                background: rgba(255, 184, 63, 0.12);
            }

        /* ÎÇôÏ∞∞Ïûê Ï†ïÎ≥¥ Î∏îÎü≠ -------------------------------------------------- */

        .winner-block {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 11px;
            margin-top: 4px;
        }

        .winner-name {
            font-weight: 600;
            color: #f9fbff;
        }

        .winner-meta {
            font-size: 11px;
            color: var(--text-soft);
        }

        /* Ï†úÎ™©ÏùÑ ÏõêÎ¨∏ ÎßÅÌÅ¨Î°ú ÌÅ¥Î¶≠ Í∞ÄÎä•ÌïòÍ≤å --------------------------------- */

        .bid-title a {
            color: inherit;
            text-decoration: none;
        }

            .bid-title a:hover {
                text-decoration: underline;
            }

        /* deep calc table */
        .deep-calc-table td {
            border: 1px solid rgba(255,255,255,0.08);
            padding: 6px 8px;
            font-size: 12px;
            vertical-align: top;
        }

            .deep-calc-table td.label {
                color: var(--text-soft);
                width: 34%;
            }
    
        /* ======================================================
         * ‚úÖ Í∞ÄÎèÖÏÑ± Í∞ïÌôî Ìå®Ïπò (2026-02-02)
         * - ÌòÑÏû¨ UI ÎîîÏûêÏù∏ Ïú†ÏßÄ + Ìè∞Ìä∏/Í∞ÑÍ≤©/ÌÑ∞ÏπòÏòÅÏó≠ ÌôïÎåÄ
         * ====================================================== */
        html { font-size: 17px; }
        body { font-size: 17px; line-height: 1.55; letter-spacing: 0.01em; }

        .page-shell { padding: 22px 20px 38px; }

        /* Ìó§Îçî */
        .app-title-main h1 { font-size: 24px; }
        .badge-version { font-size: 12.5px; padding: 5px 10px; }
        .app-subtitle { font-size: 13px; }

        /* Î≤ÑÌäº/ÏûÖÎ†• */
        .btn { font-size: 14px; padding: 9px 16px; gap: 8px; }
        .btn span.icon { font-size: 16px; }
        .controls-bar { gap: 10px; margin-bottom: 12px; }
        .search-input { font-size: 15px; padding: 10px 40px 10px 36px; }
        .search-icon-left, .search-icon-right { font-size: 17px; }
        .select, select { font-size: 15px; padding: 10px 12px; }
        .chip { font-size: 13px; padding: 7px 12px; }

        /* Ìå®ÎÑê/Ïπ¥Îìú */
        .panel-header { font-size: 14px; margin-bottom: 8px; }
        .pill-count { font-size: 13px; padding: 3px 10px; }
        .bid-list-panel { padding: 16px 16px 12px; }
        .bid-card { padding: 14px 14px 12px; gap: 8px; }
        .bid-title { font-size: 16px; line-height: 1.38; margin: 0 0 6px; }
        .bid-subline { font-size: 13px; gap: 10px; margin-bottom: 6px; }
        .badge-ai { font-size: 12px; padding: 4px 10px; }
        .badge { font-size: 12px; padding: 4px 10px; }
        .bid-meta { font-size: 13px; }
        .bid-meta .meta-item { padding: 4px 8px; }

        /* Ï∫òÎ¶∞Îçî */
        .calendar-panel { padding: 14px 14px 12px; gap: 8px; }
        .calendar-header { font-size: 14px; }
        .calendar-tag { font-size: 12px; padding: 4px 10px; }

        /* Î™®Îã¨/Ìèº */
        .modal { width: min(760px, 94vw); }
        .modal-header { padding: 14px 18px 10px; }
        .modal-title { font-size: 16px; }
        .modal-body { padding: 14px 18px 16px; gap: 12px; }
        .modal-footer { font-size: 13px; padding: 12px 18px 14px; }
        .field-label { font-size: 13px; margin-bottom: 6px; }
        .textarea { font-size: 14px; padding: 10px 12px; }
        .input { font-size: 14px; padding: 9px 11px; }

        /* 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Ìëú(Í≥ÑÏÇ∞Ìëú) */
        .deep-calc-table td { font-size: 14px; padding: 8px 10px; }
        .deep-calc-table td.label { width: 32%; }

        /* ÏûëÏùÄ ÌôîÎ©¥(Î™®Î∞îÏùº)ÏóêÏÑúÎèÑ ‚ÄúÌÅ¨Í≤å‚Äù Ïú†ÏßÄ */
        @media (max-width: 720px) {
          html { font-size: 16px; }
          body { font-size: 16px; }
          .page-shell { padding: 18px 14px 30px; }
          .app-title-main h1 { font-size: 22px; }
          .btn { font-size: 13px; padding: 9px 14px; }
          .search-input { font-size: 14px; }
          .chip { font-size: 12.5px; }
          .bid-title { font-size: 15px; }
          .modal { width: 94vw; }
        }

    </style>
</head>
<body>
    <div class="page-shell">
        <!-- Ìó§Îçî -->
        <header class="app-header">
            <div class="app-title-block">
                <div class="app-title-main">
                    <h1>ÌïúÍµ≠ÏàòÏïà AI ÏûÖÏ∞∞Í¥ÄÎ¶¨</h1>
                    <span class="badge-version">AI Î∂ÑÏÑù ÌïÑÌÑ∞ v13 (G2B+EAIS ÌëúÏ§ÄÌïÑÎìú) ¬∑ Í∞ÄÎèÖÏÑ±+</span>
                </div>
                <div class="app-subtitle">
                    <span class="dot"></span>
                    <span>ÎÇòÎùºÏû•ÌÑ∞¬∑Ïô∏Î∂ÄÍ≥µÍ≥†ÏóêÏÑú Ï†ÄÎ•òÏ°∞/Ïö∞Ïàò¬∑Ïπ®ÏàòÎ∞©ÏßÄ Í¥ÄÎ†® ÏûÖÏ∞∞ ÏûêÎèô ÏÑ†Î≥Ñ</span>
                </div>
            </div>

            <div class="header-actions">
                <button id="btnExternal" class="btn btn-ghost btn-small">
                    <span class="icon">üåê</span> Ïô∏Î∂ÄÏõπ ÏàòÏßë
                </button>

<button id="btnEAISL04" class="btn btn-ghost btn-small" title="ÏÑ∏ÏõÄÌÑ∞(EAIS) L04 Î™©Î°ùÏóêÏÑú HTML/AI Î∞©ÏãùÏúºÎ°ú ÏàòÏßë">
    <span class="icon">üèóÔ∏è</span> ÏÑ∏ÏõÄÌÑ∞ L04 ÏàòÏßë
</button>
                <button id="btnSmartAddOpen" class="btn btn-ghost btn-small">
                    <span class="icon">‚ûï</span> Í≥µÍ≥† Ïä§ÎßàÌä∏ Îì±Î°ù
                </button>
                <button id="btnRefresh" class="btn btn-primary btn-small">
                    <span class="icon">‚ö°</span> ÏÉàÎ°úÍ≥†Ïπ®
                </button>
                <div style="display:flex;align-items:center;gap:8px;">
                    <button id="btnLogin" class="btn btn-ghost btn-small">
                        <span class="icon">üîë</span>
                        <span id="btnLoginLabel">Î°úÍ∑∏Ïù∏</span>
                    </button>
                    <div>
                        <div id="loginStatusDot" class="login-status-dot"></div>
                        <div id="loginStatusText" class="login-status-text">Ï∫òÎ¶∞Îçî ÎØ∏Ïó∞Îèô</div>
                    </div>
                </div>
            </div>

            <div id="externalUpdateInfo" class="external-update-info" style="margin-top:8px; font-size:12px; color: var(--text-soft); white-space:pre-line;"></div>
        </header>

        <!-- ÏÉÅÎã® ÏöîÏïΩ/ÎèÑÎÑõ -->
        <section class="summary-row">
            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">Í≤ÄÏÉâ Ï†ÑÏ≤¥ Í≥µÍ≥† Ïàò</span>
                    <div class="summary-icon">üìÑ</div>
                </div>
                <div id="statTotalRaw" class="summary-value">0</div>
                <div class="summary-sub">ÎÇòÎùºÏû•ÌÑ∞ Í∏∞Ï§Ä ÏµúÍ∑º 7Ïùº Ìï©Í≥Ñ</div>
                <div id="statTotalBreakdown" style="font-size:11px;margin-top:2px;">
                    ÎÇòÎùºÏû•ÌÑ∞ : 0 / Ïô∏Î∂ÄÏõπ : 0 / Ïä§ÎßàÌä∏Îì±Î°ù : 0
                </div>
            </article>

            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">Ï†ÅÌï©ÏÑ± ÌÜµÍ≥º</span>
                    <div class="summary-icon">üß≤</div>
                </div>
                <div id="statFiltered" class="summary-value">0</div>
                <div class="summary-sub">Ìå®ÌÑ¥ ÌïÑÌÑ∞ ÌõÑ ÎÇ®ÏùÄ Í≥µÍ≥†</div>
                <div id="statFilteredBreakdown" style="font-size:11px;margin-top:2px;">
                    ÎÇòÎùºÏû•ÌÑ∞ : 0 / Ïô∏Î∂ÄÏõπ : 0 / Ïä§ÎßàÌä∏Îì±Î°ù : 0
                </div>
            </article>

            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">AI Î∂ÑÏÑù ÏàòÌñâ</span>
                    <div class="summary-icon">ü§ñ</div>
                </div>
                <div id="statAi" class="summary-value">0</div>
                <div class="summary-sub">Gemini 1Ï∞® ÏöîÏïΩ Í±¥Ïàò</div>
                <div id="statAiBreakdown" style="font-size:11px;margin-top:2px;">
                    ÎÇòÎùºÏû•ÌÑ∞ : 0 / Ïô∏Î∂ÄÏõπ : 0 / Ïä§ÎßàÌä∏Îì±Î°ù : 0
                </div>
            </article>

            <article class="summary-card">
                <div class="summary-header">
                    <span class="summary-label">Í≤ÄÌÜ† ÎåÄÏÉÅ Í≥µÍ≥†</span>
                    <div class="summary-icon">üì°</div>
                </div>
                <div id="statApi" class="summary-value">0</div>
                <div id="statPeriod" class="summary-sub">Í∏∞Í∞Ñ: ÏµúÍ∑º 7Ïùº</div>
                <div id="statSourceCounts" style="font-size:11px;margin-top:2px;">
                    ÎÇòÎùºÏû•ÌÑ∞ : 0 / Ïô∏Î∂ÄÏõπ : 0 / Ïä§ÎßàÌä∏Îì±Î°ù : 0
                </div>
            </article>

            <article class="donut-card">
                <div class="donut-label">Í¥ÄÎ†®ÏÑ± Î∂ÑÌè¨ (ÏÉÅ + Ï§ë)</div>
                <div class="donut-wrapper">
                    <div class="donut-ring" id="donutRing"></div>
                    <div class="donut-center">
                        <div id="donutMain" class="donut-main">0</div>
                        <div class="donut-sub">ÌòÑÏû¨ Ï°∞Ìöå Í±¥Ïàò</div>
                    </div>
                </div>
            </article>
        </section>

        <!-- ÏóÖÎ¨¥ Î∑∞ ÌÉ≠ -->
        <nav class="view-tabs">
            <button class="view-tab active" data-view="history">
                <span class="view-tab-label">Ï†ÑÏ≤¥ / ÌûàÏä§ÌÜ†Î¶¨</span>
                <span class="view-tab-sub">Ï†ÑÏ≤¥ Î†àÌçºÎü∞Ïä§</span>
            </button>
            <button class="view-tab" data-view="target">
                <span class="view-tab-label">ÎÇôÏ∞∞Ïûê ÌÉÄÍπÉ</span>
                <span class="view-tab-sub">Î©îÏù∏ ÏòÅÏóÖÌôîÎ©¥</span>
            </button>
            <button class="view-tab" data-view="direct">
                <span class="view-tab-label">ÏßÅÏ†ëÏûÖÏ∞∞ ¬∑ Í≥µÍ≥†Ï§ë</span>
                <span class="view-tab-sub">D-Day Í¥ÄÏ†úÌÉë</span>
            </button>
        </nav>


        <!-- Í≤ÄÏÉâ/ÌïÑÌÑ∞ -->
        <section class="controls-bar">
            <div class="search-input-wrap">
                <input id="searchInput"
                       class="search-input"
                       type="text"
                       placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• (ÌïôÍµê, Í∞úÏ∂ï, Í∞ïÎèôÍµ¨, ÏÑ§Í≥Ñ Îì±)" />
                <span class="search-icon-left">üîç</span>
                <span class="search-icon-right">‚å®Ô∏è</span>
            </div>

            <select id="filterRegion" class="select">
                <option value="">Ï†ÑÏ≤¥ ÏßÄÏó≠</option>
                <option value="ÏÑúÏö∏">ÏÑúÏö∏</option>
                <option value="Í≤ΩÍ∏∞">Í≤ΩÍ∏∞</option>
                <option value="Ïù∏Ï≤ú">Ïù∏Ï≤ú</option>
                <option value="Î∂ÄÏÇ∞">Î∂ÄÏÇ∞</option>
                <option value="ÎåÄÍµ¨">ÎåÄÍµ¨</option>
                <option value="Í¥ëÏ£º">Í¥ëÏ£º</option>
                <option value="ÎåÄÏ†Ñ">ÎåÄÏ†Ñ</option>
                <option value="Ïö∏ÏÇ∞">Ïö∏ÏÇ∞</option>
                <option value="Í∞ïÏõê">Í∞ïÏõê</option>
                <option value="Ï∂©Ï≤≠">Ï∂©Ï≤≠</option>
                <option value="Í≤ΩÏÉÅ">Í≤ΩÏÉÅ</option>
                <option value="Ï†ÑÎùº">Ï†ÑÎùº</option>
                <option value="Ï†úÏ£º">Ï†úÏ£º</option>
            </select>

            <div class="chip-group">
                <div class="chip chip-rel active" data-rel="all">Ï†ÑÏ≤¥</div>
                <div class="chip chip-rel" data-rel="high">Í¥ÄÎ†®ÏÑ± ÏÉÅ</div>
                <div class="chip chip-rel" data-rel="mid">Í¥ÄÎ†®ÏÑ± Ï§ë Ïù¥ÏÉÅ</div>
            </div>

        </section>

        <!-- Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ (ÏûÖÏ∞∞ Î¶¨Ïä§Ìä∏ + Ï∫òÎ¶∞Îçî) -->
        <section class="main-layout">
            <section class="bid-list-panel">
                <header class="panel-header">
                    <div class="panel-header-left">
                        <span>Í≤ÄÏÉâ Í≤∞Í≥º</span>
                        <span class="pill-count"><span id="resultCount">0</span>Í±¥</span>
                        <span id="resultBreakdown" style="font-size:11px;color:var(--text-soft);">
                            API 0 / Ïô∏Î∂Ä 0
                        </span>
                    </div>
                    <div class="panel-header-right">
                        <span class="mini-dot"></span>
                        <span id="statLastUpdate">Last Update: -</span>
                    </div>
                </header>
                <!-- ÏôºÏ™Ω(ÏÉÅÎã®) ÌïÑÌÑ∞ Ïπ© ÏÑ∏Ìä∏ -->
                <div class="side-filters">
                    <!-- ÏÉÅÌÉú ÌïÑÌÑ∞ -->
                    <div class="side-filter-group">
                        <div class="side-filter-title">ÏÉÅÌÉú</div>
                        <div class="side-filter-chips">
                            <button class="chip chip-small chip-filter active"
                                    data-filter-group="state"
                                    data-filter-value="all">
                                Ï†ÑÏ≤¥
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="state"
                                    data-filter-value="open">
                                Í≥µÍ≥†Ï§ë
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="state"
                                    data-filter-value="closed">
                                ÎßàÍ∞ê
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="state"
                                    data-filter-value="calendar">
                                Ï∫òÎ¶∞Îçî Îì±Î°ùÎê®
                            </button>
                        </div>
                    </div>

                    <!-- ÏòÅÏóÖ Í≤ΩÎ°ú ÌïÑÌÑ∞ -->
                    <div class="side-filter-group">
                        <div class="side-filter-title">ÏòÅÏóÖ Í≤ΩÎ°ú</div>
                        <div class="side-filter-chips">
                            <button class="chip chip-small chip-filter active"
                                    data-filter-group="route"
                                    data-filter-value="all">
                                Ï†ÑÏ≤¥
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="route"
                                    data-filter-value="direct">
                                ÏßÅÏ†ëÏûÖÏ∞∞
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="route"
                                    data-filter-value="designer">
                                ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="route"
                                    data-filter-value="builder">
                                ÏãúÍ≥µÏÇ¨ÌÉÄÍπÉ
                            </button>
                        </div>
                    </div>

                    <!-- ÏÜåÏä§/Ï±ÑÎÑê ÌïÑÌÑ∞ -->
                    <div class="side-filter-group">
                        <div class="side-filter-title">ÏÜåÏä§/Ï±ÑÎÑê</div>
                        <div class="side-filter-chips">
                            <button class="chip chip-small chip-filter active"
                                    data-filter-group="source"
                                    data-filter-value="all">
                                Ï†ÑÏ≤¥
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="source"
                                    data-filter-value="API">
                                ÎÇòÎùºÏû•ÌÑ∞
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="source"
                                    data-filter-value="EAIS">
                                ÏÑ∏ÏõÄÌÑ∞
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="source"
                                    data-filter-value="EXTERNAL">
                                Ïô∏Î∂ÄÏõπ
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="source"
                                    data-filter-value="SMART">
                                Ïä§ÎßàÌä∏Îì±Î°ù
                            </button>
                        </div>
                    </div>

                    <!-- ÎÇôÏ∞∞Ïûê ÌïÑÌÑ∞ -->
                    <div class="side-filter-group">
                        <div class="side-filter-title">ÎÇôÏ∞∞Ïûê</div>
                        <div class="side-filter-chips">
                            <button class="chip chip-small chip-filter active"
                                    data-filter-group="winner"
                                    data-filter-value="all">
                                Ï†ÑÏ≤¥
                            </button>
                            <button class="chip chip-small chip-filter"
                                    data-filter-group="winner"
                                    data-filter-value="has">
                                ÎÇôÏ∞∞Ïûê ÏûàÏùåÎßå
                            </button>
                        </div>
                    </div>
                </div>

                <div id="bidList"></div>
            </section>

            <aside class="calendar-panel">
                <header class="calendar-header">
                    <div class="calendar-header-left">
                        <span>ÏûÖÏ∞∞ ÎßàÍ∞ê Ï∫òÎ¶∞Îçî</span>
                        <span class="calendar-tag">Google Calendar</span>
                    </div>
                    <span style="font-size:11px;color:var(--text-soft);">
                        ÏùºÏ†ï Îì±Î°ù Ïãú ÏûêÎèôÏúºÎ°ú ÎèôÍ∏∞Ìôî Îê©ÎãàÎã§.
                    </span>
                </header>

                <div class="calendar-frame">
                    <!-- showTabs / showNav ÌôúÏÑ±Ìôî -->
                    <iframe id="calendarIframe"
                            src="https://calendar.google.com/calendar/embed?src=d51a10e0014dcbd83e98d0da91cda4f52f629c19652c15fc693ee4529bbbab04%40group.calendar.google.com&ctz=Asia%2FSeoul&bgcolor=%23050915&mode=MONTH&showTitle=0&showPrint=0&showTabs=1&showCalendars=0&showTz=0&showNav=1&showDate=1"></iframe>
                    <!-- Feedback Î≤ÑÌäº Í∞ÄÎ¶¨Í∏∞ -->
                    <div class="calendar-mask"></div>
                </div>
            </aside>
        </section>
    </div>

    <!-- Ïä§ÎßàÌä∏ Îì±Î°ù Î™®Îã¨ -->
    <div id="smartModalBackdrop" class="modal-backdrop">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Ïô∏Î∂Ä Í≥µÍ≥† Ïä§ÎßàÌä∏ Îì±Î°ù</div>
                <button id="btnSmartClose" class="btn btn-ghost btn-small">
                    Îã´Í∏∞
                </button>
            </div>
            <form id="smartForm">
                <div class="modal-body">
                    <div>
                        <div class="field-label">‚ë† Í≥µÍ≥† Î≥∏Î¨∏ ÌÖçÏä§Ìä∏ (ÏÑ†ÌÉù)</div>
                        <textarea id="smartText"
                                  class="textarea"
                                  placeholder="ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Î≥µÏÇ¨Ìïú Î≥∏Î¨∏ ÌÖçÏä§Ìä∏Î•º Î∂ôÏó¨ ÎÑ£ÏúºÏÑ∏Ïöî."></textarea>
                    </div>
                    <div>
                        <div class="field-label">
                            ‚ë° Ï≤®Î∂ÄÌååÏùº / Îã§Ïö¥Î°úÎìú Ï£ºÏÜå(URL) (Ï§ÑÎ∞îÍøà ÎòêÎäî ÏâºÌëúÎ°ú Ïó¨Îü¨ Í∞ú ÏûÖÎ†• Í∞ÄÎä•)
                        </div>
                        <input id="smartUrl"
                               class="input"
                               type="text"
                               placeholder="https://...hwp, https://...pdf Îì±" />
                    </div>
                </div>
                <div class="modal-footer">
                    <span>AIÍ∞Ä Í≥µÍ≥†Î≤àÌò∏¬∑Í∏àÏï°¬∑Í∏∞Í∞Ñ¬∑Îã¥ÎãπÏûê Îì±ÏùÑ Ï∂îÏ∂úÌï¥ Ìïú ÌñâÏúºÎ°ú Îì±Î°ùÌï©ÎãàÎã§.</span>
                    <div style="display:flex;gap:8px;">
                        <button type="button" id="btnSmartCancel" class="btn btn-ghost btn-small">
                            Ï∑®ÏÜå
                        </button>
                        <button type="submit" class="btn btn-primary btn-small">
                            <span class="icon">ü§ñ</span> AI Î∂ÑÏÑù¬∑Îì±Î°ù
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ -->
    <div id="deepModalBackdrop" class="modal-backdrop">
        <div class="deep-modal">
            <div class="deep-modal-header">
                <div class="deep-modal-title-row">
                    <div>
                        <div id="deepTitle" class="deep-modal-title">Í≥µÍ≥†Î™Ö</div>
                        <div id="deepBadges" class="deep-badges"></div>
                    </div>
                    <button id="deepCloseBtn" class="btn btn-ghost deep-modal-close-btn">Îã´Í∏∞</button>
                </div>
                <div id="deepMetaLine" style="font-size:11px;color:var(--text-soft);margin-top:4px;"></div>
            </div>

            <div class="deep-modal-body">
                <section>
                    <div class="deep-section-title-row">
                        <div class="deep-section-title">ÏòÅÏóÖ ÌëúÏ§Ä Ï†ïÎ≥¥ (ÏÉòÌîå ÏóëÏÖÄ Í∏∞Ï§Ä)</div>
                        <div class="deep-section-actions">
                            <button id="btnStdSave" class="btn btn-primary btn-small" type="button"><span class="icon">üíæ</span> Ï†ÄÏû•</button>
                            <button id="btnStdReset" class="btn btn-ghost btn-small" type="button">Ï¥àÍ∏∞Ìôî</button>
                        </div>
                    </div>
                    <div class="deep-section-hint">‚Äª Ïù¥ ÏÑπÏÖòÏùÄ ÏàòÍ∏∞ ÏûÖÎ†• ÌõÑ Ï†ÄÏû•ÌïòÎ©¥ <b>ÏûÖÏ∞∞DB</b>Ïóê Î∞òÏòÅÎê©ÎãàÎã§.</div>
                    <div class="deep-grid-4">
                        <div><div class="deep-grid-item-label">ÏßÄÏó≠</div><input id="deepStdRegion" class="deep-input" type="text" /></div>
                        <div><div class="deep-grid-item-label">Î∞úÏ£ºÏ≤ò</div><input id="deepStdClient" class="deep-input" type="text" /></div>
                        <div><div class="deep-grid-item-label">ÏÇ¨ÏóÖÎ™Ö</div><input id="deepStdProject" class="deep-input" type="text" /></div>
                        <div><div class="deep-grid-item-label">Í≥µÎ≤ï Í≤∞Ï†ïÏãúÍ∏∞</div><input id="deepStdDecision" class="deep-input" type="text" placeholder="Ïòà: Í≥µÎ≤ï Í≤∞Ï†ïÏãúÍ∏∞" /></div>
                        <div><div class="deep-grid-item-label">Ï°∞ÏÇ¨/ÏòÅÏóÖÌòÑÌô©</div><input id="deepStdSales" class="deep-input" type="text" placeholder="Ïòà: Ï°∞ÏÇ¨/ÏòÅÏóÖÌòÑÌô©" /></div>
                        <div><div class="deep-grid-item-label">ÏÑ§Í≥ÑÏÇ¨</div><input id="deepStdDesigner" class="deep-input" type="text" /></div>
                        <div><div class="deep-grid-item-label">Î∞úÏ£ºÏ≤ò Îã¥ÎãπÏûê</div><input id="deepStdContact" class="deep-input" type="text" placeholder="Ïòà: Îã¥ÎãπÏûê/Ïó∞ÎùΩÏ≤ò" /></div>
                        <div><div class="deep-grid-item-label">ÎÇôÏ∞∞Ïùº</div><input id="deepStdAward" class="deep-input" type="text" placeholder="Ïòà: 2026-01-19" /></div>
                        <div><div class="deep-grid-item-label">Ïö©Ïó≠Í∏∞Í∞Ñ</div><input id="deepStdPeriod" class="deep-input" type="text" placeholder="Ïòà: 2026-02~2026-06" /></div>
                        <div><div class="deep-grid-item-label">Ï¢ÖÎ£åÏùº</div><input id="deepStdEnd" class="deep-input" type="text" placeholder="Ïòà: 2026-06-30" /></div>
                        <div><div class="deep-grid-item-label">Ïö©Ïó≠Í∏àÏï°(Ïñµ)</div><input id="deepStdAmount" class="deep-input" type="text" placeholder="(Ïñµ) Ïòà: 3.2" /></div>
                        <div><div class="deep-grid-item-label">ÏÇ¨ÏóÖÎπÑ(Ïñµ)</div><input id="deepStdBudget" class="deep-input" type="text" placeholder="(Ïñµ) Ïòà: 50" /></div>
                        <div><div class="deep-grid-item-label">ÎåÄÏßÄÎ©¥Ï†Å(„é°)</div><input id="deepStdArea" class="deep-input" type="text" placeholder="„é°" /></div>
                        <div><div class="deep-grid-item-label">Ïö©Îüâ</div><input id="deepStdCapacity" class="deep-input" type="text" placeholder="ÌÜ§" /></div>
                        <div><div class="deep-grid-item-label">ÎπÑÍ≥†</div><textarea id="deepStdMemo" class="deep-textarea" placeholder="ÎπÑÍ≥†"></textarea></div>
                    </div>
                </section>

                <section>
                    <div class="deep-section-title">ÏöîÏïΩ</div>
                    <div id="deepSummary" class="deep-summary-text"></div>
                </section>                <section>
                    <div class="deep-section-title">Í∏àÏï°/Í∏∞Í∞Ñ (AI Ï∂îÏ†ï Ìè¨Ìï®)</div>
                    <div class="deep-grid-3">
                        <div>
                            <div class="deep-grid-item-label">Ïö©Ïó≠Í∏∞Í∞Ñ / Í≥µÏÇ¨Í∏∞Í∞Ñ</div>
                            <div id="deepPeriod" class="deep-grid-item-value">-</div>
                        </div>
                        <div>
                            <div class="deep-grid-item-label">Ïö©Ïó≠(Í≥ÑÏïΩ) Í∏àÏï°</div>
                            <div id="deepAmount" class="deep-grid-item-value">-</div>
                        </div>
                        <div>
                            <div class="deep-grid-item-label">Ï¥ù ÏÇ¨ÏóÖÎπÑ</div>
                            <div id="deepBudget" class="deep-grid-item-value">-</div>
                        </div>
                    </div>
                </section>

                <section>
                    <div class="deep-section-title">Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏</div>
                    <ul id="deepCheckpoints" class="deep-checkpoints"></ul>
                </section>

                <section>
                    <div class="deep-section-title">Ï≤®Î∂ÄÌååÏùº</div>
                    <div class="deep-attachments-box">
                        <div id="deepAttachmentsEmpty">Ï≤®Î∂ÄÌååÏùº Ï†ïÎ≥¥Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.</div>
                        <ul id="deepAttachmentsList" class="deep-attachments-list"></ul>
                        <div id="deepAttachmentsNote" style="margin-top:4px;font-size:11px;color:var(--text-soft);display:none;">
                            ‚Äª ÎÇòÎùºÏû•ÌÑ∞ ÏõêÎ¨∏ ÌéòÏù¥ÏßÄÏóêÏÑú ÎèôÏùº ÌååÏùºÎ™ÖÏùÑ Ï∞æÏïÑ Îã§Ïö¥Î°úÎìúÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.
                        </div>
                    </div>
                </section>

                <section>
                    <div class="deep-section-title">ÌïúÍµ≠ÏàòÏïà ÎåÄÏùë Ï†úÏïà</div>
                    <div id="deepSuggestion" class="deep-summary-text" style="white-space:pre-line;"></div>
                </section>

                <section>
                    <div class="deep-section-title">Ï°∞Î°Ä / Ïö©Îüâ / ÎåÄÏ±ÖÎ¨∏ÏÑú</div>

                    <div class="deep-kv-grid">
                        <div>
                            <div class="deep-grid-item-label">ÎåÄÏßÄÎ©¥Ï†Å(Ïà´Ïûê)</div>
                            <div id="deepAreaNum" class="deep-grid-item-value">-</div>
                        </div>
                        <div>
                            <div class="deep-grid-item-label">ÎåÄÏÉÅ Íµ¨Î∂Ñ</div>
                            <div id="deepTargetClass" class="deep-grid-item-value">-</div>
                        </div>
                    </div>

                    <div class="deep-small-block">
                        <div class="deep-grid-item-label">Ï°∞Î°Ä Í∑ºÍ±∞</div>
                        <div id="deepOrdinanceBasis" class="deep-summary-text" style="margin-top:6px;white-space:pre-line;"></div>
                        <div class="deep-grid-item-label" style="margin-top:10px;">Ï°∞Î°Ä Ï°∞Ìï≠</div>
                        <div id="deepOrdinanceClauses" class="deep-summary-text" style="margin-top:6px;white-space:pre-line;"></div>
                    </div>

                    <div class="deep-small-block">
                        <div class="deep-grid-item-label">Ïö©Îüâ ÏÇ∞Ï†ï ÏöîÏïΩ</div>
                        <div id="deepCapacitySummary" class="deep-summary-text" style="margin-top:6px;"></div>
                        <div class="deep-calc-table-wrap" style="margin-top:10px;">
                            <table class="deep-calc-table" style="width:100%;border-collapse:collapse;">
                                <tbody id="deepCalcTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="deep-report-row">
                        <div class="deep-report-left">
                            <div class="deep-grid-item-label">Ïö∞ÏàòÏú†Ï∂ú Ï†ÄÍ∞êÎåÄÏ±Ö Î¨∏ÏÑú</div>
                            <div id="deepMitigationLink" class="deep-report-link">-</div>
                        </div>
                        <button id="btnMitigationReport" class="btn btn-primary btn-small" type="button">
                            <span class="icon">üìù</span> ÎåÄÏ±ÖÎ¨∏ÏÑú ÏÉùÏÑ±
                        </button>
                    </div>
                </section>

                <section>
                    <div class="deep-section-title">Í≥µÍ≥†Î≤àÌò∏ / ÏõêÎ¨∏ ÎßÅÌÅ¨</div>
                    <div id="deepFooterInfo" style="font-size:11px;color:var(--text-soft);"></div>
                </section>
            </div>

            <div class="deep-footer">
                <div id="deepRisk" style="font-weight:500;"></div>
                <button id="deepOkBtn" class="btn btn-primary btn-small">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!-- Ï†ÑÏó≠ Î°úÎî© -->
    <div id="globalLoading" class="loading-overlay">
        <div class="loading-box">
            <div class="spinner-lg"></div>
            <div>
                <div id="globalLoadingText" class="loading-text-main">Î∂ÑÏÑù Ï§ë...</div>
                <div class="loading-text-sub">Ïû†ÏãúÎßå Í∏∞Îã§Î¶¨ÏãúÎ©¥ Í≤∞Í≥ºÍ∞Ä Ï†ïÎ¶¨Îê©ÎãàÎã§.</div>
            </div>
        </div>
    </div>

    <script>
    // ‚òÖ‚òÖ‚òÖ Apps Script WebApp URL ‚òÖ‚òÖ‚òÖ
        const API_BASE =
            'https://script.google.com/macros/s/AKfycbxxoKyR07FkajC6dvjlrDy8ns0L_HJaCAtGds7My9KSaF5BTEye8v1jaVjzoFC-YsjhuA/exec';

        // DOM helper (single element by id)
        const el = (id) => document.getElementById(id);


        // ‚òÖ‚òÖ‚òÖ Google Client ID ‚òÖ‚òÖ‚òÖ
        const CLIENT_ID =
            '1049915608396-i3jn8jrm24bc9mkagdtokk3rfa3li513.apps.googleusercontent.com';

        // ‚òÖ‚òÖ‚òÖ Target Calendar ID ‚òÖ‚òÖ‚òÖ
        const TARGET_CALENDAR_ID =
            'd51a10e0014dcbd83e98d0da91cda4f52f629c19652c15fc693ee4529bbbab04@group.calendar.google.com';

        // ÌÜ†ÌÅ∞ localStorage ÌÇ§
        const STORAGE_KEY_TOKEN = 'koreasuan_calendar_token';
        const STORAGE_KEY_EXP = 'koreasuan_calendar_token_exp';
        const STORAGE_KEY_EMAIL = 'koreasuan_login_email';

        let allData = [];
        let deepCurrentItem = null;

        let filterMode = 'all';
        let viewMode = 'history';   // Í∏∞Î≥∏ Î∑∞: ÏßÅÏ†ëÏûÖÏ∞∞ ¬∑ Í≥µÍ≥†Ï§ë

        // 2Îã®Í≥Ñ: ÏÇ¨Ïù¥Îìú ÌïÑÌÑ∞ ÏÉÅÌÉú
        let stateFilter = 'all';   // all | open | closed | calendar
        let routeFilter = 'all';   // all | direct | designer | builder
        let sourceFilter = 'all';   // all | API | EAIS | EXTERNAL | SMART
        let winnerFilter = 'all';   // all | has

        let tokenClient = null;
        let accessToken = null;
        let loginUserEmail = null;   // ‚Üê Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©Ïûê Ïù¥Î©îÏùº

        window.addEventListener('load', () => {
            bindUI();
            loadData();
            initGoogle();
        });

        // ---------------- Í≥µÌÜµ Helper ----------------

        // ÎßÅÌÅ¨ Ï†ïÍ∑úÌôî: ÏõêÎ¨∏ URL(originUrl)ÏùÑ ÏµúÏö∞ÏÑ† ÏÇ¨Ïö©
        function normalizeLink(item) {
            const cand =
                (item.originUrl ||
                    item.link ||
                    item.srcUrl ||
                    item.detailUrl ||
                    item.url ||
                    '').toString().trim();
            if (!cand) return '';
            if (!/^https?:\/\//i.test(cand)) return '';
            return cand;
        }

        // Ï†úÎ™© Ï†ïÍ∑úÌôî: ÏõêÎ¨∏ Ï†úÎ™©(rawTitle) Ïö∞ÏÑ† (AIÍ∞Ä Î∞îÍæº Ï†úÎ™©ÏùÄ ÏÇ¨Ïö© X)
        function normalizeTitle(item) {
            return (
                item.rawTitle ||      // Ïô∏Î∂ÄÏÇ¨Ïù¥Ìä∏ ÏõêÎ¨∏ Ï†úÎ™©
                item.title ||         // Í∏∞Î≥∏ Ï†úÎ™©
                item.subject ||       // Í∏∞ÌÉÄ ÌïÑÎìú
                ''
            );
        }

        // ---------------- Google Î°úÍ∑∏Ïù∏/Î°úÍ∑∏ÏïÑÏõÉ & UI ----------------

        function updateLoginUI(connected) {
            const btn = document.getElementById('btnLogin');
            const lbl = document.getElementById('btnLoginLabel');
            const dot = document.getElementById('loginStatusDot');
            const text = document.getElementById('loginStatusText');
            if (!btn || !lbl || !dot || !text) return;

            // "Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú" ÌåêÎã® (Í∏∞Ï°¥ Î°úÏßÅ Ïú†ÏßÄ)
            const isLoggedIn = !!(connected && accessToken);

            if (isLoggedIn) {
                lbl.textContent = 'Î°úÍ∑∏ÏïÑÏõÉ';
                btn.disabled = false;
                dot.classList.add('connected');
                text.textContent = loginUserEmail
                    ? ('Ïó∞Îèô: ' + loginUserEmail)
                    : 'Ï∫òÎ¶∞Îçî Ïó∞ÎèôÎê®';
            } else {
                lbl.textContent = 'Î°úÍ∑∏Ïù∏';
                btn.disabled = false;
                dot.classList.remove('connected');
                text.textContent = 'Ï∫òÎ¶∞Îçî ÎØ∏Ïó∞Îèô';
            }

            // üîπ Ïó¨Í∏∞ÏÑú Î°úÍ∑∏Ïù∏ Ï†ÑÏö© Î≤ÑÌäºÎì§ Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞
            const loginOnlyEls = document.querySelectorAll('.login-only');
            loginOnlyEls.forEach(el => {
                el.style.display = isLoggedIn ? '' : 'none';
            });
        }


        function saveToken(token, expiresInSec, email) {
            if (!token) {
                localStorage.removeItem(STORAGE_KEY_TOKEN);
                localStorage.removeItem(STORAGE_KEY_EXP);
                localStorage.removeItem(STORAGE_KEY_EMAIL);
                return;
            }
            const exp = Date.now() + (expiresInSec || 3600) * 1000;
            localStorage.setItem(STORAGE_KEY_TOKEN, token);
            localStorage.setItem(STORAGE_KEY_EXP, String(exp));
            if (email) localStorage.setItem(STORAGE_KEY_EMAIL, String(email));
        }

        function loadSavedTokenIfValid() {
            const t = localStorage.getItem(STORAGE_KEY_TOKEN);
            const exp = parseInt(localStorage.getItem(STORAGE_KEY_EXP) || '0', 10);
            const savedEmail = localStorage.getItem(STORAGE_KEY_EMAIL);

            if (t && exp && exp > Date.now()) {
                accessToken = t;
                if (!loginUserEmail && savedEmail) loginUserEmail = savedEmail;
                updateLoginUI(true);
            } else {
                accessToken = null;
                // emailÏùÄ ÌÜ†ÌÅ∞Í≥º Ìï®Íªò Í¥ÄÎ¶¨
                saveToken(null);
                loginUserEmail = null;
                updateLoginUI(false);
            }
        }

        function initGoogle() {
            if (!window.google || !google.accounts || !google.accounts.oauth2) {
                return;
            }

            // Í∏∞Ï°¥ ÌÜ†ÌÅ∞ Î≥µÍµ¨
            loadSavedTokenIfValid();

            // ÌÜ†ÌÅ∞ Í∞±Ïã†ÏùÑ PromiseÎ°ú Í∏∞Îã§Î¶¥ Ïàò ÏûàÍ≤å(ÏÑ∏ÏÖòÏù¥ ÌíÄÎ¶∞ Í≤ÉÏ≤òÎüº Î≥¥Ïù¥Îäî ÌòÑÏÉÅ Î∞©ÏßÄ)
            let _tokenWaiter = null;
            const _resolveTokenWaiter = (ok) => {
                try { if (_tokenWaiter) { _tokenWaiter(ok); } } finally { _tokenWaiter = null; }
            };

            async function requestAccessTokenAsync(promptMode) {
                if (!tokenClient) throw new Error('tokenClient not ready');
                return await new Promise((resolve, reject) => {
                    _tokenWaiter = (ok) => ok ? resolve(true) : resolve(false);
                    try {
                        tokenClient.requestAccessToken({ prompt: promptMode || '' });
                    } catch (e) {
                        _tokenWaiter = null;
                        reject(e);
                    }
                });
            }

            async function ensureEmailLoaded() {
                if (loginUserEmail) return true;
                const savedEmail = localStorage.getItem(STORAGE_KEY_EMAIL);
                if (savedEmail) {
                    loginUserEmail = savedEmail;
                    return true;
                }
                if (!accessToken) return false;
                try {
                    const uRes = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                        headers: { Authorization: 'Bearer ' + accessToken }
                    });
                    if (uRes.ok) {
                        const info = await uRes.json();
                        if (info && info.email) {
                            loginUserEmail = info.email;
                            localStorage.setItem(STORAGE_KEY_EMAIL, loginUserEmail);
                            return true;
                        }
                    }
                } catch (e) {
                    console.warn('ensureEmailLoaded userinfo error', e);
                }
                return false;
            }

            async function ensureLogin(reasonText) {
                // access tokenÏù¥ ÏóÜÏúºÎ©¥ Î°úÍ∑∏Ïù∏ ÌïÑÏöî
                if (!accessToken) {
                    alert((reasonText || 'Ìï¥Îãπ Í∏∞Îä•') + 'ÏùÄ(Îäî) Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§. (ÏÉÅÎã® Ï∫òÎ¶∞Îçî Ïó∞Îèô Î≤ÑÌäº)');
                    return false;
                }

                // ÎßåÎ£å ÏûÑÎ∞ï Ïãú(60Ï¥à) ÏûêÎèô Í∞±Ïã† ÏãúÎèÑ
                const exp = parseInt(localStorage.getItem(STORAGE_KEY_EXP) || '0', 10);
                if (exp && exp < Date.now() + 60 * 1000) {
                    try {
                        await requestAccessTokenAsync('');
                    } catch (e) {
                        console.warn('token refresh failed', e);
                    }
                }

                // email ÌôïÎ≥¥(Ïã§Ìå®Ìï¥ÎèÑ Í∏∞Ï°¥Í∞í Ïú†ÏßÄ)
                const okEmail = await ensureEmailLoaded();
                if (!okEmail) {
                    alert('Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥(Ïù¥Î©îÏùº)Î•º ÌôïÏù∏Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\nÏÉÅÎã® Î°úÍ∑∏Ïù∏(Ï∫òÎ¶∞Îçî Ïó∞Îèô) Î≤ÑÌäºÏùÑ Îã§Ïãú ÎàåÎü¨ Ï£ºÏÑ∏Ïöî.');
                    return false;
                }
                updateLoginUI(true);
                return true;
            }

            // Ï†ÑÏó≠ÏóêÏÑú ÏÇ¨Ïö©(Ï†ÄÏû•/2Ï∞®Î∂ÑÏÑù/ÎåÄÏ±ÖÎ¨∏ÏÑú Îì±)
            window.__ensureLogin = ensureLogin;
            window.__ensureEmailLoaded = ensureEmailLoaded;
            window.__requestAccessTokenAsync = requestAccessTokenAsync;
            window.__resolveTokenWaiter = _resolveTokenWaiter;

            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/userinfo.email',
                callback: async (resp) => {
                    if (resp.error) {
                        alert('Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + resp.error);
                        if (window.__resolveTokenWaiter) window.__resolveTokenWaiter(false);
                        return;
                    }
                    if (!resp.access_token) { if (window.__resolveTokenWaiter) window.__resolveTokenWaiter(false); return; }

                    accessToken = resp.access_token;
                    saveToken(resp.access_token, resp.expires_in);
                    try {
                        // Ïù¥Î©îÏùº Ï°∞Ìöå (Ïã§Ìå®Ìï¥ÎèÑ Í∏∞Ï°¥ Ï†ÄÏû•Îêú Ïù¥Î©îÏùºÏùÑ Ïú†ÏßÄ)
                        const uRes = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                            headers: { Authorization: 'Bearer ' + accessToken }
                        });
                        if (uRes.ok) {
                            const info = await uRes.json();
                            if (info && info.email) {
                                loginUserEmail = info.email;
                                localStorage.setItem(STORAGE_KEY_EMAIL, loginUserEmail);
                            }
                        } else {
                            // Ïú†ÏßÄ
                            const savedEmail = localStorage.getItem(STORAGE_KEY_EMAIL);
                            if (!loginUserEmail && savedEmail) loginUserEmail = savedEmail;
                        }
                    } catch (e) {
                        console.error('userinfo error', e);
                        const savedEmail = localStorage.getItem(STORAGE_KEY_EMAIL);
                        if (!loginUserEmail && savedEmail) loginUserEmail = savedEmail;
                    }

                    updateLoginUI(true);
                    // ÌÜ†ÌÅ∞ Í∞±Ïã† ÎåÄÍ∏∞Ïûê Ìï¥Ï†ú
                    if (window.__resolveTokenWaiter) window.__resolveTokenWaiter(true);
                }
            });

            const btnLogin = document.getElementById('btnLogin');
            btnLogin.onclick = () => {
                // Ïù¥ÎØ∏ Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÎ©¥ ‚Üí Î°úÍ∑∏ÏïÑÏõÉ
                if (accessToken) {
                    const tokenToRevoke = accessToken;
                    accessToken = null;
                    loginUserEmail = null;
                    saveToken(null);
                    updateLoginUI(false);
                    if (google.accounts.oauth2.revoke) {
                        google.accounts.oauth2.revoke(tokenToRevoke, () => { });
                    }
                    return;
                }
                // Î°úÍ∑∏Ïù∏ ÏãúÎèÑ
                tokenClient.requestAccessToken({ prompt: '' });
            };
        }

        

        // ---------------- API helper (Î°úÍ∑∏Ïù∏/Ïù¥Î©îÏùº/ÌÜ†ÌÅ∞ Ìè¨Ìï®) ----------------

        async function apiGet(action, paramsObj, requireLogin, reasonText) {
            const params = new URLSearchParams();
            params.set('action', action);
            if (paramsObj) {
                Object.keys(paramsObj).forEach(k => {
                    const v = paramsObj[k];
                    if (v === undefined || v === null) return;
                    const s = String(v);
                    if (s === '') return;
                    params.set(k, s);
                });
            }

            if (requireLogin) {
                const ok = await window.__ensureLogin(reasonText || action);
                if (!ok) return { ok: false, error: 'LOGIN_REQUIRED' };
                params.set('userEmail', loginUserEmail || '');
                params.set('authToken', accessToken || '');
            }

            const res = await fetch(`${API_BASE}?${params.toString()}`, { method: 'GET' });
            if (!res.ok) {
                const t = await res.text();
                return { ok: false, error: 'HTTP_' + res.status, message: t };
            }
            return await res.json();
        }

        async function apiPostJson(action, bodyObj, requireLogin, reasonText) {
            const payload = Object.assign({ action }, bodyObj || {});
            if (requireLogin) {
                const ok = await window.__ensureLogin(reasonText || action);
                if (!ok) return { ok: false, error: 'LOGIN_REQUIRED' };
                payload.userEmail = loginUserEmail || '';
                payload.authToken = accessToken || '';
            }

            // ‚ö†Ô∏è preflight Î∞©ÏßÄ: Content-Type Ìó§ÎçîÎ•º ÏßÄÏ†ïÌïòÏßÄ ÏïäÏùå (text/plainÎ°ú Ï†ÑÏÜ°)
            const res = await fetch(API_BASE, {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            if (!res.ok) {
                const t = await res.text();
                return { ok: false, error: 'HTTP_' + res.status, message: t };
            }
            return await res.json();
        }


// ---------------- Í≥µÌÜµ UI & Îç∞Ïù¥ÌÑ∞ Î°úÎìú ----------------

        function bindUI() {
            document.getElementById('btnRefresh').addEventListener('click', refreshAll);
            document.getElementById('btnExternal').addEventListener('click', externalUpdate);
            document.getElementById('btnEAISL04').addEventListener('click', eaisUpdateL04);
            document.getElementById('searchInput').addEventListener('input', applyFilter);
            document.getElementById('filterRegion').addEventListener('change', applyFilter);

            // Í¥ÄÎ†®ÏÑ± Ïπ© (Ï†ÑÏ≤¥ / ÏÉÅ / Ï§ë Ïù¥ÏÉÅ)
            document.querySelectorAll('.chip-rel').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('.chip-rel').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    filterMode = chip.dataset.rel || 'all';
                    applyFilter();
                });
            });

            // ÏÇ¨Ïù¥Îìú ÌïÑÌÑ∞ Ïπ© (ÏÉÅÌÉú / ÏòÅÏóÖ Í≤ΩÎ°ú / ÏÜåÏä§ / ÎÇôÏ∞∞Ïûê)
            document.querySelectorAll('.chip-filter').forEach(chip => {
                chip.addEventListener('click', () => {
                    const group = chip.dataset.filterGroup;
                    const value = chip.dataset.filterValue || 'all';

                    // Í∞ôÏùÄ Í∑∏Î£π ÎÇ¥ activeÎßå ÌÜ†Í∏Ä
                    document
                        .querySelectorAll(`.chip-filter[data-filter-group="${group}"]`)
                        .forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');

                    if (group === 'state') stateFilter = value;
                    else if (group === 'route') routeFilter = value;
                    else if (group === 'source') sourceFilter = value;
                    else if (group === 'winner') winnerFilter = value;

                    applyFilter();
                });
            });

            // ÏóÖÎ¨¥ Î∑∞ ÌÉ≠ ÌÅ¥Î¶≠
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    viewMode = tab.dataset.view || 'history';  // direct / target / history
                    applyFilter();
                });
            });

            // Î™®Îã¨ Í¥ÄÎ†®
            document.getElementById('btnSmartAddOpen').addEventListener('click', openSmartModal);
            document.getElementById('btnSmartClose').addEventListener('click', closeSmartModal);
            document.getElementById('btnSmartCancel').addEventListener('click', closeSmartModal);
            document.getElementById('smartModalBackdrop').addEventListener('click', e => {
                if (e.target.id === 'smartModalBackdrop') closeSmartModal();
            });
            document.getElementById('smartForm').addEventListener('submit', handleSmartSubmit);

            // Deep modal
            document.getElementById('deepModalBackdrop').addEventListener('click', e => {
                if (e.target.id === 'deepModalBackdrop') closeDeepModal();
            });
            document.getElementById('deepCloseBtn').addEventListener('click', closeDeepModal);
            document.getElementById('deepOkBtn').addEventListener('click', closeDeepModal);
        }

        function setGlobalLoading(on, msg) {
            const ol = document.getElementById('globalLoading');
            const txt = document.getElementById('globalLoadingText');
            const ring = document.getElementById('donutRing');
            if (!ol) return;
            ol.classList.toggle('active', !!on);
            if (msg) txt.textContent = msg;
            if (ring) ring.style.animationPlayState = on ? 'running' : 'paused';
        }

        async function loadData() {
            const list = document.getElementById('bidList');

            // üî∏ Î°úÎî© Ï§ë ÏïàÎÇ¥ + Ïä§ÌîºÎÑà
            list.innerHTML =
                '<div class="loading-inline">' +
                '<div class="spinner-inline"></div>' +
                '<div>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>' +
                '</div>';

            try {
                const res = await fetch(API_BASE);
                const json = await res.json();
                allData = json.items || [];
                updateStatsUI(json.stats || {}, allData);
                applyFilter();
            } catch (e) {
                list.innerHTML =
                    '<div style="font-size:12px; color:#e17055; padding:20px;">Î°úÎìú Ïã§Ìå®: ' +
                    e.message +
                    '</div>';
            }
        }

        async function refreshAll() {
            const btn = document.getElementById('btnRefresh');
            btn.classList.add('loading');
            try {
                setGlobalLoading(true, 'ÎÇòÎùºÏû•ÌÑ∞ Ïû¨Ï°∞Ìöå Î∞è AI ÌïÑÌÑ∞ÎßÅ Ï§ë...');
                await fetch(API_BASE + '?action=updateAll');
                await loadData();
            } catch (e) {
                alert('Ïò§Î•ò: ' + e.message);
            } finally {
                btn.classList.remove('loading');
                setGlobalLoading(false);
            }
        }

        // Ïô∏Î∂ÄÏõ® ÏàòÏßë Î≤ÑÌäº Ìò∏Ï∂ú Ìï®Ïàò
        async function externalUpdate() {
            const btn = document.getElementById('btnExternal');
            const infoEl = document.getElementById('externalUpdateInfo');
            btn.classList.add('loading');
            try {
                setGlobalLoading(true, 'Ïô∏Î∂Ä ÏÜåÏä§ ÏàòÏßë Ï§ë...');
                const res = await fetch(API_BASE + '?action=external_update');
                const json = await res.json();

                if (!json || json.ok === false) {
                    const emsg = (json && (json.error || json.message)) ? (json.error || json.message) : 'Ïô∏Î∂ÄÏõπ ÏàòÏßë Ïã§Ìå®';
                    alert(emsg);
                    if (infoEl) infoEl.textContent = emsg;
                    return;
                }

                const lines = [];
                lines.push(`Ïã†Í∑ú ${json.added || 0}Í±¥ ÏàòÏßë ÏôÑÎ£å`);

                const tDup = json.dupSkipped ?? 0;
                const tFil = json.filtered ?? 0;
                const tLow = json.droppedLow ?? 0;
                if (tDup || tFil || tLow) {
                    lines.push(`(Ï§ëÎ≥µ ${tDup} / ÌïÑÌÑ∞Ï†úÏô∏ ${tFil} / ÌïòÏ†úÏô∏ ${tLow})`);
                }

                if (json.details && Array.isArray(json.details) && json.details.length) {
                    lines.push('');
                    lines.push('[ÏÇ¨Ïù¥Ìä∏Î≥Ñ]');
                    json.details.forEach(d => {
                        const name = d.siteName || d.source || 'SITE';
                        const cand = d.candidates ?? 0;
                        const add = d.added ?? 0;
                        const errN = (d.errors && Array.isArray(d.errors)) ? d.errors.length : 0;
                        const dup = d.dupSkipped ?? 0;
                        const fil = d.filtered ?? 0;
                        const low = d.droppedLow ?? 0;
                        const parts = [`- ${name}: ÌõÑÎ≥¥ ${cand} / Ïã†Í∑ú ${add}`];
                        if (dup) parts.push(`Ï§ëÎ≥µ ${dup}`);
                        if (fil) parts.push(`ÌïÑÌÑ∞Ï†úÏô∏ ${fil}`);
                        if (low) parts.push(`ÌïòÏ†úÏô∏ ${low}`);
                        if (errN) parts.push(`Ïò§Î•ò ${errN}`);
                        lines.push(parts.join(' / '));
                    });
                }

                if (json.errors && Array.isArray(json.errors) && json.errors.length) {
                    lines.push('');
                    lines.push('[Ïò§Î•ò ÏöîÏïΩ]');
                    json.errors.slice(0, 10).forEach(e => lines.push('- ' + e));
                    if (json.errors.length > 10) lines.push(`- (Í∑∏ Ïô∏ ${json.errors.length - 10}Í±¥ ÏÉùÎûµ)`);
                }

                const msg = lines.join('\n');
                alert(msg);
                if (infoEl) infoEl.textContent = msg;

                await loadData();
            } catch (e) {
                const emsg = 'Ïò§Î•ò: ' + (e && e.message ? e.message : e);
                alert(emsg);
                if (infoEl) infoEl.textContent = emsg;
            } finally {
                btn.classList.remove('loading');
                setGlobalLoading(false);
            }
        }

        
async function eaisUpdateL04() {
    try {
        setStatus('ÏÑ∏ÏõÄÌÑ∞ L04 ÏàòÏßë Ï§ë... (HTML/AI Î∞©Ïãù)');
        const l04 = 'https://www.eais.go.kr/moct/awp/aia01/AWPAIA01L04';
        const res = await fetch(API_BASE + `?action=update_eais&url=${encodeURIComponent(l04)}`, { cache: 'no-store' });
        const j = await res.json().catch(() => ({}));
        if (!res.ok || !j.ok) {
            console.warn('EAIS update failed:', j);
            alert('ÏÑ∏ÏõÄÌÑ∞ L04 ÏàòÏßë Ïã§Ìå®: ' + (j && (j.message || j.error) ? (j.message || j.error) : res.status));
            return;
        }
        const added = (j && j.added != null) ? j.added : '';
        const scanned = (j && j.scanned != null) ? j.scanned : '';
        const msg = `ÏÑ∏ÏõÄÌÑ∞ L04 ÏàòÏßë ÏôÑÎ£å (Ï∂îÍ∞Ä: ${added}, Ïä§Ï∫î: ${scanned})`;
        setStatus(msg);
        await loadData();
    } catch (e) {
        console.error(e);
        alert('ÏÑ∏ÏõÄÌÑ∞ L04 ÏàòÏßë Ïò§Î•ò: ' + (e && e.message ? e.message : e));
    }
}

        // ---------------- ÏÉÅÌÉú/Ï∂úÏ≤ò ÌåêÎ≥Ñ ----------------

        // ÎßàÍ∞êÏùº ÏßÄÎÇú Ïó¨Î∂Ä (ÎÇ†Ïßú+ÏãúÍ∞Ñ Í∏∞Ï§Ä, ÏßÄÎÇòÍ∏∞ Ï†ÑÍπåÏßÄÎäî Ïú†ÏßÄ)
        function isDeadlinePast(deadlineStr) {
            if (!deadlineStr) return false;

            const s = String(deadlineStr).trim();
            const dateMatch = s.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
            if (!dateMatch) return false; // ÌååÏã± Ïïà ÎêòÎ©¥ Ïà®Í∏∞ÏßÄ ÏïäÏùå

            const y = parseInt(dateMatch[1], 10);
            const mo = parseInt(dateMatch[2], 10) - 1;
            const d = parseInt(dateMatch[3], 10);

            // ÏãúÍ∞Ñ Ï†ïÎ≥¥ (HH:mm) ÏûàÏúºÎ©¥ Í∞ôÏù¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∑∏ÎÇ† 23:59:59ÍπåÏßÄ ÌëúÏãú
            const timeMatch = s.match(/(\d{1,2}):(\d{2})/);
            let hh = 23, mm = 59;
            if (timeMatch) {
                hh = parseInt(timeMatch[1], 10);
                mm = parseInt(timeMatch[2], 10);
            }

            const deadline = new Date(y, mo, d, hh, mm, 59);
            const now = new Date();

            return now.getTime() > deadline.getTime();
        }

        // D-Day ÌëúÍ∏∞Ïö© (D-3, D-Day, D+2 Îì±)
        function getDDayLabel(deadlineStr) {
            if (!deadlineStr) return '';
            const s = String(deadlineStr).trim();
            const m = s.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
            if (!m) return '';

            const y = parseInt(m[1], 10);
            const mo = parseInt(m[2], 10) - 1;
            const d = parseInt(m[3], 10);

            const today = new Date();
            const todayMid = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const ddlMid = new Date(y, mo, d);

            const diffDays = Math.round(
                (ddlMid.getTime() - todayMid.getTime()) / (1000 * 60 * 60 * 24)
            );

            if (diffDays > 0) return 'D-' + diffDays;
            if (diffDays === 0) return 'D-Day';
            return 'D+' + Math.abs(diffDays);
        }

        // Ï∂úÏ≤ò ÌåêÎ≥Ñ: ÎÇòÎùºÏû•ÌÑ∞(API) vs Ïô∏Î∂Ä
        function detectSource(item) {
            const kind = (item.srcKind || item.sourceKind || '').toUpperCase();
            if (kind === 'API') return 'API';
            if (kind === 'SMART') return 'SMART';
            if (kind === 'EXTERNAL') return 'EXTERNAL';

            const no = String(item.no || '');
            const link = normalizeLink(item);
            if (/^R\d/i.test(no)) return 'API';
            if (link.includes('g2b.go.kr')) return 'API';
            return 'EXTERNAL';
        }

        // Í¥ÄÎ†®ÏÑ± Îì±Í∏â: ÏãúÌä∏ Ïª¨Îüº(relevanceGrade)Ïù¥ ÏûàÏúºÎ©¥ Ïö∞ÏÑ† ÏÇ¨Ïö©
        // ÏóÜÏúºÎ©¥ aiResult/aiSummaryÏóêÏÑú Ï∂îÎ°† (1Îã®Í≥ÑÏóêÏÑú Ïù¥ÎØ∏ ÏûàÏúºÏãúÎ©¥ Ï§ëÎ≥µ Ï∂îÍ∞Ä X)
        function getRelevanceGrade(item) {
            const fromCol = (item.relevanceGrade || item.relevance || '').toString().trim();
            if (fromCol) return fromCol; // "ÏÉÅ" / "Ï§ë" / "Ìïò" Í∏∞ÎåÄ

            const txt = (item.aiResult || item.aiSummary || '').toString();
            if (/Í¥ÄÎ†®ÏÑ±\s*ÏÉÅ/.test(txt) || /\[.*ÏÉÅ.*\]/.test(txt)) return 'ÏÉÅ';
            if (/Í¥ÄÎ†®ÏÑ±\s*Ï§ë/.test(txt) || /\[.*Ï§ë.*\]/.test(txt)) return 'Ï§ë';
            if (!txt) return '';
            return 'Ìïò';
        }

        // ÏòÅÏóÖ Í≤ΩÎ°ú: ÏãúÌä∏ Ïª¨Îüº(salesRoute)ÏùÑ Í∏∞Î≥∏ÏúºÎ°ú ÏÇ¨Ïö©
        function getSalesRoute(item) {
            return (item.salesRoute || item.sales_route || '').toString().trim();
        }

        // Ï†ïÎ†¨Ïö© ÎßàÍ∞êÏùº ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ (ÏóÜÏúºÎ©¥ 0)
        function getDeadlineTime(item) {
            const s = String(item.deadline || item.closeDate || '').trim();
            if (!s) return 0;

            const dateMatch = s.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
            if (!dateMatch) return 0;

            const y = parseInt(dateMatch[1], 10);
            const mo = parseInt(dateMatch[2], 10) - 1;
            const d = parseInt(dateMatch[3], 10);

            const timeMatch = s.match(/(\d{1,2}):(\d{2})/);
            let hh = 23, mm = 59;
            if (timeMatch) {
                hh = parseInt(timeMatch[1], 10);
                mm = parseInt(timeMatch[2], 10);
            }

            const dt = new Date(y, mo, d, hh, mm, 59);
            return dt.getTime();
        }

        // Ï∫òÎ¶∞Îçî Îì±Î°ù Ïó¨Î∂Ä
        function hasCalendarEvent(item) {
            return !!(
                item.calendarId ||
                item.calendar_id ||
                item.calendarEventId ||
                item.calendar_event_id
            );
        }

        // ÎÇôÏ∞∞Ïûê Ï†ïÎ≥¥ Ï°¥Ïû¨ Ïó¨Î∂Ä
        function hasWinner(item) {
            return !!((item.winnerName || item.winner || '').toString().trim());
        }

        // Ï±ÑÎÑê(ÏÜåÏä§) Íµ¨Î∂Ñ: ÎÇòÎùºÏû•ÌÑ∞ / EAIS / Ïô∏Î∂ÄÏõπ / Ïä§ÎßàÌä∏Îì±Î°ù
        function detectSourceChannel(item) {
            const base = detectSource(item); // API / SMART / EXTERNAL
            if (base === 'API') return 'API';
            if (base === 'SMART') return 'SMART';

            const link = normalizeLink(item);
            if (link.includes('eais.go.kr')) return 'EAIS';
            return 'EXTERNAL';
        }

        // Í¥ÄÎ†®ÏÑ± Îì±Í∏â: ÏãúÌä∏ Ïª¨Îüº(relevanceGrade)Ïù¥ ÏûàÏúºÎ©¥ Ïö∞ÏÑ† ÏÇ¨Ïö©
        // ÏóÜÏúºÎ©¥ aiResult / aiSummary ÌÖçÏä§Ìä∏ÏóêÏÑú Ï∂îÎ°†

        function updateStatsUI(stats, items) {
            const apiRaw = stats.totalCountRaw || stats.totalItemsFromApi || stats.totalRaw || 0;

            const elTotal = document.getElementById('statTotalRaw');
            const elFiltered = document.getElementById('statFiltered');
            const elAi = document.getElementById('statAi');

            let keptApi = 0, keptExternal = 0, keptSmart = 0;
            let aiApi = 0, aiExternal = 0, aiSmart = 0;

            items.forEach(it => {
                const src = detectSource(it);
                const hasAi = !!(it.aiResult || it.aiSummary);

                if (src === 'API') {
                    keptApi++;
                    if (hasAi) aiApi++;
                } else if (src === 'SMART') {
                    keptSmart++;
                    if (hasAi) aiSmart++;
                } else {
                    keptExternal++;
                    if (hasAi) aiExternal++;
                }
            });

            const keptTotal = keptApi + keptExternal + keptSmart;
            const aiTotal = aiApi + aiExternal + aiSmart;

            // Ïô∏Î∂Ä/Ïä§ÎßàÌä∏ raw ÌÜµÍ≥ÑÍ∞Ä ÏÑúÎ≤ÑÏóêÏÑú ÏïàÏò§Î©¥, ÌòÑÏû¨ ÏãúÌä∏ Í±¥ÏàòÎ°ú ÎåÄÏ≤¥
            const externalRaw = stats.externalRaw || keptExternal;
            const smartRaw = stats.smartRaw || keptSmart;
            const totalAllRaw = apiRaw + externalRaw + smartRaw;

            if (elTotal) elTotal.textContent = totalAllRaw.toLocaleString();
            if (elFiltered) elFiltered.textContent = keptTotal.toLocaleString();
            if (elAi) elAi.textContent = aiTotal.toLocaleString();

            // Í∏∞Í∞Ñ / ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏
            const elPeriod = document.getElementById('statPeriod');
            if (elPeriod) {
                elPeriod.textContent = `Í∏∞Í∞Ñ: ÏµúÍ∑º ${stats.daysBack || 7}Ïùº`;
            }
            const elLast = document.getElementById('statLastUpdate');
            if (elLast) {
                elLast.textContent = `Last: ${stats.finishedAtText || '-'}`;
            }

            // Ïπ¥ÎìúÎ≥Ñ Î∏åÎ†àÏù¥ÌÅ¨Îã§Ïö¥
            const elTotalBr = document.getElementById('statTotalBreakdown');
            const elFiltBr = document.getElementById('statFilteredBreakdown');
            const elAiBr = document.getElementById('statAiBreakdown');
            const elReviewBr = document.getElementById('statSourceCounts');

            if (elTotalBr) {
                elTotalBr.textContent =
                    `ÎÇòÎùºÏû•ÌÑ∞ : ${apiRaw.toLocaleString()} / ` +
                    `Ïô∏Î∂ÄÏõπ : ${externalRaw.toLocaleString()} / ` +
                    `Ïä§ÎßàÌä∏Îì±Î°ù : ${smartRaw.toLocaleString()}`;
            }

            if (elFiltBr) {
                elFiltBr.textContent =
                    `ÎÇòÎùºÏû•ÌÑ∞ : ${keptApi.toLocaleString()} / ` +
                    `Ïô∏Î∂ÄÏõπ : ${keptExternal.toLocaleString()} / ` +
                    `Ïä§ÎßàÌä∏Îì±Î°ù : ${keptSmart.toLocaleString()}`;
            }

            if (elAiBr) {
                elAiBr.textContent =
                    `ÎÇòÎùºÏû•ÌÑ∞ : ${aiApi.toLocaleString()} / ` +
                    `Ïô∏Î∂ÄÏõπ : ${aiExternal.toLocaleString()} / ` +
                    `Ïä§ÎßàÌä∏Îì±Î°ù : ${aiSmart.toLocaleString()}`;
            }

            if (elReviewBr) {
                elReviewBr.innerHTML =
                    `ÎÇòÎùºÏû•ÌÑ∞ Í≥µÍ≥† Ïàò : ${keptApi.toLocaleString()}<br>` +
                    `Ïô∏Î∂ÄÏõπ ÏàòÏßë Í≥µÍ≥† Ïàò : ${keptExternal.toLocaleString()}<br>` +
                    `Í≥µÍ≥† Ïä§ÎßàÌä∏ Îì±Î°ù Í≥µÍ≥† Ïàò : ${keptSmart.toLocaleString()}`;
            }

            console.log(
                `[Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ] APIÏõêÎ≥∏:${apiRaw} / Í≤ÄÌÜ†ÎåÄÏÉÅ:${keptTotal}` +
                ` (API:${keptApi}, Ïô∏Î∂Ä:${keptExternal}, SMART:${keptSmart})` +
                ` / AIÏöîÏïΩ:${aiTotal}`
            );
        }


        // ÌòÑÏû¨ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî Í±¥Ïàò Î∞òÏòÅ
        function updateVisibleCount(visibleItems) {
            const n = visibleItems.length || 0;
            const statApiEl = document.getElementById('statApi');
            const donutMainEl = document.getElementById('donutMain');
            if (statApiEl) statApiEl.textContent = n.toLocaleString();
            if (donutMainEl) donutMainEl.textContent = n.toLocaleString();

            const resultBreakdownEl = document.getElementById('resultBreakdown');
            if (resultBreakdownEl) {
                let apiCount = 0, externalCount = 0;
                visibleItems.forEach(it => {
                    if (detectSource(it) === 'API') apiCount++;
                    else externalCount++;  // SMART + EXTERNAL Î™®Îëê Ïô∏Î∂Ä Ï™ΩÏúºÎ°ú
                });
                resultBreakdownEl.textContent =
                    `API ${apiCount} / Ïô∏Î∂Ä ${externalCount}`;
            }
        }


        // ---------------- ÌïÑÌÑ∞ Ï†ÅÏö© ----------------

        function applyFilter() {
            const kwRaw = document.getElementById('searchInput').value || '';
            const kw = kwRaw.trim().toLowerCase();
            const keywords = kw ? kw.split(/\s+/) : [];

            const region = document.getElementById('filterRegion').value.trim();

            const filtered = allData.filter(item => {
                const title = normalizeTitle(item);
                const link = normalizeLink(item);
                const aiText = (item.aiResult || '').toString().trim();
                const aiSummary = (item.aiSummary || '').toString().trim();
                // aiSummaryÏôÄ aiResultÍ∞Ä ÎèôÏùºÌïú Í≤ΩÏö∞(Ï§ëÎ≥µ ÌëúÍ∏∞ Î∞©ÏßÄ)
                const aiDetail = (aiSummary && aiText && aiText !== aiSummary) ? aiText : (aiSummary ? '' : aiText);

                const deadlineStr = item.deadline || item.closeDate || '';
                const isPast = isDeadlinePast(deadlineStr);
                const salesRoute = getSalesRoute(item);
                const relGrade = getRelevanceGrade(item); // "ÏÉÅ" / "Ï§ë" / "Ìïò" / ""
                const hasCal = hasCalendarEvent(item);
                const channel = detectSourceChannel(item); // API / EAIS / EXTERNAL / SMART
                const hasWin = hasWinner(item);

                // ‚ë† ÏóÖÎ¨¥ ÌÉ≠Î≥Ñ Í∏∞Î≥∏ Ï°∞Í±¥ --------------------------------------
                if (viewMode === 'direct') {
                    // ÏßÅÏ†ëÏûÖÏ∞∞ ¬∑ Í≥µÍ≥†Ï§ë: ÎßàÍ∞ê Ï†Ñ + ÏòÅÏóÖÍ≤ΩÎ°ú = ÏßÅÏ†ëÏûÖÏ∞∞
                    if (isPast) return false;
                    if (salesRoute !== 'ÏßÅÏ†ëÏûÖÏ∞∞') return false;
                } else if (viewMode === 'target') {
                    // ÎÇôÏ∞∞Ïûê ÌÉÄÍπÉ: ÎßàÍ∞êÎêú Í±¥ + Í¥ÄÎ†®ÏÑ± ÏÉÅ/Ï§ë + ÏòÅÏóÖÍ≤ΩÎ°ú = ÏÑ§Í≥ÑÏÇ¨/ÏãúÍ≥µÏÇ¨ ÌÉÄÍπÉ
                    if (!isPast) return false;
                    if (relGrade !== 'ÏÉÅ' && relGrade !== 'Ï§ë') return false;
                    if (salesRoute !== 'ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ' && salesRoute !== 'ÏãúÍ≥µÏÇ¨ÌÉÄÍπÉ') return false;
                }
                // history(Ï†ÑÏ≤¥/ÌûàÏä§ÌÜ†Î¶¨)Îäî Î≥ÑÎèÑ Í∏∞Î≥∏ Ï°∞Í±¥ ÏóÜÏùå

                // ‚ë° ÏÉÅÌÉú ÌïÑÌÑ∞ (Í≥µÍ≥†Ï§ë / ÎßàÍ∞ê / Ï∫òÎ¶∞Îçî Îì±Î°ùÎê®) -----------------
                if (stateFilter === 'open' && isPast) return false;
                if (stateFilter === 'closed' && !isPast) return false;
                if (stateFilter === 'calendar' && !hasCal) return false;

                // ‚ë¢ ÏòÅÏóÖ Í≤ΩÎ°ú ÌïÑÌÑ∞ --------------------------------------------
                if (routeFilter === 'direct' && salesRoute !== 'ÏßÅÏ†ëÏûÖÏ∞∞') return false;
                if (routeFilter === 'designer' && salesRoute !== 'ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ') return false;
                if (routeFilter === 'builder' && salesRoute !== 'ÏãúÍ≥µÏÇ¨ÌÉÄÍπÉ') return false;

                // ‚ë£ ÏÜåÏä§/Ï±ÑÎÑê ÌïÑÌÑ∞ -------------------------------------------
                if (sourceFilter === 'API' && channel !== 'API') return false;
                if (sourceFilter === 'EAIS' && channel !== 'EAIS') return false;
                if (sourceFilter === 'EXTERNAL' && channel !== 'EXTERNAL') return false;
                if (sourceFilter === 'SMART' && channel !== 'SMART') return false;

                // ‚ë§ ÏßÄÏó≠ ÌïÑÌÑ∞ -------------------------------------------------
                if (region) {
                    const r = (item.region || item.area || '').toString();
                    if (!r.includes(region)) return false;
                }

                // ‚ë• Í¥ÄÎ†®ÏÑ± Ïπ© ÌïÑÌÑ∞ (Ï†ÑÏ≤¥ / ÏÉÅ / Ï§ë Ïù¥ÏÉÅ) ----------------------
                let relFlag = 'low';
                if (relGrade === 'ÏÉÅ') relFlag = 'high';
                else if (relGrade === 'Ï§ë') relFlag = 'mid';

                if (filterMode === 'high' && relFlag !== 'high') return false;
                if (filterMode === 'mid' && relFlag === 'low') return false;

                // ‚ë¶ ÎÇôÏ∞∞Ïûê ÌïÑÌÑ∞ ----------------------------------------------
                if (winnerFilter === 'has' && !hasWin) return false;

                // ‚ëß Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ (Î™®Îì† Îã®Ïñ¥ Ìè¨Ìï®) ------------------------------
                if (keywords.length) {
                    const blob = (
                        title +
                        ' ' + (item.client || '') +
                        ' ' + (item.agency || '') +
                        ' ' + (item.no || item.bidNo || '') +
                        ' ' + (item.winnerName || item.winner || '') +
                        ' ' + (item.region || '') +
                        ' ' + (item.field || item.bizType || '') +
                        ' ' + aiText +
                        ' ' + aiSummary +
                        ' ' + link
                    ).toLowerCase();

                    for (const token of keywords) {
                        if (!token) continue;
                        if (blob.indexOf(token) === -1) return false;
                    }
                }

                return true;
            });

            // ‚ë® ÌÉ≠Î≥Ñ Ï†ïÎ†¨ ---------------------------------------------------
            const sorted = filtered.slice();

            if (viewMode === 'direct') {
                // D-Day Í∞ÄÍπåÏö¥ Ïàú (ÎßàÍ∞êÏùº Ïò§Î¶ÑÏ∞®Ïàú)
                sorted.sort((a, b) => {
                    const ta = getDeadlineTime(a) || 0;
                    const tb = getDeadlineTime(b) || 0;
                    return ta - tb;
                });
            } else if (viewMode === 'target') {
                // ÏµúÍ∑ºÏóê ÎßàÍ∞êÎêú Ïàú (ÎßàÍ∞êÏùº ÎÇ¥Î¶ºÏ∞®Ïàú)
                sorted.sort((a, b) => {
                    const ta = getDeadlineTime(a) || 0;
                    const tb = getDeadlineTime(b) || 0;
                    return tb - ta;
                });
            }

            // history(Ï†ÑÏ≤¥/ÌûàÏä§ÌÜ†Î¶¨)Îäî ÏÑúÎ≤Ñ/ÏãúÌä∏ ÏàúÏÑú Ïú†ÏßÄ

            console.log(
                `[ÌïÑÌÑ∞] view=${viewMode}, state=${stateFilter}, route=${routeFilter}, ` +
                `source=${sourceFilter}, winner=${winnerFilter} / Ï†ÑÏ≤¥ ${allData.length}Í±¥ ‚Üí ` +
                `Î≥¥Ïù¥Îäî ${sorted.length}Í±¥ (Í≤ÄÏÉâ="${kw}", ÏßÄÏó≠="${region || 'Ï†ÑÏ≤¥'}", relMode="${filterMode}")`
            );

            updateVisibleCount(sorted);
            renderList(sorted);
        }

        // ---------------- Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ ----------------

        function renderList(data) {
            const list = document.getElementById('bidList');
            list.innerHTML = '';
            document.getElementById('resultCount').textContent = data.length;

            if (!data.length) {
                list.innerHTML =
                    '<div style="padding:20px;color:#b2bec3;font-size:12px;">' +
                    'Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÎäî Í≥µÍ≥†Í∞Ä ÏóÜÏäµÎãàÎã§. ÌïÑÌÑ∞Î•º Ï°∞Ï†ïÌï¥ Î≥¥ÏÑ∏Ïöî.' +
                    '</div>';
                return;
            }

            // 1Îã®Í≥ÑÏóêÏÑú Ï∂îÍ∞ÄÌïú viewMode (direct / target / history)
            const currentView = (typeof viewMode !== 'undefined') ? viewMode : 'history';

            data.forEach((item, index) => {
                const sourceBase = detectSource(item);          // API / SMART / EXTERNAL
                const sourceChannel = detectSourceChannel(item);   // API / EAIS / EXTERNAL / SMART

                const title = normalizeTitle(item) || '(Ï†úÎ™© ÏóÜÏùå)';
                const link = normalizeLink(item);

                const region = item.region || item.area || '';
                const no = item.no || item.bidNo || '';
                const client = item.client || item.agency || '';
                const regDate = item.regDate || item.noticeDate || '';
                const deadline = item.deadline || item.closeDate || '';
                const openDate = item.openDate || item.openingDate || '';

                const amount = item.serviceAmount || item.amount || '';
                const budget = item.projectBudget || item.budget || '';

                const bizType = item.bizType || item.field || item.jobType || '';
                const manualTag = item.manualTag || '';
                const createdBy = item.createdBy || item.createdByEmail || '';

                // 3Îã®Í≥ÑÏóêÏÑú ÌôúÏö©Ìï† ÏÉà ÌïÑÎìúÎì§
                const facilityType = item.facilityType || item.facility || '';
                const estimatedTon = item.estimatedTon || item.estimateTon || item.ton || '';

                const relGrade = getRelevanceGrade(item);  // ÏÉÅ / Ï§ë / Ìïò / ""
                const salesRoute = getSalesRoute(item);      // ÏßÅÏ†ëÏûÖÏ∞∞ / ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ / ÏãúÍ≥µÏÇ¨ÌÉÄÍπÉ / ...

                const winnerName = item.winnerName || item.winner || '';
                const winnerType = item.winnerType || '';
                const winnerContact = item.winnerContact || item.winnerPhone || item.winnerTel || '';

                const aiText = (item.aiResult || '').toString().trim();
                const aiSummary = (item.aiSummary || '').toString().trim();
                // aiSummaryÏôÄ aiResultÍ∞Ä ÎèôÏùºÌïú Í≤ΩÏö∞(Ï§ëÎ≥µ ÌëúÍ∏∞ Î∞©ÏßÄ)
                const aiDetail = (aiSummary && aiText && aiText !== aiSummary) ? aiText : (aiSummary ? '' : aiText);

                const past = isDeadlinePast(deadline);
                const ddayLabel = (!past && currentView === 'direct')
                    ? getDDayLabel(deadline)
                    : '';

                const card = document.createElement('article');
                card.className = 'bid-card';

                const inner = document.createElement('div');
                inner.className = 'bid-card-inner';

                // ---------------- ÏÉÅÎã® Ìñâ: ÏßÄÏó≠ / Í≥µÍ≥†Î≤àÌò∏ / (D-Day) / ÏÉÅÌÉú / ÏÜåÏä§ ----------
                const topRow = document.createElement('div');
                topRow.className = 'bid-top-row';

                const leftTop = document.createElement('div');
                leftTop.style.display = 'flex';
                leftTop.style.alignItems = 'center';
                leftTop.style.gap = '6px';

                if (region) {
                    const badgeRegion = document.createElement('span');
                    badgeRegion.className = 'badge-region';
                    badgeRegion.textContent = region;
                    leftTop.appendChild(badgeRegion);
                }

                let displayNo = no;
                if (sourceBase !== 'API') {
                    if (!displayNo || /^0+$/.test(String(displayNo))) {
                        displayNo = 'Ïô∏Î∂Ä(Î≤àÌò∏ÏóÜÏùå)';
                    }
                }
                if (displayNo) {
                    const bidNoSpan = document.createElement('span');
                    bidNoSpan.className = 'bid-no';
                    bidNoSpan.textContent = '#' + displayNo;
                    leftTop.appendChild(bidNoSpan);
                }

                topRow.appendChild(leftTop);

                const rightTop = document.createElement('div');
                rightTop.style.display = 'flex';
                rightTop.style.alignItems = 'center';
                rightTop.style.gap = '6px';

                // D-Day (ÏßÅÏ†ëÏûÖÏ∞∞ ¬∑ Í≥µÍ≥†Ï§ë ÌÉ≠ÏóêÏÑúÎßå Í∞ïÏ°∞)
                if (ddayLabel) {
                    const ddaySpan = document.createElement('span');
                    ddaySpan.className = 'd-day-badge';
                    ddaySpan.textContent = ddayLabel;
                    rightTop.appendChild(ddaySpan);
                }

                // ÏÉÅÌÉú Î±ÉÏßÄ: ÎßàÍ∞ê/Í≥µÍ≥†Ï§ë
                const statusBadge = document.createElement('span');
                statusBadge.className = 'badge-status';
                if (past) {
                    statusBadge.classList.add('closed');
                    statusBadge.textContent = 'ÎßàÍ∞ê';
                } else {
                    statusBadge.classList.add('open');
                    statusBadge.textContent = 'Í≥µÍ≥†Ï§ë';
                }
                rightTop.appendChild(statusBadge);

                // AI ÏÉÅÌÉú Î±ÉÏßÄ (1Ï∞® AI ÏöîÏïΩ Í∏∞Ï§Ä)
                const aiBadge = document.createElement('span');
                aiBadge.className = 'badge-ai';
                const aiHas = !!(aiText || aiSummary);
                const aiErr = !!(item.aiError || item.aiErrorMsg || item.aiErrorMessage || item.aiStatus === 'ERROR');
                if (aiErr) {
                    aiBadge.classList.add('error');
                    aiBadge.textContent = 'AIÏò§Î•ò';
                } else if (aiHas) {
                    aiBadge.classList.add('done');
                    aiBadge.textContent = 'AIÏôÑÎ£å';
                } else {
                    aiBadge.classList.add('pending');
                    aiBadge.textContent = 'AIÎåÄÍ∏∞';
                }
                rightTop.appendChild(aiBadge);

                // Ï∂úÏ≤ò Î±ÉÏßÄ
                const sourceBadge = document.createElement('span');
                sourceBadge.className = 'badge-source';
                if (sourceChannel === 'API') {
                    sourceBadge.textContent = 'ÎÇòÎùºÏû•ÌÑ∞';
                } else if (sourceChannel === 'EAIS') {
                    sourceBadge.textContent = 'EAIS';
                } else if (sourceChannel === 'SMART') {
                    sourceBadge.textContent = 'Ïä§ÎßàÌä∏ Îì±Î°ù';
                } else {
                    sourceBadge.textContent = 'Ïô∏Î∂ÄÏàòÏßë';
                }
                rightTop.appendChild(sourceBadge);

                // ÏàòÎèô ÌÉúÍ∑∏ ÏûàÏúºÎ©¥ ÌëúÏãú
                if (manualTag) {
                    const manualBadge = document.createElement('span');
                    manualBadge.className = 'badge-status manual';
                    manualBadge.textContent = manualTag;
                    rightTop.appendChild(manualBadge);
                }

                topRow.appendChild(rightTop);
                inner.appendChild(topRow);

                // ---------------- 1Ï§ÑÁõÆ: ÌÉúÍ∑∏ Ï§Ñ ([ÏÉÅ-ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ] ÌïôÍµê / ~300ÌÜ§ ÏòàÏÉÅ) -------
                const tagRow = document.createElement('div');
                tagRow.className = 'tag-row';

                // Î©îÏù∏ ÌÉúÍ∑∏: "ÏÉÅ-ÏÑ§Í≥ÑÏÇ¨ÌÉÄÍπÉ" ÌòïÌÉú
                const mainTagPieces = [];
                if (relGrade) mainTagPieces.push(relGrade);
                if (salesRoute) mainTagPieces.push(salesRoute);
                const mainTagLabel = mainTagPieces.length ? mainTagPieces.join('-') : '';

                if (mainTagLabel) {
                    const pill = document.createElement('span');
                    pill.className = 'tag-pill primary';
                    pill.textContent = mainTagLabel;
                    tagRow.appendChild(pill);
                }

                // ÏãúÏÑ§ Ïú†Ìòï
                if (facilityType) {
                    const pill = document.createElement('span');
                    pill.className = 'tag-pill';
                    pill.textContent = facilityType;
                    tagRow.appendChild(pill);
                }

                // ÏòàÏÉÅ ÌÜ§Ïàò (~300ÌÜ§ ÏòàÏÉÅ)
                if (estimatedTon) {
                    const num = parseInt(
                        String(estimatedTon).toString().replace(/[^0-9\-]/g, ''),
                        10
                    );
                    if (!Number.isNaN(num) && num > 0) {
                        const pill = document.createElement('span');
                        pill.className = 'tag-pill warn';
                        pill.textContent = `~${num.toLocaleString()}ÌÜ§ ÏòàÏÉÅ`;
                        tagRow.appendChild(pill);
                    }
                }

                if (tagRow.children.length > 0) {
                    inner.appendChild(tagRow);
                }

                // ---------------- 2Ï§ÑÁõÆ: Í≥µÍ≥†Î™Ö (ÌÅ¥Î¶≠ Ïãú ÏõêÎ¨∏ ÎßÅÌÅ¨) -------------------------
                const h3 = document.createElement('h3');
                h3.className = 'bid-title';
                if (link) {
                    const a = document.createElement('a');
                    a.href = link;
                    a.target = '_blank';
                    a.rel = 'noreferrer noopener';
                    a.textContent = title;
                    h3.appendChild(a);
                } else {
                    h3.textContent = title;
                }
                inner.appendChild(h3);

                // ---------------- 3Ï§ÑÁõÆ: Î∞úÏ£ºÏ≤ò / ÏàòÏöîÍ∏∞Í¥Ä -------------------------------
                const subLine = document.createElement('div');
                subLine.className = 'bid-subline';

                if (client) {
                    const spanClient = document.createElement('span');
                    spanClient.textContent = client;
                    subLine.appendChild(spanClient);
                }
                if (bizType) {
                    const spanType = document.createElement('span');
                    spanType.textContent = bizType;
                    subLine.appendChild(spanType);
                }
                inner.appendChild(subLine);

                // ---------------- ÏóëÏÖÄ ÌëúÏ§Ä(ÏòÅÏóÖ) ÌïµÏã¨ Ï†ïÎ≥¥(ÏûàÏúºÎ©¥ ÌëúÏãú) ----------------
                (function() {
                    const pick = (...vals) => {
                        for (const v of vals) {
                            if (v === undefined || v === null) continue;
                            const s = String(v).trim();
                            if (s) return s;
                        }
                        return '';
                    };

                    const designer = pick(item.designer, item.designFirm, item.architect, item.architectFirm, item.designCompany);
                    const clientContact = pick(item.clientContact, item.ownerContact, item.contact, item.contactPerson, item.clientManager, item.clientOfficer);
                    const awardDate = pick(item.awardDate, item.winDate, item.winnerDate, item.bidAwardDate, item.contractDate);
                    const siteArea = pick(item.siteAreaSqm, item.siteAreaM2, item.siteArea, item.landAreaSqm, item.landAreaM2);
                    const capacity = pick(item.capacityTon, item.recommendedCapacityTon, item.estimatedTon, item.estimateTon, item.ton);
                    const ordinanceRef = pick(item.ordinanceRef, item.ordinanceArticleRef, item.ordinanceClauseRef, item.ordinanceClause, item.ordinanceBasis);
                    const targetClass = pick(item.targetClass, item.target, item.applyTarget);

                    const pills = [];
                    const addPill = (label, value) => {
                        if (!value) return;
                        const sp = document.createElement('span');
                        sp.className = 'kv-pill';
                        const l = document.createElement('span');
                        l.textContent = label;
                        const v = document.createElement('strong');
                        v.textContent = value;
                        sp.appendChild(l);
                        sp.appendChild(v);
                        pills.push(sp);
                    };

                    addPill('ÏÑ§Í≥ÑÏÇ¨', designer);
                    addPill('Îã¥Îãπ', clientContact);
                    addPill('ÎÇôÏ∞∞Ïùº', awardDate);
                    addPill('ÎåÄÏßÄ„é°', siteArea ? siteArea.replace(/[^0-9.]/g, '') : '');
                    addPill('Ïö©Îüât', capacity ? capacity.replace(/[^0-9.]/g, '') : '');
                    // Ï°∞Î°Ä/Ï†ÅÏö©ÎåÄÏÉÅÏùÄ Í∏∏ Ïàò ÏûàÏñ¥ ÌÉúÍ∑∏Î°úÎßå Í∞ÑÎã® ÌëúÏãú
                    if (ordinanceRef) addPill('Ï°∞Î°Ä', ordinanceRef.length > 16 ? ordinanceRef.slice(0, 16) + '‚Ä¶' : ordinanceRef);
                    if (targetClass) addPill('Ï†ÅÏö©', targetClass);

                    if (pills.length) {
                        const line = document.createElement('div');
                        line.className = 'bid-excel-line';
                        pills.forEach(p => line.appendChild(p));
                        inner.appendChild(line);
                    }
                })();

                // ---------------- 4Ï§ÑÁõÆ: ÎÇôÏ∞∞Ïûê Ï†ïÎ≥¥ (ÎÇôÏ∞∞Ïûê ÌÉÄÍπÉ / ÌûàÏä§ÌÜ†Î¶¨ÏóêÏÑú Í∞ïÏ°∞) ------
                if (winnerName) {
                    const winBlock = document.createElement('div');
                    winBlock.className = 'winner-block';

                    const winName = document.createElement('div');
                    winName.className = 'winner-name';
                    winName.textContent = `ÎÇôÏ∞∞Ïûê: ${winnerName}`;
                    winBlock.appendChild(winName);

                    const metaPieces = [];
                    if (winnerType) metaPieces.push(winnerType);
                    if (winnerContact) metaPieces.push(winnerContact);

                    if (metaPieces.length) {
                        const winMeta = document.createElement('div');
                        winMeta.className = 'winner-meta';
                        winMeta.textContent = metaPieces.join(' ¬∑ ');
                        winBlock.appendChild(winMeta);
                    }

                    inner.appendChild(winBlock);
                }

                // ---------------- Ïò§Î•∏Ï™Ω Î©îÌÉÄ Í∑∏Î¶¨Îìú (Ïñ∏Ï†ú / Í∏àÏï° / Ï∂úÏ≤ò Îì±) ---------------
                const metaGrid = document.createElement('div');
                metaGrid.className = 'bid-meta-grid';

                const metaItems = [];

                if (currentView === 'target') {
                    // ÎÇôÏ∞∞Ïûê ÌÉÄÍπÉ Ïπ¥Îìú: ÎßàÍ∞ê/Í≥ÑÏïΩ + Í∏àÏï° + ÏÇ¨ÏóÖÎπÑ
                    metaItems.push({
                        label: 'ÎßàÍ∞ê/Í≥ÑÏïΩÏùº',
                        value: deadline || regDate
                    });
                    metaItems.push({
                        label: 'Ïö©Ïó≠(Í≥ÑÏïΩ) Í∏àÏï°',
                        value: amount
                    });
                    metaItems.push({
                        label: 'Ï¥ù ÏÇ¨ÏóÖÎπÑ',
                        value: budget
                    });
                } else {
                    // ÏßÅÏ†ëÏûÖÏ∞∞ / Ï†ÑÏ≤¥ Î∑∞: Í≥µÍ≥†Ïùº / ÎßàÍ∞ê / Í∞úÏ∞∞ ÏòàÏ†ï / Ï∂îÏ†ï Í∏àÏï°
                    metaItems.push({ label: 'Í≥µÍ≥†Ïùº', value: regDate });
                    metaItems.push({ label: 'ÏûÖÏ∞∞ ÎßàÍ∞ê', value: deadline });
                    metaItems.push({ label: 'Í∞úÏ∞∞ ÏòàÏ†ï', value: openDate });
                    metaItems.push({ label: 'Ï∂îÏ†ï(Í≥ÑÏïΩ) Í∏àÏï°', value: amount });
                }

                metaItems.push({
                    label: 'Ï∂úÏ≤ò',
                    value:
                        sourceChannel === 'API'
                            ? 'ÎÇòÎùºÏû•ÌÑ∞'
                            : (sourceChannel === 'EAIS'
                                ? 'EAIS'
                                : (sourceChannel === 'SMART' ? 'Ïä§ÎßàÌä∏ Îì±Î°ù' : 'Ïô∏Î∂ÄÏÇ¨Ïù¥Ìä∏'))
                });

                metaItems.push({
                    label: 'Îì±Î°ùÏûê',
                    value: createdBy || '-'
                });

                metaItems.push({
                    label: 'ÏàúÎ≤à',
                    value: (index + 1).toString()
                });

                metaItems.forEach(m => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'bid-meta-item';

                    const lab = document.createElement('div');
                    lab.className = 'meta-label';
                    lab.textContent = m.label;

                    const val = document.createElement('div');
                    val.className = 'meta-value';
                    val.textContent = m.value || '';

                    itemDiv.appendChild(lab);
                    itemDiv.appendChild(val);
                    metaGrid.appendChild(itemDiv);
                });

                inner.appendChild(metaGrid);

                // ---------------- AI ÏöîÏïΩ Î∞ïÏä§ -----------------------------------------
                if (aiSummary || aiDetail) {
                    const aiBox = document.createElement('div');
                    aiBox.className = 'ai-result-box';

                    const icon = document.createElement('div');
                    icon.className = 'ai-result-icon';
                    icon.textContent = 'ü§ñ';
                    aiBox.appendChild(icon);

                    const textWrap = document.createElement('div');
                    textWrap.className = 'ai-result-text';

                    if (aiSummary) {
                        const strong = document.createElement('strong');
                        strong.textContent = aiSummary;
                        textWrap.appendChild(strong);
                    }
                    if (aiDetail) {
                        if (aiSummary) textWrap.appendChild(document.createElement('br'));
                        const span = document.createElement('span');
                        span.textContent = aiDetail;
                        textWrap.appendChild(span);
                    }

                    aiBox.appendChild(textWrap);
                    inner.appendChild(aiBox);
                }

                // ---------------- footer: ÏõêÎ¨∏ / 2Ï∞® Î∂ÑÏÑù / Ï∫òÎ¶∞Îçî / ÏÇ≠Ï†ú ----------------
                const footer = document.createElement('div');
                footer.className = 'bid-footer-row';

                const leftFoot = document.createElement('div');
                leftFoot.textContent = link
                    ? 'ÏõêÎ¨∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏó¨ ÏÑ∏Î∂ÄÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.'
                    : 'ÏõêÎ¨∏ URL Ï†ïÎ≥¥ ÏóÜÏùå';

                const btnBox = document.createElement('div');
                btnBox.className = 'bid-buttons';

                // 2Ï∞® ÏÉÅÏÑ∏Î∂ÑÏÑù Î≤ÑÌäº
                const btnDeep = document.createElement('button');
                btnDeep.type = 'button';
                btnDeep.className = 'btn btn-ghost btn-small';
                btnDeep.textContent = '2Ï∞® ÏÉÅÏÑ∏Î∂ÑÏÑù';
                btnDeep.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openDeepModal(item);
                });
                btnBox.appendChild(btnDeep);

                // ÎåÄÏ±ÖÎ¨∏ÏÑú(ÏûàÏùÑ ÎïåÎßå)
                const reportUrl = item.mitigationDocUrl || item.mitigationUrl || item.mitigationReportUrl || item.reportUrl || item.docUrl || '';
                if (reportUrl) {
                    const btnReport = document.createElement('button');
                    btnReport.type = 'button';
                    btnReport.className = 'btn btn-ghost btn-small';
                    btnReport.textContent = 'ÎåÄÏ±ÖÎ¨∏ÏÑú';
                    btnReport.addEventListener('click', (e) => {
                        e.stopPropagation();
                        window.open(reportUrl, '_blank', 'noopener,noreferrer');
                    });
                    btnBox.appendChild(btnReport);
                }

                // ÎÇ¥ Ï∫òÎ¶∞Îçî
                const btnMyCal = document.createElement('button');
                btnMyCal.type = 'button';
                btnMyCal.className = 'btn btn-ghost btn-small login-only';
                btnMyCal.textContent = 'ÎÇ¥ Ï∫òÎ¶∞Îçî';
                btnMyCal.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    await createCalendarEventForBid(item);
                });
                btnBox.appendChild(btnMyCal);

                // ÌöåÏÇ¨ Ï∫òÎ¶∞Îçî
                const btnCorpCal = document.createElement('button');
                btnCorpCal.type = 'button';
                btnCorpCal.className = 'btn btn-ghost btn-small login-only';
                btnCorpCal.textContent = 'ÌöåÏÇ¨ Ï∫òÎ¶∞Îçî';
                btnCorpCal.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    await createCorporateCalendarEventForBid(item);
                });
                btnBox.appendChild(btnCorpCal);

                // ÏÇ≠Ï†ú (Ïä§ÎßàÌä∏Îì±Î°ù Îì± rowIndex Í∞Ä ÏûàÏùÑ ÎïåÎßå)
                if (item.rowIndex) {
                    const btnDel = document.createElement('button');
                    btnDel.type = 'button';
                    btnDel.className = 'btn btn-danger btn-small login-only';
                    btnDel.textContent = 'ÏÇ≠Ï†ú';
                    btnDel.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        await deleteBid(item);
                    });
                    btnBox.appendChild(btnDel);
                }

                // ÏõêÎ¨∏ Ïó¥Í∏∞
                if (link) {
                    const btnView = document.createElement('a');
                    btnView.href = link;
                    btnView.target = '_blank';
                    btnView.rel = 'noreferrer noopener';
                    btnView.className = 'btn btn-ghost btn-small btn-link';
                    btnView.textContent = 'ÏõêÎ¨∏ Ïó¥Í∏∞';
                    btnBox.appendChild(btnView);
                }

                footer.appendChild(leftFoot);
                footer.appendChild(btnBox);

                inner.appendChild(footer);

                card.appendChild(inner);
                list.appendChild(card);
            });

            // ÏÉàÎ°ú Î†åÎçîÎßÅÎêú Î≤ÑÌäºÎì§Ïóê Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Î∞òÏòÅ
            updateLoginUI(!!accessToken);
        }

        // ---------------- Ïä§ÎßàÌä∏ Îì±Î°ù Î™®Îã¨ ----------------

        function openSmartModal() {
            document.getElementById('smartModalBackdrop').classList.add('active');
        }

        function closeSmartModal() {
            document.getElementById('smartModalBackdrop').classList.remove('active');
        }

        async function handleSmartSubmit(e) {
            e.preventDefault();
            const text = document.getElementById('smartText').value.trim();
            const urlRaw = document.getElementById('smartUrl').value.trim();

            if (!text && !urlRaw) {
                alert('Î≥∏Î¨∏ ÌÖçÏä§Ìä∏ ÎòêÎäî URL Ï§ë ÌïòÎÇòÎäî ÏûÖÎ†•Ìï¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }

            // üîí Ïä§ÎßàÌä∏ Îì±Î°ùÏùÄ Î°úÍ∑∏Ïù∏ ÌïÑÏàò
            if (!accessToken || !loginUserEmail) {
                alert('Ïä§ÎßàÌä∏ Îì±Î°ùÏùÄ Google Î°úÍ∑∏Ïù∏ ÌõÑÏóêÎßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            if (submitBtn) submitBtn.classList.add('loading');

            try {
                setGlobalLoading(true, 'AIÍ∞Ä ÌÖçÏä§Ìä∏Î•º Î∂ÑÏÑùÌïòÏó¨ Ìïú ÌñâÏúºÎ°ú Ï†ïÎ¶¨ Ï§ëÏûÖÎãàÎã§...');

                const form = new URLSearchParams();
                form.set('action', 'smart_add');
                form.set('text', text);
                form.set('fileUrl', urlRaw);
                form.set('userEmail', loginUserEmail);   // ‚òÖ Îì±Î°ùÏûê Ïù¥Î©îÏùº Ï†ÑÏÜ°

                const res = await fetch(API_BASE, {
                    method: 'POST',
                    body: form
                });

                if (!res.ok) {
                    const errText = await res.text();
                    console.error('smart_add HTTP error:', res.status, errText);
                    alert('Îì±Î°ù Ï§ë HTTP Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + res.status);
                    return;
                }

                const json = await res.json();
                console.log('smart_add response:', json);

                if (json && json.result === 'success') {
                    alert('Ïä§ÎßàÌä∏ Îì±Î°ùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
                    closeSmartModal();
                    document.getElementById('smartForm').reset();
                    await loadData();
                } else {
                    console.error('smart_add ÏùëÎãµ:', json);
                    alert('Îì±Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. (ÏÉÅÏÑ∏Îäî ÏΩòÏÜî Ï∞∏Ï°∞)');
                }
            } catch (err) {
                console.error(err);
                alert('ÌÜµÏã† Ïò§Î•ò: ' + err.message);
            } finally {
                if (submitBtn) submitBtn.classList.remove('loading');
                setGlobalLoading(false);
            }
        }


        // ---------------- 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ ----------------

        async function openDeepModal(item) {
            const backdrop = document.getElementById('deepModalBackdrop');
            if (!backdrop) return;

            // Î™®Îã¨ Ïó¥Í∏∞
            backdrop.classList.add('active');

            // Í∏∞Î≥∏ Ï†ïÎ≥¥ Ï§ÄÎπÑ
            const title = normalizeTitle(item) || '(Ï†úÎ™© ÏóÜÏùå)';
            const link = normalizeLink(item);
            const client = item.client || '';
            const agency = item.agency || '';
            const region = item.region || '';
            const deadline = item.deadline || '';
            const firstSummary = item.aiResult || item.aiSummary || '';

            // Î™®Îã¨ ÏöîÏÜå Ï∫êÏãú
            const elTitle = document.getElementById('deepTitle');
            const elBadges = document.getElementById('deepBadges');
            const elMeta = document.getElementById('deepMetaLine');
            const elSummary = document.getElementById('deepSummary');
            const elPeriod = document.getElementById('deepPeriod');
            const elAmount = document.getElementById('deepAmount');
            const elBudget = document.getElementById('deepBudget');
            const elCheckpoints = document.getElementById('deepCheckpoints');
            const elAttachEmpty = document.getElementById('deepAttachmentsEmpty');
            const elAttachList = document.getElementById('deepAttachmentsList');
            const elAttachNote = document.getElementById('deepAttachmentsNote');
            const elSuggestion = document.getElementById('deepSuggestion');
            const elFooterInfo = document.getElementById('deepFooterInfo');
            const elRisk = document.getElementById('deepRisk');

            const elAreaNum = document.getElementById('deepAreaNum');
            const elTargetClass = document.getElementById('deepTargetClass');
            const elOrdinance = document.getElementById('deepOrdinanceBasis');
            const elOrdinanceClauses = document.getElementById('deepOrdinanceClauses');
            const elCapacity = document.getElementById('deepCapacitySummary');
            const elCalcBody = document.getElementById('deepCalcTableBody');
            const elMitigation = document.getElementById('deepMitigationLink');
            const btnMitigation = document.getElementById('btnMitigationReport');

            // ÏÉòÌîå ÏóëÏÖÄ ÌëúÏ§Ä ÌïÑÎìú ÌëúÏãú
            const elStdRegion = document.getElementById('deepStdRegion');
            const elStdClient = document.getElementById('deepStdClient');
            const elStdProject = document.getElementById('deepStdProject');
            const elStdDecision = document.getElementById('deepStdDecision');
            const elStdSales = document.getElementById('deepStdSales');
            const elStdDesigner = document.getElementById('deepStdDesigner');
            const elStdContact = document.getElementById('deepStdContact');
            const elStdAward = document.getElementById('deepStdAward');
            const elStdPeriod = document.getElementById('deepStdPeriod');
            const elStdEnd = document.getElementById('deepStdEnd');
            const elStdAmount = document.getElementById('deepStdAmount');
            const elStdBudget = document.getElementById('deepStdBudget');
            const elStdArea = document.getElementById('deepStdArea');
            const elStdCapacity = document.getElementById('deepStdCapacity');
            const elStdMemo = document.getElementById('deepStdMemo');


            // Ï†úÎ™©/Î©îÌÉÄ Í∏∞Î≥∏ ÏÑ∏ÌåÖ
            if (elTitle) elTitle.textContent = title;
            if (elBadges) elBadges.innerHTML = '';

            const metaBits = [];
            if (client || agency) metaBits.push(client || agency);
            if (region) metaBits.push(region);
            if (deadline) metaBits.push(deadline);
            if (elMeta) elMeta.textContent = metaBits.join(' ¬∑ ');

            // Í∏∞Ï°¥ ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî
            if (elSummary) {
                elSummary.textContent =
                    firstSummary ||
                    '1Ï∞® ÏöîÏïΩ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§. AI 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Í≤∞Í≥ºÎ•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§.';
            }
            if (elPeriod) elPeriod.textContent = '-';
            if (elAmount) elAmount.textContent = '-';
            if (elBudget) elBudget.textContent = '-';
            if (elCheckpoints) elCheckpoints.innerHTML = '';
            if (elAttachList) elAttachList.innerHTML = '';
            if (elSuggestion) elSuggestion.textContent = '';
            if (elFooterInfo) elFooterInfo.textContent = '';
            if (elRisk) elRisk.textContent = '';

            if (elAreaNum) elAreaNum.textContent = '-';
            if (elTargetClass) elTargetClass.textContent = '-';
            if (elOrdinance) elOrdinance.textContent = '';
            if (elCapacity) elCapacity.textContent = '';
            if (elCalcBody) elCalcBody.innerHTML = '';
            if (elMitigation) elMitigation.textContent = '-';


            deepCurrentItem = item;
            const pick1 = (...vals) => {
                for (const v of vals) {
                    if (v === undefined || v === null) continue;
                    const s = String(v).trim();
                    if (s) return s;
                }
                return '';
            };


            const btnStdSave = document.getElementById('btnStdSave');
            const btnStdReset = document.getElementById('btnStdReset');

            const snapshotStdFromItem = (it) => ({
                region: pick1(it.region, it.area) || '',
                client: pick1(it.client, it.agency) || '',
                projectName: pick1(it.projectName, normalizeTitle(it)) || '',
                methodDecisionDate: pick1(it.methodDecisionDate) || '',
                salesStatus: pick1(it.salesStatus) || '',
                designer: pick1(it.designer) || '',
                clientContact: pick1(it.clientContact, it.clientManager) || '',
                awardDate: pick1(it.awardDate) || '',
                servicePeriod: pick1(it.servicePeriod) || '',
                endDate: pick1(it.endDate) || '',
                serviceAmountEok: pick1(it.serviceAmountEok) || '',
                projectBudgetEok: pick1(it.projectBudgetEok) || '',
                siteArea: pick1(it.siteArea) || '',
                capacityTon: pick1(it.capacityTon, it.expectedTon) || '',
                memo: pick1(it.memo) || ''
            });

            const fillStdInputs = (vals) => {
                if (elStdRegion) elStdRegion.value = vals.region || '';
                if (elStdClient) elStdClient.value = vals.client || '';
                if (elStdProject) elStdProject.value = vals.projectName || '';
                if (elStdDecision) elStdDecision.value = vals.methodDecisionDate || '';
                if (elStdSales) elStdSales.value = vals.salesStatus || '';
                if (elStdDesigner) elStdDesigner.value = vals.designer || '';
                if (elStdContact) elStdContact.value = vals.clientContact || '';
                if (elStdAward) elStdAward.value = vals.awardDate || '';
                if (elStdPeriod) elStdPeriod.value = vals.servicePeriod || '';
                if (elStdEnd) elStdEnd.value = vals.endDate || '';
                if (elStdAmount) elStdAmount.value = vals.serviceAmountEok || '';
                if (elStdBudget) elStdBudget.value = vals.projectBudgetEok || '';
                if (elStdArea) elStdArea.value = vals.siteArea || '';
                if (elStdCapacity) elStdCapacity.value = vals.capacityTon || '';
                if (elStdMemo) elStdMemo.value = vals.memo || '';
            };

            const collectStdInputs = () => ({
                region: elStdRegion ? (elStdRegion.value || '').trim() : '',
                client: elStdClient ? (elStdClient.value || '').trim() : '',
                projectName: elStdProject ? (elStdProject.value || '').trim() : '',
                methodDecisionDate: elStdDecision ? (elStdDecision.value || '').trim() : '',
                salesStatus: elStdSales ? (elStdSales.value || '').trim() : '',
                designer: elStdDesigner ? (elStdDesigner.value || '').trim() : '',
                clientContact: elStdContact ? (elStdContact.value || '').trim() : '',
                awardDate: elStdAward ? (elStdAward.value || '').trim() : '',
                servicePeriod: elStdPeriod ? (elStdPeriod.value || '').trim() : '',
                endDate: elStdEnd ? (elStdEnd.value || '').trim() : '',
                serviceAmountEok: elStdAmount ? (elStdAmount.value || '').trim() : '',
                projectBudgetEok: elStdBudget ? (elStdBudget.value || '').trim() : '',
                siteArea: elStdArea ? (elStdArea.value || '').trim() : '',
                capacityTon: elStdCapacity ? (elStdCapacity.value || '').trim() : '',
                memo: elStdMemo ? (elStdMemo.value || '').trim() : ''
            });

            // Í∏∞Î≥∏Í∞í(Î¶¨Ïä§Ìä∏ Í∏∞Î∞ò)ÏúºÎ°ú ÌïúÎ≤à Ï±ÑÏõÄ
            fillStdInputs(snapshotStdFromItem(item));

            if (btnStdReset) {
                btnStdReset.onclick = () => {
                    if (!deepCurrentItem) return;
                    fillStdInputs(snapshotStdFromItem(deepCurrentItem));
                    alert('ÌëúÏ§Ä Ï†ïÎ≥¥ ÏûÖÎ†•Í∞íÏùÑ Ï¥àÍ∏∞ÌôîÌñàÏäµÎãàÎã§.');
                };
            }

            if (btnStdSave) {
                btnStdSave.onclick = async () => {
                    if (!deepCurrentItem) return;
                    const payload = {
                        no: deepCurrentItem.no || '',
                        rowIndex: deepCurrentItem.rowIndex || '',
                        fields: collectStdInputs()
                    };
                    try {
                        btnStdSave.classList.add('loading');
                        let j;
                        try {
                          j = await apiPostJson('update_bid_fields', payload, true, 'Ï†ÄÏû•');
                        } catch (e) {
                          const msg = String((e && e.message) ? e.message : e);
                          if (msg.includes('Failed to fetch')) {
                            // POST(CORS) Ïã§Ìå® Ïãú GETÏúºÎ°ú ÏûêÎèô Ïû¨ÏãúÎèÑ
                            j = await apiGet('update_bid_fields', { no: payload.no || '', rowIndex: payload.rowIndex || '', fields: JSON.stringify(payload.fields || {}) }, true, 'Ï†ÄÏû•');
                          } else {
                            throw e;
                          }
                        }
                        if (!j || j.ok === false) {
                            const msg = (j && (j.error || j.message)) ? (j.error || j.message) : 'ÏÑúÎ≤Ñ Ïò§Î•ò';
                            alert('Ï†ÄÏû• Ïã§Ìå®: ' + msg);
                            return;
                        }
                        const u = j.updated || {};
                        // ÌòÑÏû¨ item + Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Ïóê Î∞òÏòÅ
                        Object.assign(deepCurrentItem, {
                            region: u.region || deepCurrentItem.region,
                            client: u.client || deepCurrentItem.client,
                            projectName: u.projectName || deepCurrentItem.projectName,
                            methodDecisionDate: u.methodDecisionDate || deepCurrentItem.methodDecisionDate,
                            salesStatus: u.salesStatus || deepCurrentItem.salesStatus,
                            designer: u.designer || deepCurrentItem.designer,
                            clientContact: u.clientContact || deepCurrentItem.clientContact,
                            awardDate: u.awardDate || deepCurrentItem.awardDate,
                            servicePeriod: u.servicePeriod || deepCurrentItem.servicePeriod,
                            endDate: u.endDate || deepCurrentItem.endDate,
                            serviceAmountEok: u.serviceAmountEok || deepCurrentItem.serviceAmountEok,
                            projectBudgetEok: u.projectBudgetEok || deepCurrentItem.projectBudgetEok,
                            siteArea: u.siteArea || deepCurrentItem.siteArea,
                            capacityTon: u.capacityTon || deepCurrentItem.capacityTon,
                            memo: u.memo || deepCurrentItem.memo
                        });
                        applyFilter();
                        alert('Ï†ÄÏû• ÏôÑÎ£å (ÏûÖÏ∞∞DB Î∞òÏòÅ)');
                    } catch (e) {
                        console.error(e);
                        alert('Ï†ÄÏû• Ï§ë Ïò§Î•ò: ' + e.message);
                    } finally {
                        btnStdSave.classList.remove('loading');
                    }
                };
            }
            const pick0 = (...vals) => {
                for (const v of vals) {
                    if (v === undefined || v === null) continue;
                    const s = String(v).trim();
                    if (s) return s;
                }
                return '';
            };

            // 2Ï∞® Î∂ÑÏÑù Ï†ÑÏóêÎèÑ Î≥¥Ïù¥Îäî Í∏∞Î≥∏Í∞í ÏÑ∏ÌåÖ(ÏûàÏúºÎ©¥)
            if (elStdRegion) elStdRegion.value = pick0(region, item.region, item.area) || '';
            if (elStdClient) elStdClient.value = pick0(client, agency, item.client, item.agency) || '';
            if (elStdProject) elStdProject.value = pick0(title, item.projectName, item.bizName) || '';
            if (elStdDecision) elStdDecision.value = pick0(item.methodDecisionDate, item.decisionDate, item.procDecisionDate) || '';
            if (elStdSales) elStdSales.value = pick0(item.salesStatus, item.salesMemo, item.salesNote) || '';
            if (elStdDesigner) elStdDesigner.value = pick0(item.designer, item.designFirm, item.architect, item.architectFirm) || '';
            if (elStdContact) elStdContact.value = pick0(item.clientContact, item.contactPerson, item.ownerContact, item.clientManager) || '';
            if (elStdAward) elStdAward.value = pick0(item.awardDate, item.winDate, item.contractDate) || '';
            if (elStdPeriod) elStdPeriod.value = pick0(item.servicePeriod, item.period) || '';
            if (elStdEnd) elStdEnd.value = pick0(item.endDate, item.finishDate) || '';
            if (elStdAmount) elStdAmount.value = pick0(item.serviceAmount, item.amount) || '';
            if (elStdBudget) elStdBudget.value = pick0(item.projectBudget, item.budget) || '';
            if (elStdArea) elStdArea.value = pick0(item.siteAreaSqm, item.siteAreaM2, item.siteArea) || '';
            if (elStdCapacity) elStdCapacity.value = pick0(item.capacityTon, item.estimatedTon, item.ton) || '';
            if (elStdMemo) elStdMemo.value = pick0(item.memo, item.note, item.remark) || '';

            const canMakeReport = !!(item && (item.rowIndex || item.no));
            if (btnMitigation) {
                btnMitigation.disabled = !canMakeReport;
                btnMitigation.classList.remove('loading');
                btnMitigation.classList.add('btn-primary');
                btnMitigation.classList.remove('btn-ghost');
                btnMitigation.innerHTML = '<span class="icon">üìù</span> ÎåÄÏ±ÖÎ¨∏ÏÑú ÏÉùÏÑ±';
            }


            if (elAttachEmpty) elAttachEmpty.style.display = 'block';
            if (elAttachNote) elAttachNote.style.display = 'none';

            // Î°úÎî© Î±ÉÏßÄ ÌëúÏãú
            if (elBadges) {
                const loadingBadge = document.createElement('span');
                loadingBadge.className = 'deep-badge';
                loadingBadge.textContent = 'Ïã¨Ìôî Î∂ÑÏÑù Ï§ë...';
                elBadges.appendChild(loadingBadge);
            }

            // ÏÑúÎ≤ÑÏóê 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù ÏöîÏ≤≠
            try {
                setGlobalLoading(true, 'Ìï¥Îãπ Í≥µÍ≥†Ïùò 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑùÏùÑ ÏßÑÌñâ Ï§ëÏûÖÎãàÎã§...');

                const data = await apiGet('deepAnalyze', {
                    rowIndex: item.rowIndex || '',
                    no: item.no || '',
                    link: link || '',
                    title: title || '',
                    client: client || '',
                    agency: agency || '',
                    region: region || ''
                }, true, '2Ï∞® Ïã¨ÌôîÎ∂ÑÏÑù');
                if (data && data.ok === false) {
                    const msg = data.error || data.message || 'ÏÑúÎ≤Ñ Ïò§Î•ò';
                    if (elRisk) elRisk.textContent = '2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Ïã§Ìå®: ' + msg;
                    if (elBadges) elBadges.textContent = 'Ïã¨Ìôî Î∂ÑÏÑù Ïã§Ìå®';
                    alert('2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Ïã§Ìå®: ' + msg);
                    return;
                }

                const deep = data.deep || data.aiReport || data.report || {};
                // JSON ÌååÏã±Ïù¥ Ïã§Ìå®Ìï¥ rawTextÎ°ú ÎÇ¥Î†§Ïò§Îäî Í≤ΩÏö∞ÏóêÎèÑ ÌôîÎ©¥Ïóê ÌëúÏãú
                if (deep && deep.rawText && !deep.summary2) deep.summary2 = deep.rawText;
                if (deep && deep._parseError) console.warn('AI JSON parse warning:', deep._parseError);

                const aiReport = deep;
                const attachments = data.attachments || deep.attachments || [];

                // (ÌëúÏ§Ä ÏûÖÎ†•) 2Ï∞® Î∂ÑÏÑù Í≤∞Í≥ºÎ°ú ÎπàÏπ∏Îßå Î≥¥Ï†ï
                const fillIfEmpty = (el, v) => {
                    if (!el) return;
                    const cur = (el.value || '').trim();
                    if (cur) return;
                    const nv = (v == null) ? '' : String(v).trim();
                    if (nv) el.value = nv;
                };

                try {
                    fillIfEmpty(elStdDecision, deep.methodDecisionDate || deep.decisionDate || '');
                    fillIfEmpty(elStdSales, deep.salesStatus || '');
                    fillIfEmpty(elStdDesigner, deep.designer || deep.designFirm || '');
                    fillIfEmpty(elStdAward, deep.awardDate || deep.winDate || '');
                    fillIfEmpty(elStdEnd, deep.endDate || '');
                    // Í∏àÏï°/Î©¥Ï†Å/Ïö©ÎüâÏùÄ Ï∂îÏ†ïÏπòÍ∞Ä ÏûàÏùÑ ÎïåÎßå
                    fillIfEmpty(elStdArea, deep.siteAreaSqm || deep.siteAreaM2 || deep.siteArea || '');
                    fillIfEmpty(elStdCapacity, deep.capacityTon || deep.recommendedCapacityTon || deep.estimatedTon || '');
                } catch(e) {}


                // --- Ï°∞Î°Ä/Ïö©Îüâ/ÎåÄÏ±ÖÎ¨∏ÏÑú Ï†ïÎ≥¥ ÌëúÏãú(ÌôïÏû•) ---
                const pick = (...vals) => vals.find(v => v !== undefined && v !== null && String(v).trim() !== '');
                const formatTargetClass = (tc) => {
                    const v = String(tc || '').toLowerCase();
                    if (v === 'direct') return 'ÏßÅÏ†ë ÎåÄÏÉÅ(<=ÏÜåÍ∑úÎ™®)';
                    if (v === 'review') return 'ÌôïÎåÄ Í≤ÄÌÜ†(<=ÌôïÎåÄÍ∏∞Ï§Ä)';
                    if (v === 'large') return 'ÎåÄÌòï(>ÌôïÎåÄÍ∏∞Ï§Ä)';
                    if (v) return tc;
                    return '-';
                };

                const areaNum = pick(deep.siteAreaSqm, deep.siteAreaM2, deep.siteArea, data.siteAreaSqm, data.siteAreaM2);
                const targetClass = pick(deep.targetClass, deep.target, data.targetClass);

                const ordinanceBasis = pick(deep.ordinanceBasis,
                    (data.ordinanceInfo && (data.ordinanceInfo.basisSummary || data.ordinanceInfo.ordinanceBasis)),
                    data.ordinanceBasis);

                let ordinanceClausesText = '';
                try {
                    ordinanceClausesText = pick(
                        deep.ordinanceArticlesText,
                        (deep.ordinanceArticles && Array.isArray(deep.ordinanceArticles) ? deep.ordinanceArticles.join('\n') : ''),
                        (data.ordinanceInfo && (data.ordinanceInfo.articlesText || (Array.isArray(data.ordinanceInfo.articles) ? data.ordinanceInfo.articles.join('\n') : data.ordinanceInfo.articles) || '')),
                        ''
                    );
                    if (Array.isArray(ordinanceClausesText)) ordinanceClausesText = ordinanceClausesText.join('\n');
                } catch (e) { }

                const capTon = pick(deep.capacityTon, deep.recommendedCapacityTon, deep.estimatedTon, deep.estimateTon, deep.ton);
                const capSummary = pick(deep.capacityCalcSummary, deep.capacitySummary, deep.capacityRationale, deep.capacityCalc);

                if (elAreaNum) elAreaNum.textContent = areaNum ? String(areaNum).replace(/[^\d.]/g, '') : '-';
                if (elTargetClass) elTargetClass.textContent = formatTargetClass(targetClass);
                if (elOrdinance) elOrdinance.textContent = ordinanceBasis ? String(ordinanceBasis) : 'ÌôïÏù∏ÌïÑÏöî';
                if (elOrdinanceClauses) elOrdinanceClauses.textContent = ordinanceClausesText ? String(ordinanceClausesText) : '';
                if (elCapacity) {
                    if (capTon || capSummary) {
                        elCapacity.textContent =
                            (capTon ? ('Í∂åÏû•/ÏòàÏÉÅ Ïö©Îüâ: ' + String(capTon).toString().replace(/[^\d.]/g, '') + 'ÌÜ§\n') : '') +
                            (capSummary ? String(capSummary) : '');
                    } else {
                        elCapacity.textContent = 'ÌôïÏù∏ÌïÑÏöî';
                    }
                }
                // ‚úÖ ÏÇ∞Ï†ï Í≤∞Í≥º Ìëú(Î™®Îã¨) Î†åÎçîÎßÅ
                if (elCalcBody) {
                    elCalcBody.innerHTML = '';
                    const rows = [];
                    if (areaNum) rows.push(['Î©¥Ï†Å(„é°)', String(areaNum).replace(/[^\d.]/g, '')]);
                    rows.push(['Ï†ÅÏö©ÎåÄÏÉÅ', formatTargetClass(targetClass)]);
                    if (ordinanceBasis) rows.push(['Ï°∞Î°Ä Í∑ºÍ±∞', String(ordinanceBasis)]);
                    if (capTon) rows.push(['Í∂åÏû•/ÏòàÏÉÅ Ïö©Îüâ(ÌÜ§)', String(capTon).toString().replace(/[^\d.]/g, '')]);
                    if (capSummary) rows.push(['ÏÇ∞Ï†ï ÏöîÏïΩ', String(capSummary)]);

                    rows.forEach(([k, v]) => {
                        const tr = document.createElement('tr');
                        const th = document.createElement('th');
                        const td = document.createElement('td');
                        th.textContent = k;
                        td.textContent = v;
                        th.style.cssText = 'text-align:left;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);width:140px;vertical-align:top;font-weight:600;';
                        td.style.cssText = 'text-align:left;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);white-space:pre-wrap;';
                        tr.appendChild(th);
                        tr.appendChild(td);
                        elCalcBody.appendChild(tr);
                    });
                }



                let reportUrl = pick(deep.mitigationDocUrl, deep.mitigationDocURL, deep.mitigationReportUrl,
                    item.mitigationDocUrl, item.mitigationDocURL, item.mitigationUrl, item.reportUrl, item.docUrl);

                const renderReportLink = () => {
                    if (!elMitigation) return;
                    elMitigation.innerHTML = '';
                    if (reportUrl) {
                        const a = document.createElement('a');
                        a.href = reportUrl;
                        a.target = '_blank';
                        a.rel = 'noreferrer noopener';
                        a.textContent = reportUrl;
                        elMitigation.appendChild(a);
                    } else {
                        elMitigation.textContent = 'ÏïÑÏßÅ ÏÉùÏÑ±ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                    }

                    if (btnMitigation) {
                        if (reportUrl) {
                            btnMitigation.classList.remove('btn-primary');
                            btnMitigation.classList.add('btn-ghost');
                            btnMitigation.innerHTML = '<span class="icon">üîó</span> ÎåÄÏ±ÖÎ¨∏ÏÑú Ïó¥Í∏∞';
                        } else {
                            btnMitigation.classList.add('btn-primary');
                            btnMitigation.classList.remove('btn-ghost');
                            btnMitigation.innerHTML = '<span class="icon">üìù</span> ÎåÄÏ±ÖÎ¨∏ÏÑú ÏÉùÏÑ±';
                        }
                    }
                };

                renderReportLink();

                if (btnMitigation) {
                    btnMitigation.onclick = async () => {
                        const canMakeReport = !!(item && (item.rowIndex || item.no));
                        if (!canMakeReport) return;

                        // Ïù¥ÎØ∏ ÏûàÏúºÎ©¥ Ïó¥Í∏∞
                        if (reportUrl) {
                            window.open(reportUrl, '_blank', 'noopener,noreferrer');
                            return;
                        }

                        btnMitigation.classList.add('loading');
                        try {
                            setGlobalLoading(true, 'Ïö∞ÏàòÏú†Ï∂ú Ï†ÄÍ∞êÎåÄÏ±Ö Î¨∏ÏÑúÎ•º ÏÉùÏÑ± Ï§ëÏûÖÎãàÎã§...');
                            const j2 = await apiGet('generate_mitigation_doc', {
                                rowIndex: item.rowIndex || '',
                                no: item.no || ''
                            }, true, 'ÎåÄÏ±ÖÎ¨∏ÏÑú ÏÉùÏÑ±');
                            if (!j2 || !j2.ok || !j2.docUrl) {
                                console.error('generate_mitigation_doc response:', j2);
                                const msg = (j2 && (j2.error || j2.message)) ? (j2.error || j2.message) : 'ÏÑúÎ≤Ñ ÏùëÎãµ Ïò§Î•ò';
                                alert('ÎåÄÏ±ÖÎ¨∏ÏÑú ÏÉùÏÑ± Ïã§Ìå®: ' + msg);
                                return;
                            }

                            reportUrl = j2.docUrl;
                            // ÌòÑÏû¨ itemÏóêÎèÑ Ï†ÄÏû•Ìï¥ÎëêÎ©¥ Î¶¨Ïä§Ìä∏ÏóêÏÑúÎèÑ ÏÇ¨Ïö© Í∞ÄÎä•
                            item.mitigationDocUrl = reportUrl;
                            renderReportLink();
                            applyFilter(); // Î¶¨Ïä§Ìä∏ Í∞±Ïã†

                            // Ï¶âÏãú Ïó¥Í∏∞
                            window.open(reportUrl, '_blank', 'noopener,noreferrer');
                        } catch (e) {
                            console.error(e);
                            alert('ÎåÄÏ±ÖÎ¨∏ÏÑú ÏÉùÏÑ± Ï§ë Ïò§Î•ò: ' + e.message);
                        } finally {
                            btnMitigation.classList.remove('loading');
                            setGlobalLoading(false);
                        }
                    };
                }


                // Î±ÉÏßÄ ÏòÅÏó≠ Îã§Ïãú Íµ¨ÏÑ±
                if (elBadges) {
                    elBadges.innerHTML = '';

                    // Í¥ÄÎ†®ÏÑ± Îì±Í∏â Î±ÉÏßÄ
                    if (deep.relevance) {
                        const b = document.createElement('span');
                        b.className = 'deep-badge';
                        b.textContent = 'Í¥ÄÎ†®ÏÑ± ' + deep.relevance;
                        elBadges.appendChild(b);
                    }

                    // ÏãúÏÑ§ Ïú†Ìòï Î±ÉÏßÄ
                    if (deep.facilityType) {
                        const b = document.createElement('span');
                        b.className = 'deep-badge';
                        b.textContent = deep.facilityType;
                        elBadges.appendChild(b);
                    }

                    // ÏòàÏÉÅ ÌÜ§Ïàò Î±ÉÏßÄ
                    const estTon = deep.estimatedTon || '';
                    if (estTon) {
                        const b = document.createElement('span');
                        b.className = 'deep-badge';
                        b.textContent = '~' + String(estTon).replace(/[^0-9]/g, '') + 'ÌÜ§ ÏòàÏÉÅ';
                        elBadges.appendChild(b);
                    }

                    // Î¶¨Ïä§ÌÅ¨ Î±ÉÏßÄ
                    if (deep.riskLevel) {
                        const b = document.createElement('span');
                        b.className = 'deep-badge';
                        b.textContent = 'Î¶¨Ïä§ÌÅ¨ ' + deep.riskLevel;
                        elBadges.appendChild(b);
                    }
                }

                // Î¶¨Ïä§ÌÅ¨ ÌÖçÏä§Ìä∏
                if (elRisk) {
                    if (deep.riskLevel) {
                        elRisk.textContent = 'Î¶¨Ïä§ÌÅ¨ ÏàòÏ§Ä: ' + deep.riskLevel;
                    } else {
                        elRisk.textContent = '';
                    }
                }

                // ÏöîÏïΩ ÌÖçÏä§Ìä∏ (1Ï∞® + 2Ï∞® Ìï©Ï≥êÏÑú Î≥¥Ïó¨Ï£ºÍ∏∞)
                if (elSummary) {
                    if (deep.summary2) {
                        if (firstSummary) {
                            elSummary.textContent =
                                firstSummary + '\n\n[2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù]\n' + deep.summary2;
                        } else {
                            elSummary.textContent = deep.summary2;
                        }
                    }
                }

                // Í∏àÏï°/Í∏∞Í∞Ñ/ÏÇ¨ÏóÖÎπÑ
                const periodText =
                    deep.servicePeriod ||
                    data.servicePeriod ||
                    item.servicePeriod ||
                    item.period ||
                    '';
                const amountText =
                    deep.serviceAmount ||
                    data.serviceAmount ||
                    item.serviceAmount ||
                    item.amount ||
                    '';
                const budgetText =
                    deep.projectBudget ||
                    data.projectBudget ||
                    item.projectBudget ||
                    item.budget ||
                    '';

                if (elPeriod) elPeriod.textContent = periodText || '';
                if (elAmount) elAmount.textContent = amountText || '';
                if (elBudget) elBudget.textContent = budgetText || '';

                // ÏÉòÌîå ÏóëÏÖÄ ÌëúÏ§Ä ÌïÑÎìúÎèÑ Í∞ÄÎä•Ìïú Í∞íÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
                const pickStd = (...vals) => {
                    for (const v of vals) {
                        if (v === undefined || v === null) continue;
                        const s = String(v).trim();
                        if (s) return s;
                    }
                    return '';
                };

                if (elStdRegion) elStdRegion.value = pickStd(region, deep.region, data.region, item.region) || (elStdRegion.textContent || '-');
                if (elStdClient) elStdClient.value = pickStd(client, agency, deep.client, deep.agency, data.client, data.agency, item.client, item.agency) || (elStdClient.textContent || '-');
                if (elStdProject) elStdProject.value = pickStd(title, deep.projectName, deep.bizName, data.projectName, data.bizName) || (elStdProject.textContent || '-');
                if (elStdDesigner) elStdDesigner.value = pickStd(deep.designer, deep.designFirm, item.designer, item.designFirm) || (elStdDesigner.textContent || '-');
                if (elStdContact) elStdContact.value = pickStd(deep.clientContact, deep.contactPerson, item.clientContact, item.contactPerson) || (elStdContact.textContent || '-');
                if (elStdAward) elStdAward.value = pickStd(deep.awardDate, deep.winDate, deep.contractDate, item.awardDate, item.winDate) || (elStdAward.textContent || '-');
                if (elStdPeriod) elStdPeriod.value = pickStd(periodText, deep.servicePeriod, data.servicePeriod) || (elStdPeriod.textContent || '-');
                if (elStdEnd) elStdEnd.value = pickStd(deep.endDate, deep.finishDate, item.endDate) || (elStdEnd.textContent || '-');
                if (elStdAmount) elStdAmount.value = pickStd(amountText, deep.serviceAmount, data.serviceAmount) || (elStdAmount.textContent || '-');
                if (elStdBudget) elStdBudget.value = pickStd(budgetText, deep.projectBudget, data.projectBudget) || (elStdBudget.textContent || '-');
                if (elStdArea) elStdArea.value = pickStd(deep.siteAreaSqm, deep.siteAreaM2, deep.siteArea, areaNum, item.siteAreaSqm) || (elStdArea.textContent || '-');
                if (elStdCapacity) elStdCapacity.value = pickStd(deep.capacityTon, deep.recommendedCapacityTon, deep.estimatedTon, capTon) || (elStdCapacity.textContent || '-');
                if (elStdMemo) elStdMemo.value = pickStd(deep.memo, deep.note, deep.remark, item.memo, item.note) || (elStdMemo.textContent || '-');
                if (elStdDecision) elStdDecision.value = pickStd(deep.methodDecisionDate, deep.decisionDate, item.methodDecisionDate) || (elStdDecision.textContent || '-');
                if (elStdSales) elStdSales.value = pickStd(deep.salesStatus, deep.salesMemo, item.salesStatus) || (elStdSales.textContent || '-');

                // Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏
                if (elCheckpoints) {
                    elCheckpoints.innerHTML = '';
                    const cps = deep.checkPoints || deep.checkpoints || [];

                    if (Array.isArray(cps) && cps.length) {
                        cps.forEach(c => {
                            if (!c) return;
                            const li = document.createElement('li');
                            li.textContent = c;
                            elCheckpoints.appendChild(li);
                        });
                    } else {
                        const li = document.createElement('li');
                        li.textContent = 'ÏïÑÏßÅ Î≥ÑÎèÑÏùò Ï≤¥ÌÅ¨ Ìè¨Ïù∏Ìä∏Í∞Ä Ï†ïÎ¶¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                        elCheckpoints.appendChild(li);
                    }
                }

                // Ï≤®Î∂ÄÌååÏùº

                if (elAttachList && elAttachEmpty && elAttachNote) {
                    elAttachList.innerHTML = '';
                    const originUrl = link || (item && item.link) || (deep && deep.link) || '#';

                    if (attachments && attachments.length) {
                        elAttachEmpty.style.display = 'none';

                        let hasMissingUrl = false;

                        attachments.forEach(a => {
                            const li = document.createElement('li');

                            const name = (a && (a.name || a.fileName)) ? String(a.name || a.fileName) : (a && a.url ? String(a.url) : 'Ï≤®Î∂ÄÌååÏùº');
                            const url = (a && (a.url || a.link)) ? String(a.url || a.link).trim() : '';

                            if (url) {
                                const aLink = document.createElement('a');
                                aLink.href = url;
                                aLink.target = '_blank';
                                aLink.rel = 'noreferrer noopener';
                                aLink.textContent = name;
                                li.appendChild(aLink);
                            } else {
                                hasMissingUrl = true;
                                const span = document.createElement('span');
                                span.textContent = name;
                                span.style.opacity = '0.9';
                                li.appendChild(span);
                            }

                            elAttachList.appendChild(li);
                        });

                        // ÎßÅÌÅ¨ ÏóÜÎäî Ï≤®Î∂ÄÍ∞Ä ÏûàÏúºÎ©¥: ÌååÏùºÎ™ÖÎßå Î≥¥Ïó¨Ï£ºÍ≥†, ÏõêÎ¨∏ ÎßÅÌÅ¨Î°ú ÏïàÎÇ¥
                        if (hasMissingUrl) {
                            elAttachNote.style.display = 'block';
                            elAttachNote.innerHTML =
                                'ÏõêÎ¨∏ Ï≤®Î∂ÄÌååÏùº(ÏõêÎ¨∏ÏóêÏÑú ÌôïÏù∏)<br>' +
                                '‚Äª ÎÇòÎùºÏû•ÌÑ∞ ÏõêÎ¨∏ ÌéòÏù¥ÏßÄÏóêÏÑú ÎèôÏùº ÌååÏùºÎ™ÖÏùÑ Ï∞æÏïÑ Îã§Ïö¥Î°úÎìúÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§. ' +
                                (originUrl && originUrl !== '#' ? ('<a href=\"' + originUrl + '\" target=\"_blank\" rel=\"noreferrer noopener\">ÏõêÎ¨∏ Ïó¥Í∏∞</a>') : '');
                        } else {
                            elAttachNote.style.display = 'none';
                        }
                    } else {
                        elAttachEmpty.style.display = 'block';
                        elAttachNote.style.display = 'none';
                    }
                }


                // ÌïúÍµ≠ÏàòÏïà ÎåÄÏùë Ï†úÏïà
                if (elSuggestion) {
                    elSuggestion.textContent =
                        deep.suggestion ||
                        'ÏïÑÏßÅ ÌïúÍµ≠ÏàòÏïà ÎåÄÏùë Ï†úÏïàÏù¥ Ï†ïÎ¶¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.';
                }

                // ÌïòÎã® Í≥µÍ≥†Î≤àÌò∏/ÎßÅÌÅ¨
                if (elFooterInfo) {
                    const infoParts = [];
                    const noVal = data.no || item.no || '';
                    if (noVal) infoParts.push('Í≥µÍ≥†Î≤àÌò∏: ' + noVal);
                    if (link) infoParts.push('ÏõêÎ¨∏ ÎßÅÌÅ¨: ' + link);
                    elFooterInfo.textContent = infoParts.join(' | ');
                }

            } catch (err) {
                console.error('deepAnalyze exception:', err);
                if (elRisk) {
                    elRisk.textContent = 'AI Ïã¨Ìôî Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + err.message;
                }
            } finally {
                setGlobalLoading(false);
            }
        }
        // ---------------- 2Ï∞® Ïã¨Ìôî Î∂ÑÏÑù Î™®Îã¨ Í≥µÌÜµ Îã´Í∏∞ Ìï®Ïàò ----------------
        function closeDeepModal() {
            const backdrop = document.getElementById('deepModalBackdrop');
            if (!backdrop) return;
            backdrop.classList.remove('active');
        }

        // ---------------Í≤ÄÏÉâÍ≤∞Í≥º Î∞è Îì±Î°ù Í≥µÍ≥† ÏÇ≠Ï†ú---------------

        async function deleteBid(item) {
            if (!accessToken || !loginUserEmail) {
                alert('ÏÇ≠Ï†ú Í∏∞Îä•ÏùÄ Google Î°úÍ∑∏Ïù∏ ÌõÑÏóêÎßå ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.');
                return;
            }
            if (!item || !item.rowIndex) {
                alert('Ìñâ Ï†ïÎ≥¥Í∞Ä ÏóÜÏñ¥ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const source = detectSource(item);
            const createdBy = item.createdByEmail || item.createdBy || '';

            // Ïä§ÎßàÌä∏ Îì±Î°ù: Îì±Î°ùÏûêÎßå ÏÇ≠Ï†ú
            if (source === 'SMART' && createdBy && createdBy !== loginUserEmail) {
                alert('Ïä§ÎßàÌä∏ Îì±Î°ù Í≥µÍ≥†Îäî Îì±Î°ùÏûêÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }

            if (!confirm('Ï†ïÎßê Ïù¥ Í≥µÍ≥†Î•º Î™©Î°ùÏóêÏÑú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            try {
                setGlobalLoading(true, 'Í≥µÍ≥† ÏÇ≠Ï†ú Ï§ëÏûÖÎãàÎã§...');

                const params = new URLSearchParams();
                params.set('action', 'delete_bid');
                params.set('rowIndex', String(item.rowIndex));
                params.set('source', source);
                params.set('userEmail', loginUserEmail || '');

                const res = await fetch(`${API_BASE}?${params.toString()}`, {
                    method: 'GET'
                });

                if (!res.ok) {
                    const errText = await res.text();
                    console.error('delete_bid HTTP error:', res.status, errText);
                    alert('ÏÇ≠Ï†ú Ïã§Ìå®: HTTP ' + res.status);
                    return;
                }

                const data = await res.json();
                console.log('delete_bid response:', data);

                if (data && data.result === 'success') {
                    alert('Í≥µÍ≥†Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    await loadData();
                } else {
                    alert('ÏÇ≠Ï†ú Ï≤òÎ¶¨ Í≤∞Í≥ºÎ•º Ìï¥ÏÑùÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.\n' + JSON.stringify(data));
                }
            } catch (err) {
                console.error(err);
                alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•ò: ' + err.message);
            } finally {
                setGlobalLoading(false);
            }
        }

        // ---------------- Google Calendar ÏùºÏ†ï Îì±Î°ù ----------------

        // ---------------- ÎÇ¥ Ï∫òÎ¶∞Îçî(ÌîÑÎ°†Ìä∏) / ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞Îçî(ÏÑúÎ≤Ñ) Ïó∞Îèô ----------------

        /**
         * ÎÇ¥ Google Ï∫òÎ¶∞Îçî(ÏÇ¨Ïö©Ïûê Í≥ÑÏ†ïÏùò primary Ï∫òÎ¶∞Îçî)Ïóê ÏùºÏ†ï Îì±Î°ù
         * - Ïû•Ï†ê: ÏÇ¨Ïö©ÏûêÎ≥Ñ Î¶¨ÎßàÏù∏Îçî, Í∞úÏù∏ Ïä§ÏºÄÏ§ÑÍ≥º ÌÜµÌï© Í¥ÄÎ¶¨
         * - Ï†ÑÏ†ú: ÏÉÅÎã® Î°úÍ∑∏Ïù∏ Î≤ÑÌäºÏúºÎ°ú accessToken ÌôïÎ≥¥ ÌïÑÏöî
         */
        async function createCalendarEventForBid(item) {
            if (!accessToken) {
                alert('Î®ºÏ†Ä ÏÉÅÎã®Ïùò Î°úÍ∑∏Ïù∏ Î≤ÑÌäºÏúºÎ°ú Google Í≥ÑÏ†ï Ïó∞ÎèôÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const title = normalizeTitle(item) || '(Ï†úÎ™© ÏóÜÏùå)';
            const deadlineStr = item.deadline || '';
            if (!deadlineStr) {
                alert('ÎßàÍ∞êÏùº Ï†ïÎ≥¥Í∞Ä ÏóÜÏñ¥ ÏùºÏ†ïÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const s = String(deadlineStr).trim();
            const dateMatch = s.match(/(\d{4})[.\-\/](\d{1,2})[.\-\/](\d{1,2})/);
            if (!dateMatch) {
                alert('ÎßàÍ∞êÏùº ÌòïÏãùÏùÑ Ìï¥ÏÑùÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§: ' + deadlineStr);
                return;
            }

            const y = parseInt(dateMatch[1], 10);
            const mo = parseInt(dateMatch[2], 10) - 1;
            const d = parseInt(dateMatch[3], 10);

            // ÏãúÍ∞Ñ Ï†ïÎ≥¥Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ 09:00ÏúºÎ°ú ÏÑ§Ï†ï
            const timeMatch = s.match(/(\d{1,2}):(\d{2})/);
            let hh = 9, mm = 0;
            if (timeMatch) {
                hh = parseInt(timeMatch[1], 10);
                mm = parseInt(timeMatch[2], 10);
            }

            // Asia/Seoul Í∏∞Ï§Ä Date Í∞ùÏ≤¥ ÏÉùÏÑ±
            const local = new Date(y, mo, d, hh, mm, 0, 0);
            // Í∏∞Î≥∏ 1ÏãúÍ∞ÑÏßúÎ¶¨ Í∞úÏù∏ ÏùºÏ†ï
            const endLocal = new Date(local.getTime() + 60 * 60 * 1000);

            const link = normalizeLink(item);

            const descriptionLines = [
                `ÏûÖÏ∞∞ Í≥µÍ≥†Î≤àÌò∏: ${item.no || ''}`,
                `Î∞úÏ£ºÏ≤ò: ${item.client || ''}`,
                `ÏàòÏöîÍ∏∞Í¥Ä: ${item.agency || ''}`,
                '',
                link ? `ÏõêÎ¨∏ ÎßÅÌÅ¨: ${link}` : '',
                '',
                (item.aiResult || '').slice(0, 500)
            ].filter(Boolean);

            const event = {
                summary: title,
                description: descriptionLines.join('\n'),
                start: {
                    dateTime: local.toISOString(),
                    timeZone: 'Asia/Seoul'
                },
                end: {
                    dateTime: endLocal.toISOString(),
                    timeZone: 'Asia/Seoul'
                }
            };

            try {
                setGlobalLoading(true, 'ÎÇ¥ Google Ï∫òÎ¶∞ÎçîÏóê ÏùºÏ†ïÏùÑ Îì±Î°ù Ï§ëÏûÖÎãàÎã§...');
                const res = await fetch(
                    `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent('primary')}/events`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + accessToken,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(event)
                    }
                );

                if (!res.ok) {
                    const errText = await res.text();
                    console.error('Calendar API error:', errText);
                    alert('ÎÇ¥ Ï∫òÎ¶∞Îçî ÏùºÏ†ï Îì±Î°ù Ïã§Ìå®: ' + res.status);
                    return;
                }

                const data = await res.json();
                console.log('Personal calendar event created:', data);
                alert('ÎÇ¥ Google Ï∫òÎ¶∞ÎçîÏóê ÏùºÏ†ïÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.');
            } catch (err) {
                console.error(err);
                alert('ÎÇ¥ Ï∫òÎ¶∞Îçî ÏùºÏ†ï Îì±Î°ù Ï§ë Ïò§Î•ò: ' + err.message);
            } finally {
                setGlobalLoading(false);
            }
        }

        /**
         * ÌöåÏÇ¨ Í≥µÏö© ÏûÖÏ∞∞ Ï∫òÎ¶∞Îçî(ÏÑúÎ≤Ñ Apps Script)Î•º ÌÜµÌï¥ ÏùºÏ†ï Îì±Î°ù
         * - Ïû•Ï†ê: Ï§ëÏïô DB(ÏãúÌä∏1)ÏôÄ Ïó∞Îèô, ÌöåÏÇ¨ Ï†ÑÏ≤¥ÏóêÏÑú ÎèôÏùºÌïú ÏùºÏ†ï Í≥µÏú†
         * - ÌîÑÎ°†Ìä∏ OAuth ÌÜ†ÌÅ∞ Î∂àÌïÑÏöî (ÏÑúÎ≤Ñ Í∂åÌïúÏúºÎ°ú Ï∫òÎ¶∞Îçî Ïó∞Îèô)
         */
        async function createCorporateCalendarEventForBid(item) {
            if (!item || !item.rowIndex) {
                alert('Ìñâ(row) Ï†ïÎ≥¥Í∞Ä ÏóÜÏñ¥ ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞Îçî Îì±Î°ùÏùÑ Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const rowIndex = item.rowIndex;

            try {
                setGlobalLoading(true, 'ÌöåÏÇ¨ Í≥µÏö© ÏûÖÏ∞∞ Ï∫òÎ¶∞ÎçîÏóê ÏùºÏ†ïÏùÑ Îì±Î°ù Ï§ëÏûÖÎãàÎã§...');

                const params = new URLSearchParams();
                params.set('action', 'calendar_add');
                params.set('rowIndex', String(rowIndex));
                params.set('target', 'company');   // ‚òÖ ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞ÎçîÎ°ú Í∞ïÏ†ú


                const res = await fetch(`${API_BASE}?${params.toString()}`, {
                    method: 'GET'
                });

                if (!res.ok) {
                    const errText = await res.text();
                    console.error('Server calendar_add error:', errText);
                    alert('ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞Îçî Îì±Î°ù Ïã§Ìå®: ' + res.status);
                    return;
                }

                const data = await res.json();
                console.log('calendar_add raw response:', data);

                // 1) Î™ÖÏãúÏ†ÅÏúºÎ°ú result ÌïÑÎìúÍ∞Ä success Ïù∏ Í≤ΩÏö∞
                if (data && data.result === 'success') {
                    alert(
                        'ÌöåÏÇ¨ Í≥µÏö© ÏûÖÏ∞∞ Ï∫òÎ¶∞ÎçîÏóê ÏùºÏ†ïÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.\n' +
                        (data.eventStartText ? `ÏãúÏûë: ${data.eventStartText}\n` : '') +
                        (data.eventEndText ? `Ï¢ÖÎ£å: ${data.eventEndText}` : '')
                    );
                }
                // 2) result Í∞Ä ÏóÜÏßÄÎßå, eventId / eventStartText Îì± "ÏÑ±Í≥µÌïú Í≤É Í∞ôÏùÄ" ÌïÑÎìúÍ∞Ä ÏûàÏùÑ Îïå
                else if (
                    data &&
                    !data.error &&
                    !data.errorMessage &&
                    (data.eventId || data.eventStartText || data.eventEndText)
                ) {
                    alert(
                        'ÌöåÏÇ¨ Í≥µÏö© ÏûÖÏ∞∞ Ï∫òÎ¶∞ÎçîÏóê ÏùºÏ†ïÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.\n' +
                        (data.eventStartText ? `ÏãúÏûë: ${data.eventStartText}\n` : '') +
                        (data.eventEndText ? `Ï¢ÖÎ£å: ${data.eventEndText}` : '')
                    );
                }
                // 3) error / errorMessage / result === 'error' ÌòïÌÉú
                else if (data && (data.result === 'error' || data.error || data.errorMessage)) {
                    alert(
                        'ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞Îçî Îì±Î°ù Ïã§Ìå®: ' +
                        (data.message || data.errorMessage || JSON.stringify(data))
                    );
                }
                // 4) Í∑∏ Ïô∏ ÏòàÏô∏Ï†ÅÏù∏ Í≤ΩÏö∞ ‚Äì ÏùëÎãµ ÎÇ¥Ïö©ÏùÑ Í∑∏ÎåÄÎ°ú Î≥¥Ïó¨Ï§å
                else {
                    alert(
                        'ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞Îçî Îì±Î°ù Í≤∞Í≥ºÎ•º Ìï¥ÏÑùÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.\n' +
                        'ÏõêÎ≥∏ ÏùëÎãµ: ' + JSON.stringify(data)
                    );
                }
            } catch (err) {
                console.error(err);
                alert('ÌöåÏÇ¨ Í≥µÏö© Ï∫òÎ¶∞Îçî Îì±Î°ù Ï§ë Ïò§Î•ò: ' + err.message);
            } finally {
                setGlobalLoading(false);
            }
        }</script>
</body>
</html>
